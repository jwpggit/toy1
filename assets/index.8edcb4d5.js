import{R as Vo,a as No,c as Bo,b as Fo}from"./vue-router.49c2ff00.js";import{b as tt,e as w,t as ee,f as zo,o as K,F as Ct,g as Z,j as Et,k as it,l as kt,m as Zn,q as Xn,v as pn,x as Ho,y as Wi,z as Ne,A as Be,B as Wo}from"./@vue.3a7072fa.js";import{a as Oe}from"./axios.a2e7c818.js";import"./filepond.f22802e6.js";import{p as qo}from"./filepond-plugin-image-preview.999ac595.js";import{p as Yo}from"./filepond-plugin-image-edit.695362ee.js";import{v as Zo,s as Xo}from"./vue-filepond.c6b47ccf.js";import{p as $o}from"./filepond-plugin-image-transform.19d9ed14.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const vt=(e,t)=>{const n=e.__vccOpts||e;for(const[r,i]of t)n[r]=i;return n},jo={props:{icon:{type:String,default:"box"},width:{type:[Number,String],default:24},height:{type:[Number,String],default:24},color:{type:String,default:"currentColor"}}},Ko=["width","height","aria-labelledby"],Qo=["id"],Jo=["fill"];function ta(e,t,n,r,i,o){return K(),tt("svg",{xmlns:"http://www.w3.org/2000/svg",width:n.width,height:n.height,viewBox:"0 0 256 256","aria-labelledby":n.icon,role:"presentation"},[w("title",{id:n.icon,lang:"en"},ee(n.icon)+" icon",9,Qo),w("g",{fill:n.color},[zo(e.$slots,"default",{},void 0,!0)],8,Jo)],8,Ko)}const Tn=vt(jo,[["render",ta],["__scopeId","data-v-b4dbeaa9"]]),ea={},na=w("polygon",{class:"st0",points:`137.6,56 118.4,56 118.4,73.6 100.8,73.6 100.8,91.2 118.4,91.2 118.4,108.8 137.6,108.8 137.6,91.2 
		155.2,91.2 155.2,73.6 137.6,73.6 	`},null,-1),ra=w("path",{class:"st0",d:`M128,0C57.6,0,0,57.6,0,128s57.6,128,128,128s128-57.6,128-128S198.4,0,128,0z M123.2,225.6H80v-16
		c0,0-33.6-25.6-40-32s-6.4-16-6.4-16s0-70.4,0-78.4s1.6-11.2,8-11.2c8,0,8,8,8,8v51.2v1.6c0,0,0,0-1.6,1.6
		c-1.6,3.2-3.2,6.4-3.2,9.6c0,6.4,6.4,11.2,6.4,11.2l28.8,24c3.2,3.2,4.8,0,4.8,0c1.6-1.6-1.6-3.2-1.6-3.2L56,150.4
		c0,0-8-6.4-3.2-12.8c0,0,1.6-3.2,4.8-3.2s8,3.2,8,3.2l51.2,38.4c6.4,4.8,6.4,11.2,6.4,11.2S123.2,225.6,123.2,225.6z M76.8,116.8
		c-9.6-1.6-12.8-6.4-12.8-17.6c0-6.4,3.2-8,3.2-8v-8c0,0,1.6-16,11.2-30.4c11.2-17.6,32-22.4,32-22.4c0-4.8,6.4-4.8,6.4-4.8h20.8
		c0,0,6.4,0,6.4,4.8c0,0,20.8,4.8,32,22.4c9.6,14.4,11.2,30.4,11.2,30.4v8c0,0,3.2,1.6,3.2,8c0,11.2-3.2,16-12.8,17.6
		c-8,3.2-35.2,4.8-49.6,4.8S86.4,120,76.8,116.8z M216,177.6c-6.4,6.4-40,32-40,32v16h-43.2v-38.4c0,0,0-6.4,6.4-11.2l52.8-36.8
		c0,0,3.2-3.2,8-3.2c3.2,0,4.8,3.2,4.8,3.2c3.2,4.8-4.8,11.2-4.8,11.2l-28.8,24c0,0-1.6,1.6-1.6,3.2c0,0,1.6,3.2,4.8,0l28.8-24
		c1.6,0,6.4-4.8,6.4-11.2c0-3.2,0-6.4-3.2-9.6c0,0,0,0-1.6-1.6v0V80c0,0,0-8,9.6-8c6.4,0,8,4.8,8,11.2s0,78.4,0,78.4
		S224,171.2,216,177.6z`},null,-1);function ia(e,t){return K(),tt(Ct,null,[na,ra],64)}const oa=vt(ea,[["render",ia]]),aa={},la=w("path",{d:"M221.66,90.34,192,120,136,64l29.66-29.66a8,8,0,0,1,11.31,0L221.66,79A8,8,0,0,1,221.66,90.34Z",opacity:"0.2"},null,-1),ca=w("path",{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"},null,-1);function ua(e,t){return K(),tt(Ct,null,[la,ca],64)}const sa=vt(aa,[["render",ua]]),da={},fa=w("path",{d:"M208,48V216a8,8,0,0,1-8,8H56a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H96a39.83,39.83,0,0,0-8,24v8h80V64a39.83,39.83,0,0,0-8-24h40A8,8,0,0,1,208,48Z",opacity:"0.2"},null,-1),pa=w("path",{d:"M168,152a8,8,0,0,1-8,8H96a8,8,0,0,1,0-16h64A8,8,0,0,1,168,152Zm-8-40H96a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16Zm56-64V216a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V48A16,16,0,0,1,56,32H92.26a47.92,47.92,0,0,1,71.48,0H200A16,16,0,0,1,216,48ZM96,64h64a32,32,0,0,0-64,0ZM200,48H173.25A47.93,47.93,0,0,1,176,64v8a8,8,0,0,1-8,8H88a8,8,0,0,1-8-8V64a47.93,47.93,0,0,1,2.75-16H56V216H200Z"},null,-1);function ha(e,t){return K(),tt(Ct,null,[fa,pa],64)}const ga=vt(da,[["render",ha]]);const ma={components:{RouterLink:Vo,icon:Tn,Logo:oa,Write:sa,List:ga}},va=e=>(Zn("data-v-63fc071f"),e=e(),Xn(),e),ya={class:"app-bar"},_a={class:"appbar__wrap"},Ea={class:"appbar__left-content"},wa={class:"logo"},Ta={class:"logo_icon"},Ra=va(()=>w("div",{class:"logo_txt"},"\uC138\uC885\uC548\uC804\uAE30\uC220",-1)),Aa={class:"appbar__right-content"};function xa(e,t,n,r,i,o){const a=it("Logo"),l=it("icon"),u=it("RouterLink"),c=it("List"),s=it("Write");return K(),tt("div",ya,[w("div",_a,[w("div",Ea,[Z(u,{to:"/"},{default:Et(()=>[w("div",wa,[w("div",Ta,[Z(l,{icon:"Logo"},{default:Et(()=>[Z(a)]),_:1})]),Ra])]),_:1})]),w("div",Aa,[Z(u,{to:"/"},{default:Et(()=>[Z(l,{icon:"List"},{default:Et(()=>[Z(c)]),_:1}),kt("\uBAA9\uB85D")]),_:1}),Z(u,{to:"/post/create"},{default:Et(()=>[Z(l,{icon:"Write"},{default:Et(()=>[Z(s)]),_:1}),kt("\uC791\uC131")]),_:1})])])])}const Ia=vt(ma,[["render",xa],["__scopeId","data-v-63fc071f"]]),Ca={components:{RouterView:No,Appbar:Ia}};function ba(e,t,n,r,i,o){const a=it("Appbar"),l=it("RouterView"),u=it("v-main");return K(),tt("div",null,[Z(a),Z(u,null,{default:Et(()=>[Z(l)]),_:1})])}const Sa=vt(Ca,[["render",ba]]);const Oa={props:{post:{type:Object,required:!0}},data(){return{}}},qi=e=>(Zn("data-v-7030e5c8"),e=e(),Xn(),e),Ma={style:{padding:"0"},colspan:"2"},La={class:"card_image__wrap"},Pa=["src"],Ga=qi(()=>w("td",null,[w("p",{class:"bold"},"\uC9C0\uB3C4\uC77C\uC790")],-1)),ka=qi(()=>w("td",null,[w("p",{class:"bold"},"\uD604\uC7A5\uBA85")],-1));function Da(e,t,n,r,i,o){return K(),tt("table",null,[w("tbody",null,[w("tr",null,[w("td",Ma,[w("div",La,[w("button",{class:"card_button",onClick:t[0]||(t[0]=a=>e.$emit("delete-post",n.post))},"\uC0AD\uC81C"),w("img",{src:n.post.photo,onClick:t[1]||(t[1]=a=>e.$router.push({name:"DetailView",params:{id:n.post.id}}))},null,8,Pa)])])]),w("tr",null,[Ga,w("td",null,[w("p",null,ee(n.post.date),1)])]),w("tr",null,[ka,w("td",null,[w("p",null,ee(n.post.subject),1)])])])])}const Ua=vt(Oa,[["render",Da],["__scopeId","data-v-7030e5c8"]]),Rn="/api/posts/",Va=async e=>{const t=await Oe.get(Rn),{data:n}=t;return n},Yi=async e=>(await Oe.get(Rn+e)).data,Na=async e=>{const t=await Oe.post(Rn,e),{data:n}=t;return n},Ba=async(e,t)=>(await Oe.put(Rn+e,t)).data,Fa=async e=>(await Oe.delete(Rn+e)).data;const za={components:{Card:Ua},data(){return{allPosts:[]}},created(){Va().then(e=>{this.allPosts=e.reverse()})},methods:{deletePost(e){Fa(e.id).then(t=>{const n=this.allPosts.findIndex(r=>r.id===e.id);n!==-1&&this.allPosts.splice(n,1)}).catch(t=>{})}}},Ha={class:"v-sheet"},Wa={class:"main__wrap"};function qa(e,t,n,r,i,o){const a=it("Card");return K(),tt("div",Ha,[w("div",Wa,[(K(!0),tt(Ct,null,pn(i.allPosts,l=>(K(),Ho(a,{key:l.id,post:l,onDeletePost:o.deletePost},null,8,["post","onDeletePost"]))),128))])])}const Ya=vt(za,[["render",qa],["__scopeId","data-v-8a083c46"]]),Za={},Xa=w("path",{d:"M160,168l-48,48H66.75L36.69,185.94a16,16,0,0,1,0-22.63L96,104Z",opacity:"0.2"},null,-1),$a=w("path",{d:"M225,80.4,183.6,39a24,24,0,0,0-33.94,0L31,157.66a24,24,0,0,0,0,33.94l30.06,30.06A8,8,0,0,0,66.74,224H216a8,8,0,0,0,0-16h-84.7L225,114.34A24,24,0,0,0,225,80.4ZM108.68,208H70.05L42.33,180.28a8,8,0,0,1,0-11.31L96,115.31,148.69,168Zm105-105L160,156.69,107.31,104,161,50.34a8,8,0,0,1,11.32,0l41.38,41.38a8,8,0,0,1,0,11.31Z"},null,-1);function ja(e,t){return K(),tt(Ct,null,[Xa,$a],64)}const Ka=vt(Za,[["render",ja]]),Qa={},Ja=w("path",{d:"M232,96v80H192V152H64v24H24V96c0-8.84,7.76-16,17.33-16H214.67C224.24,80,232,87.16,232,96Z",opacity:"0.2"},null,-1),tl=w("path",{d:"M214.67,72H200V40a8,8,0,0,0-8-8H64a8,8,0,0,0-8,8V72H41.33C27.36,72,16,82.77,16,96v80a8,8,0,0,0,8,8H56v32a8,8,0,0,0,8,8H192a8,8,0,0,0,8-8V184h32a8,8,0,0,0,8-8V96C240,82.77,228.64,72,214.67,72ZM72,48H184V72H72ZM184,208H72V160H184Zm40-40H200V152a8,8,0,0,0-8-8H64a8,8,0,0,0-8,8v16H32V96c0-4.41,4.19-8,9.33-8H214.67c5.14,0,9.33,3.59,9.33,8Zm-24-52a12,12,0,1,1-12-12A12,12,0,0,1,200,116Z"},null,-1);function el(e,t){return K(),tt(Ct,null,[Ja,tl],64)}const nl=vt(Qa,[["render",el]]),rl={components:{icon:Tn,Fix:Ka,Printer:nl},data(){return{postData:null}},computed:{formattedDate(){const e=new Date(this.postData.date),t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0");return`${t}\uB144 ${n}\uC6D4 ${r}\uC77C`}},methods:{printPage(){const e=this.$refs.page,t=window.open("","","width=794,height=1123");t.document.write(`
        <html>
          <head>
            <title>Print</title>
            <style>
              @media print {
                @page {
                  size: A4;
                  margin: 0;
                }


               



* {
  white-space: normal;
  word-break: keep-all;
  box-sizing: border-box;
  text-decoration-line: none;
  font-family: 'spoqa';
}
.bold { 
  font-weight: 700;
}
p { 
  font-size: 18px; 
  margin: 0;
}
body {
  margin: 0;
  padding: 0;
}
table {
  width: 100%;
  border: 1px solid #000;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #000;
  padding: 10px;
}
input {
  outline: none;
  width: 100%;
  border: none;
  font-size: 18px;
}
textarea {
  border: none;
  font-size: 18px;
}
textarea:focus {
  outline: none;
}
a {
  color: #000;
}
button{
  background: inherit ; 
  border:none; 
  box-shadow:none; 
  border-radius:0; 
  padding:0; 
  overflow:visible; 
  cursor:pointer
}
button {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 14px 24px 16px;
  font-size: 18px;
  font-weight: 700;
  border-radius: 10px;
  color: #fff;
  transition: all .25s ease;
  background-color: #5551ff;
}
button:hover {
  transform: translateY(-2px);
}
.fixed_button__wrap {
  position: fixed;
  display: flex;
  flex-direction: column;
  gap: 18px;
  top: 120px;
  right: 50px;
}
.save_button {
  color: #fff;
  background-color: #5551ff;
}
.add_button {
  color: #000;
  background-color: #ff6498;
}
.create_button {
  color: #fff;
  background-color: #000;
}
.close_button {
  position: absolute;
  top: 20px;
  right: 20px;
  color: #fff;
  background-color: #000;
}






.v-main {
  display: flex;
  justify-content: center;
}
.v-toolbar__content, .v-toolbar__extension {
  display: flex;
  align-items: center;
  justify-content: center;
  border-bottom: 1px solid black;
}
.appbar__wrap {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  max-width: 1192px;
  margin: 0 64px;
}
.appbar__left-content a {
  display: flex;
  align-items: center;
font-weight: 700;
}
.appbar__left-content svg {
  width: 100%;
  height: 100%;
}
.v-sheet {
  width: 100%;
  margin-top: 64px;
  background-color: #fff;
  display: flex;
  justify-content: center;
}


.write__content table:hover { 
  border: 1 solid rgb(var(--v-theme-primary));
   box-shadow: 0 10px 20px -10px rgba(0,0,0,.8);
}


.create__header {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 25px;
  margin-bottom: 20px;
}
.create__footer {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 25px;
}
.footer__left {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 25px;
}
.footer__right {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 25px;
}
.write__wrap {
  position: relative;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 25px;
  padding: 20px 0;
  align-content: stretch;
}
.write__content {
  position: relative;
  width: 100%;
}

.addContent__wrap {
  position: relative;
  border: 1px solid #000;
  min-height: 200px;
}
.addContent__content {
  width: 100%;
  height: 100%;
  transition: all .25s ease;
  cursor: pointer;
}

.addContent__content:hover {
  color: #fff;
  background-color: #5551ff;
}

.filepond__wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 160px;
  width: 100%;
}

textarea {
  width: 100%;
  resize: none!important;
}




.filepond--credits {
  display: none;
}



.app-bar {
  position: fixed;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 64px;
  top: 0;
  left: 0;
  background-color: #fff;
  z-index: 1000;
  border-bottom: 1px solid #000;
}




@page {
  size: A4;
  margin: 0;
}
.page {
  position: relative;
  width: 21cm;
  min-height: 29.7cm;
  padding: 1.5cm 1.5cm 2cm 1.5cm;
  background-color: white;
}

.a4_size {
  position: absolute;
  height: 1px;
  width: 100%;
  bottom: 2cm;
  left: 0px;
  background-color: red;
  z-index: 100;
}

.detail__wrap {
  margin: 0;
  padding: 40px 0;
  background-color: rgba(0,0,0,.4);
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
}










.detail__wrap p {
  font-size: 14px; 
}
.table {
  width: 100%;
  border: 1px solid #000;
  border-collapse: collapse;
}
th, 
td {
  border: 1px solid #000;
  padding: 5px;
}
.detail_title {
  position: relative;
  display: flex;
  align-items: center;
  flex-direction: column;
  font-size: 12px;
  width: 100%;
  margin-bottom: 60px;
}
.title_1 {
  position: relative;
  display: flex;
  justify-content: space-between;
  width: 30%;
}
.title_2 {
  display: block;
  height: 2px;
  width: 30%;
  background-color: black;
}
.detail_flex {
  font-size: 16px;
  position: relative;
  display: flex;
  gap: 12px;
  height: 32px;
}
.flex_1 {
  display: flex;
  justify-content: space-between;
  width: 10%;
}







.page_grid {
  position: relative;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 12px;
  align-content: stretch;
  width: 100%;
  overflow: hidden;
}

.page_table {
  position: relative;
  display: block;
  width: 100%;
}
.paper_img__wrap {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  gap: 4px;
  height: 300px;
}
.paper_img_content {
  display: block;
  flex: 1 1 50%;
  height: 25%;
  width: auto;
}
.paper_img_content img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.footer {
  display: flex;
  justify-content: flex-end;
  position: absolute;
  width: 100%;
  padding: 2.5cm 1.5cm;
  left: 0;
  bottom: 0;
}
.paper_gray {
  background-color: #EBEBEB;
  width: 25%;
}
.paper_gray p {
  margin: 0.5em;
}



              }
              body {
                margin: 0;
                padding: 0;
              }
            </style>
          </head>
          <body>
            ${e.outerHTML}
          </body>
        </html>
      `),t.focus(),t.print(),t.close()}},created(){const e=this.$route.params.id;Yi(e).then(t=>{this.postData=t})}},il={class:"v-sheet"},ol={class:"detail__wrap"},al={class:"fixed_button__wrap"},ll={key:0,class:"page",ref:"page"},cl=w("div",{class:"a4_size"},null,-1),ul=w("div",{class:"detail_title"},[w("div",{class:"title_1"},[w("h1",null,"\uC0AC"),w("h1",null,"\uC9C4"),w("h1",null,"\uB300"),w("h1",null,"\uC9C0")]),w("div",{class:"title_2"})],-1),sl={class:"detail_flex"},dl=w("div",{class:"flex_1"},[w("p",null,"\uC9C0"),w("p",null,"\uB3C4"),w("p",null,"\uC77C"),w("p",null,"\uC790")],-1),fl=w("p",null,":",-1),pl={class:"detail_flex"},hl=w("div",{class:"flex_1"},[w("p",null,"\uD604"),w("p",null,"\uC7A5"),w("p",null,"\uBA85")],-1),gl=w("p",null,":",-1),ml={class:"page_grid"},vl=["post"],yl={colspan:"2",style:{padding:"1px"}},_l={class:"paper_img__wrap"},El=["src"],wl={class:"paper_gray"},Tl=w("div",{class:"footer"},[w("p",null,"\uC138\uC885\uC548\uC804\uAE30\uC220(\uC8FC)")],-1);function Rl(e,t,n,r,i,o){const a=it("Fix"),l=it("icon"),u=it("Printer");return K(),tt("div",il,[w("div",ol,[w("div",al,[w("button",{class:"add_button",onClick:t[0]||(t[0]=()=>this.$router.push({name:"EditView",params:{id:i.postData.id}}))},[Z(l,{icon:"Fix"},{default:Et(()=>[Z(a)]),_:1}),kt("\uC218\uC815")]),w("button",{class:"save_button",onClick:t[1]||(t[1]=(...c)=>o.printPage&&o.printPage(...c))},[Z(l,{icon:"Printer"},{default:Et(()=>[Z(u)]),_:1}),kt("Print")])]),i.postData?(K(),tt("div",ll,[cl,ul,w("div",sl,[dl,fl,w("p",null,ee(o.formattedDate),1)]),w("div",pl,[hl,gl,w("p",null,ee(i.postData.subject),1)]),w("div",ml,[(K(!0),tt(Ct,null,pn(i.postData.contents,c=>(K(),tt("div",{class:"page_table",key:c.id,post:c},[w("table",null,[w("tbody",null,[w("tr",null,[w("td",yl,[w("div",_l,[(K(!0),tt(Ct,null,pn(c.image,s=>(K(),tt("div",{key:s,class:"paper_img_content"},[w("img",{src:s},null,8,El)]))),128))])])]),w("tr",null,[w("td",wl,[w("p",null,ee(c.title),1)]),w("td",null,[w("p",null,ee(c.detail),1)])])])])],8,vl))),128))]),Tl],512)):Wi("",!0)])])}const Al=vt(rl,[["render",Rl]]),xl={},Il=w("path",{d:"M216,91.31V208a8,8,0,0,1-8,8H176V152a8,8,0,0,0-8-8H88a8,8,0,0,0-8,8v64H48a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H164.69a8,8,0,0,1,5.65,2.34l43.32,43.31A8,8,0,0,1,216,91.31Z",opacity:"0.2"},null,-1),Cl=w("path",{d:"M219.31,80,176,36.69A15.86,15.86,0,0,0,164.69,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V91.31A15.86,15.86,0,0,0,219.31,80ZM168,208H88V152h80Zm40,0H184V152a16,16,0,0,0-16-16H88a16,16,0,0,0-16,16v56H48V48H164.69L208,91.31ZM160,72a8,8,0,0,1-8,8H96a8,8,0,0,1,0-16h56A8,8,0,0,1,160,72Z"},null,-1);function bl(e,t){return K(),tt(Ct,null,[Il,Cl],64)}const Zi=vt(xl,[["render",bl]]),Sl={},Ol=w("path",{d:"M208,88H152V32Z",opacity:"0.2"},null,-1),Ml=w("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Zm-40-64a8,8,0,0,1-8,8H136v16a8,8,0,0,1-16,0V160H104a8,8,0,0,1,0-16h16V128a8,8,0,0,1,16,0v16h16A8,8,0,0,1,160,152Z"},null,-1);function Ll(e,t){return K(),tt(Ct,null,[Ol,Ml],64)}const Xi=vt(Sl,[["render",Ll]]),Pl={},Gl=w("path",{d:"M200,56V208a8,8,0,0,1-8,8H64a8,8,0,0,1-8-8V56Z",opacity:"0.2"},null,-1),kl=w("path",{d:"M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm96,168H64V64H192ZM112,104v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm48,0v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Z"},null,-1);function Dl(e,t){return K(),tt(Ct,null,[Gl,kl],64)}const $i=vt(Pl,[["render",Dl]]);const Ul="/api/images/",Vl=async e=>{const t=await Oe.post(Ul+"/",e),{data:n}=t;return n};/*!
 * Doka Image Editor 6.16.1
 * (c) 2018-2020 PQINA Inc. - All Rights Reserved
 * License: https://pqina.nl/doka/license/
 */function ne(e){return(ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function Nl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{},r=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable}))),r.forEach(function(i){Nl(e,i,n[i])})}return e}function Ge(e,t){return Fl(e)||Hl(e,t)||ql()}function Ft(e){return Bl(e)||zl(e)||Wl()}function Bl(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function Fl(e){if(Array.isArray(e))return e}function zl(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function Hl(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{r||l.return==null||l.return()}finally{if(i)throw o}}return n}function Wl(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ql(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var Yl=function(e){return e instanceof HTMLElement},Br=function(e,t){return t.parentNode.insertBefore(e,t)},Fr=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},hn=function(e){return ne(e)==="object"&&e!==null},Zl=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=I({},e),i=[],o=[],a=function(d,f,h){h?o.push({type:d,data:f}):(s[d]&&s[d](f),i.push({type:d,data:f}))},l=function(d){for(var f,h=arguments.length,p=new Array(h>1?h-1:0),g=1;g<h;g++)p[g-1]=arguments[g];return c[d]?(f=c)[d].apply(f,p):null},u={getState:function(){return I({},r)},processActionQueue:function(){var d=[].concat(i);return i.length=0,d},processDispatchQueue:function(){var d=[].concat(o);o.length=0,d.forEach(function(f){var h=f.type,p=f.data;a(h,p)})},dispatch:a,query:l},c={};t.forEach(function(d){c=I({},d(r),c)});var s={};return n.forEach(function(d){s=I({},d(a,l,r),s)}),u},Xl=function(e,t,n){typeof n!="function"?Object.defineProperty(e,t,n):e[t]=n},ht=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},Ce=function(e){var t={};return ht(e,function(n){Xl(t,n,e[n])}),t},gn=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(n===null)return e.getAttribute(t)||e.hasAttribute(t);e.setAttribute(t,n)},$l="http://www.w3.org/2000/svg",jl=["svg","path"],zr=function(e){return jl.includes(e)},z=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ne(t)==="object"&&(n=t,t=null);var r=zr(e)?document.createElementNS($l,e):document.createElement(e);return t&&(zr(e)?gn(r,"class",t):r.className=t),ht(n,function(i,o){gn(r,i,o)}),r},ue=function(e){return function(t,n){n!==void 0&&e.children[n]?e.insertBefore(t,e.children[n]):e.appendChild(t)}},Kl=function(e,t){return function(n,r){return r!==void 0?t.splice(r,0,n):t.push(n),n}},Ql=function(e,t){return function(n){var r=t.splice(t.indexOf(n),1);return r.length&&r[0]._destroy(),n.element.parentNode&&e.removeChild(n.element),n}},ji=function(e,t,n,r){var i=n[0]||e.left,o=n[1]||e.top,a=i+e.width,l=o+e.height*(r[1]||1),u={element:I({},e),inner:{left:e.left,top:e.top,right:e.right,bottom:e.bottom},outer:{left:i,top:o,right:a,bottom:l}};return t.filter(function(c){return!c.isRectIgnored()}).map(function(c){return c.rect}).forEach(function(c){Hr(u.inner,I({},c.inner)),Hr(u.outer,I({},c.outer))}),Wr(u.inner),u.outer.bottom+=u.element.marginBottom,u.outer.right+=u.element.marginRight,Wr(u.outer),u},Hr=function(e,t){t.top+=e.top,t.right+=e.left,t.bottom+=e.top,t.left+=e.left,t.bottom>e.bottom&&(e.bottom=t.bottom),t.right>e.right&&(e.right=t.right)},Wr=function(e){e.width=e.right-e.left,e.height=e.bottom-e.top},Dt=function(e){return typeof e=="number"},Jl=function(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.001;return Math.abs(e-t)<r&&Math.abs(n)<r},zt=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.stiffness,n=t===void 0?.5:t,r=e.damping,i=r===void 0?.75:r,o=e.mass,a=o===void 0?10:o,l=e.delay,u=l===void 0?0:l,c=null,s=null,d=0,f=!1,h=null,p=Ce({interpolate:function(g){if(h===null&&(h=g),!(g-u<h||f)){if(!Dt(c)||!Dt(s))return f=!0,void(d=0);Jl(s+=d+=-(s-c)*n/a,c,d*=i)?(s=c,d=0,f=!0,p.onupdate(s),p.oncomplete(s)):p.onupdate(s)}},target:{set:function(g){if(Dt(g)&&!Dt(s)&&(s=g,h=null),c===null&&(c=g,s=g,h=null),f&&(h=null),s===(c=g)||c===void 0)return f=!0,d=0,h=null,p.onupdate(s),void p.oncomplete(s);f=!1},get:function(){return c}},resting:{get:function(){return f}},onupdate:function(){},oncomplete:function(){},position:{get:function(){return s}}});return p},tc=function(e){return e<.5?2*e*e:(4-2*e)*e-1},ec=function(){var e,t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.duration,i=r===void 0?500:r,o=n.easing,a=o===void 0?tc:o,l=n.delay,u=l===void 0?0:l,c=null,s=!0,d=!1,f=null,h=Ce({interpolate:function(p){s||f===null||(c===null&&(c=p),p-c<u||((e=p-c-u)<i?(t=e/i,h.onupdate((e>=0?a(d?1-t:t):0)*f)):(e=1,t=d?0:1,h.onupdate(t*f),h.oncomplete(t*f),s=!0)))},target:{get:function(){return d?0:f},set:function(p){if(f===null)return f=p,h.onupdate(p),void h.oncomplete(p);p<f?(f=1,d=!0):(d=!1,f=p),s=!1,c=null}},resting:{get:function(){return s}},onupdate:function(){},oncomplete:function(){}});return h},qr={spring:zt,tween:ec},nc=function(e,t,n){var r=e[t]&&ne(e[t][n])==="object"?e[t][n]:e[t]||e,i=typeof r=="string"?r:r.type,o=ne(r)==="object"?I({},r):{};return qr[i]?qr[i](o):null},br=function(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];(t=Array.isArray(t)?t:[t]).forEach(function(i){e.forEach(function(o){var a=o,l=function(){return n[o]},u=function(c){return n[o]=c};ne(o)==="object"&&(a=o.key,l=o.getter||l,u=o.setter||u),i[a]&&!r||(i[a]={get:l,set:u})})})},rc=function(e){var t=e.mixinConfig,n=e.viewProps,r=e.viewInternalAPI,i=e.viewExternalAPI,o=I({},n),a=[];return ht(t,function(l,u){var c=nc(u);c&&(c.onupdate=function(s){n[l]=s},c.target=o[l],br([{key:l,setter:function(s){c.target!==s&&(c.target=s)},getter:function(){return n[l]}}],[r,i],n,!0),a.push(c))}),{write:function(l){var u=!0;return a.forEach(function(c){c.resting||(u=!1),c.interpolate(l)}),u},destroy:function(){}}},vr=function(e){return function(t,n){e.addEventListener(t,n)}},yr=function(e){return function(t,n){e.removeEventListener(t,n)}},ic=function(e){var t=e.viewExternalAPI,n=e.view,r=[],i=vr(n.element),o=yr(n.element);return t.on=function(a,l){r.push({type:a,fn:l}),i(a,l)},t.off=function(a,l){r.splice(r.findIndex(function(u){return u.type===a&&u.fn===l}),1),o(a,l)},{write:function(){return!0},destroy:function(){r.forEach(function(a){o(a.type,a.fn)})}}},oc=function(e){var t=e.mixinConfig,n=e.viewProps,r=e.viewExternalAPI;br(t,r,n)},ac={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},lc=function(e){var t=e.mixinConfig,n=e.viewProps,r=e.viewInternalAPI,i=e.viewExternalAPI,o=e.view,a=I({},n),l={};br(t,[r,i],n);var u=function(){return o.rect?ji(o.rect,o.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return r.rect={get:u},i.rect={get:u},t.forEach(function(c){n[c]=a[c]===void 0?ac[c]:a[c]}),{write:function(){if(cc(l,n))return uc(o.element,n),Object.assign(l,I({},n)),!0},destroy:function(){}}},cc=function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!0;for(var n in t)if(t[n]!==e[n])return!0;return!1},uc=function(e,t){var n=t.opacity,r=t.perspective,i=t.translateX,o=t.translateY,a=t.scaleX,l=t.scaleY,u=t.rotateX,c=t.rotateY,s=t.rotateZ,d=t.originX,f=t.originY,h=t.width,p=t.height,g="",m="";d==null&&f==null||(m+="transform-origin: ".concat(d||0,"px ").concat(f||0,"px;")),r!=null&&(g+="perspective(".concat(r,"px) ")),i==null&&o==null||(g+="translate3d(".concat(i||0,"px, ").concat(o||0,"px, 0) ")),a==null&&l==null||(g+="scale3d(".concat(a!=null?a:1,", ").concat(l!=null?l:1,", 1) ")),s!=null&&(g+="rotateZ(".concat(s,"rad) ")),u!=null&&(g+="rotateX(".concat(u,"rad) ")),c!=null&&(g+="rotateY(".concat(c,"rad) ")),g!=""&&(m+="transform:".concat(g,";")),n!=null&&(m+="opacity:".concat(n,";"),n<1&&(m+="pointer-events:none;"),n===0&&e.nodeName==="BUTTON"&&(m+="visibility:hidden;")),h!=null&&(m+="width:".concat(h,"px;")),p!=null&&(m+="height:".concat(p,"px;"));var _=e.elementCurrentStyle||"";m.length===_.length&&m===_||(e.style.cssText=m,e.elementCurrentStyle=m)},sc={styles:lc,listeners:ic,animations:rc,apis:oc},Yr=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t.layoutCalculated||(e.paddingTop=parseInt(n.paddingTop,10)||0,e.marginTop=parseInt(n.marginTop,10)||0,e.marginRight=parseInt(n.marginRight,10)||0,e.marginBottom=parseInt(n.marginBottom,10)||0,e.marginLeft=parseInt(n.marginLeft,10)||0,t.layoutCalculated=!0),e.left=t.offsetLeft||0,e.top=t.offsetTop||0,e.width=t.offsetWidth||0,e.height=t.offsetHeight||0,e.right=e.left+e.width,e.bottom=e.top+e.height,e.scrollTop=t.scrollTop,e.hidden=t.offsetParent===null&&n.position!=="fixed",e},dc=typeof window<"u"&&window.document!==void 0,Se=function(){return dc},fc=Se()?z("svg"):{},pc="children"in fc?function(e){return e.children.length}:function(e){return e.childNodes.length},D=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.tag,n=t===void 0?"div":t,r=e.name,i=r===void 0?null:r,o=e.attributes,a=o===void 0?{}:o,l=e.read,u=l===void 0?function(){}:l,c=e.write,s=c===void 0?function(){}:c,d=e.create,f=d===void 0?function(){}:d,h=e.destroy,p=h===void 0?function(){}:h,g=e.filterFrameActionsForChild,m=g===void 0?function(V,B){return B}:g,_=e.didCreateView,y=_===void 0?function(){}:_,v=e.didWriteView,T=v===void 0?function(){}:v,A=e.shouldUpdateChildViews,R=A===void 0?function(){return!0}:A,x=e.ignoreRect,b=x!==void 0&&x,O=e.ignoreRectUpdate,C=O!==void 0&&O,M=e.mixins,S=M===void 0?[]:M;return function(V){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},U=z(n,i?"doka--".concat(i):null,a),q=window.getComputedStyle(U,null),L=Yr(),k=null,H=!1,F=[],P=[],rt={},nt={},ot=[s],at=[u],W=[p],ft=function(){return U},lt=function(){return[].concat(F)},bt=function(){return k||(k=ji(L,F,[0,0],[1,1]))},yt=function(){return U.layoutCalculated=!1},gt={element:{get:ft},style:{get:function(){return q}},childViews:{get:lt}},et=I({},gt,{rect:{get:bt},ref:{get:function(){return rt}},is:function(G){return i===G},appendChild:ue(U),createChildView:function(G){return function(Q,ut){return Q(G,ut)}}(V),linkView:function(G){return F.push(G),G},unlinkView:function(G){F.splice(F.indexOf(G),1)},appendChildView:Kl(U,F),removeChildView:Ql(U,F),registerWriter:function(G){return ot.push(G)},registerReader:function(G){return at.push(G)},registerDestroyer:function(G){return W.push(G)},invalidateLayout:yt,dispatch:V.dispatch,query:V.query}),_t={element:{get:ft},childViews:{get:lt},rect:{get:bt},resting:{get:function(){return H}},isRectIgnored:function(){return b},invalidateLayout:yt,_read:function(){k=null,R({root:j,props:B})&&F.forEach(function(Q){return Q._read()}),!(C&&L.width&&L.height)&&Yr(L,U,q);var G={root:j,props:B,rect:L};at.forEach(function(Q){return Q(G)})},_write:function(G){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],ut=Q.length===0;return ot.forEach(function(J){J({props:B,root:j,actions:Q,timestamp:G})===!1&&(ut=!1)}),P.forEach(function(J){J.write(G)===!1&&(ut=!1)}),R({props:B,root:j,actions:Q,timestamp:G})&&(F.filter(function(J){return!!J.element.parentNode}).forEach(function(J){J._write(G,m(J,Q))||(ut=!1)}),F.forEach(function(J,Me){J.element.parentNode||(j.appendChild(J.element,Me),J._read(),J._write(G,m(J,Q)),ut=!1)})),H=ut,T({props:B,root:j,actions:Q,timestamp:G}),ut},_destroy:function(){P.forEach(function(G){return G.destroy()}),W.forEach(function(G){G({root:j})}),F.forEach(function(G){return G._destroy()})}},$t=I({},gt,{rect:{get:function(){return L}}});Object.keys(S).sort(function(G,Q){return G==="styles"?1:Q==="styles"?-1:0}).forEach(function(G){var Q=sc[G]({mixinConfig:S[G],viewProps:B,viewState:nt,viewInternalAPI:et,viewExternalAPI:_t,view:Ce($t)});Q&&P.push(Q)});var j=Ce(et);f({root:j,props:B});var ct=pc(U)||0;return F.forEach(function(G,Q){j.appendChild(G.element,ct+Q)}),y(j),Ce(_t)}},hc=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:60,r="__framePainter";if(window[r])return window[r].readers.push(e),void window[r].writers.push(t);window[r]={readers:[e],writers:[t]};var i=window[r],o=1e3/n,a=null,l=null,u=null,c=null,s=function(){document.hidden?(u=function(){return window.setTimeout(function(){return d(performance.now())},o)},c=function(){return window.clearTimeout(l)}):(u=function(){return window.requestAnimationFrame(d)},c=function(){return window.cancelAnimationFrame(l)})};document.addEventListener("visibilitychange",function(){c&&c(),s(),d(performance.now())});var d=function f(h){l=u(f),a||(a=h);var p=h-a;p<=o||(a=h-p%o,i.readers.forEach(function(g){return g()}),i.writers.forEach(function(g){return g(h)}))};return s(),d(performance.now()),{pause:function(){c(l)}}},dt=function(e,t){return function(n){var r=n.root,i=n.props,o=n.actions,a=o===void 0?[]:o,l=n.timestamp;if(a.filter(function(u){return e[u.type]}).forEach(function(u){return e[u.type]({root:r,props:i,action:u.data,timestamp:l})}),t)return t({root:r,props:i,actions:a,timestamp:l})}},Ki=function(e){return Array.isArray(e)},Sr=function(e){return e==null},gc=function(e){return e.trim()},$n=function(e){return""+e},mc=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:",";return Sr(e)?[]:Ki(e)?e:$n(e).split(t).map(gc).filter(function(n){return n.length})},_r=function(e){return typeof e=="boolean"},vc=function(e){return _r(e)?e:e==="true"},Rt=function(e){return typeof e=="string"},Qi=function(e){return Dt(e)?e:Rt(e)?$n(e).replace(/[a-z]+/gi,""):0},Nn=function(e){return parseInt(Qi(e),10)},Zr=function(e){return parseFloat(Qi(e))},Ji=function(e){return Dt(e)&&isFinite(e)&&Math.floor(e)===e},Xr=function(e){if(Ji(e))return e;var t=$n(e).trim();return/MB$/i.test(t)?(t=t.replace(/MB$i/,"").trim(),1e3*Nn(t)*1e3):/KB/i.test(t)?(t=t.replace(/KB$i/,"").trim(),1e3*Nn(t)):Nn(t)},yc=function(e){return typeof e=="function"},_c=function(e){for(var t=self,n=e.split("."),r=null;r=n.shift();)if(!(t=t[r]))return null;return t},Ec=function(e){return e===null},Er=function(e){return Ki(e)?"array":Ec(e)?"null":Ji(e)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(e)?"bytes":ne(e)},wc=function(e){return e.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",')},Tc={array:mc,boolean:vc,int:function(e){return Er(e)==="bytes"?Xr(e):Nn(e)},float:Zr,bytes:Xr,number:Zr,string:function(e){return yc(e)?e:$n(e)},object:function(e){try{return JSON.parse(wc(e))}catch{return e}},file:function(e){return e},function:function(e){return _c(e)}},Rc=function(e,t){return Tc[t](e)},to=function(e,t,n){if(e===t)return e;var r=Er(e);if(r!==n){var i=Rc(e,n);if(r=Er(i),i===null)throw'Trying to assign value with incorrect type, allowed type: "'.concat(n,'"');e=i}return e},Ac=function(e,t){var n=e;return{enumerable:!0,get:function(){return n},set:function(r){n=to(r,e,t)}}},xc=function(e){var t={};return ht(e,function(n){var r=Rt(e[n])?e[n]:n,i=e[r];t[n]=r===n?Ac(i[0],i[1]):t[r]}),Ce(t)},ln=function(e){e.file=null,e.activeView=null,e.markup=[],e.markupToolValues={},e.rootRect={x:0,y:0,left:0,top:0,width:0,height:0},e.stage=null,e.stageOffset=null,e.image=null,e.zoomTimeoutId=null,e.instantUpdate=!1,e.filePromise=null,e.fileLoader=null,e.instructions={size:null,crop:null,filter:null,color:null},e.filter=null,e.filterName=null,e.filterValue=null,e.colorValues={},e.colorMatrices={},e.size={width:!1,height:!1,aspectRatioLocked:!0,aspectRatioPrevious:!1},e.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,limitToImageBounds:!0,draft:{rectangle:null,transforms:null}}},Ic=function(e){var t={noImageTimeout:null,options:xc(e)};return ln(t),t},jn=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"-";return e.split(/(?=[A-Z])/).map(function(n){return n.toLowerCase()}).join(t)},Cc=function(e,t){var n={};return ht(t,function(r){var i=Rt(t[r])?t[r]:r;n[r]={get:function(){return e.getState().options[i]},set:function(o){e.dispatch("SET_".concat(jn(i,"_").toUpperCase()),{value:o})}}}),n},bc=function(e){return function(t,n,r){var i={};return ht(e,function(o){var a=jn(o,"_").toUpperCase();i["SET_".concat(a)]=function(l){var u;try{u=r.options[o],r.options[o]=l.value}catch{}t("DID_SET_".concat(a),{value:r.options[o],prevValue:u})}}),i}},Sc=function(e){return function(t){var n={};return ht(e,function(r){n["GET_".concat(jn(r,"_").toUpperCase())]=function(){return t.options[r]}}),n}},Yt=function(){return Math.random().toString(36).substr(2,9)},Oc=function(e,t){return e.splice(t,1)},Or=function(){var e=[],t=function(n,r){Oc(e,e.findIndex(function(i){return i.event===n&&(i.cb===r||!r)}))};return{fire:function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];e.filter(function(a){return a.event===n}).map(function(a){return a.cb}).forEach(function(a){setTimeout(function(){a.apply(void 0,i)},0)})},on:function(n,r){e.push({event:n,cb:r})},onOnce:function(n,r){e.push({event:n,cb:function(){t(n,r),r.apply(void 0,arguments)}})},off:t}},E={BOOLEAN:"boolean",INT:"int",NUMBER:"number",STRING:"string",ARRAY:"array",OBJECT:"object",FUNCTION:"function",FILE:"file"},ir=null,ze=function(){return ir===null&&(ir=(/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream),ir},Fn=function(){return I({},be)},Mc=function(e){ht(e,function(t,n){be[t]&&Pc(t,n)})},Lc=function(e){return Rt(be[e])?be[e]:e},Pc=function(e,t){e=Lc(e),be[e][0]=to(t,be[e][0],be[e][1])},be={id:[null,E.STRING],className:[null,E.STRING],src:[null,E.FILE],storageName:["doka",E.STRING],maxImagePreviewWidth:[1500,E.INT],maxImagePreviewHeight:[1500,E.INT],imagePreviewScaleMode:["stage",E.STRING],allowPreviewFitToView:[!0,E.BOOLEAN],allowButtonCancel:[!0,E.BOOLEAN],allowButtonConfirm:[!0,E.BOOLEAN],allowButtonReset:[!0,E.BOOLEAN],allowDropFiles:[!1,E.BOOLEAN],allowBrowseFiles:[!0,E.BOOLEAN],allowAutoClose:[!0,E.BOOLEAN],allowAutoDestroy:[!1,E.BOOLEAN],utils:[["crop","filter","color","markup"],E.ARRAY],util:[null,E.STRING],initialState:[null,E.OBJECT],outputData:[!1,E.BOOLEAN],outputFile:[!0,E.BOOLEAN],outputCorrectImageExifOrientation:[!0,E.BOOLEAN],outputStripImageHead:[!0,E.BOOLEAN],outputType:[null,E.STRING],outputQuality:[null,E.INT],outputFit:["cover",E.STRING],outputUpscale:[!0,E.BOOLEAN],outputWidth:[null,E.INT],outputHeight:[null,E.INT],outputCanvasBackgroundColor:[null,E.STRING],outputCanvasMemoryLimit:[Se()&&ze()?16777216:null,E.INT],outputCanvasSyncTarget:[null,E.OBJECT],size:[null,E.OBJECT],sizeMin:[{width:1,height:1},E.OBJECT],sizeMax:[{width:9999,height:9999},E.OBJECT],filter:[null,E.OBJECT],filters:[{original:{label:"Original",matrix:function(){return null}},chrome:{label:"Chrome",matrix:function(){return[1.398,-.316,.065,-.273,.201,-.051,1.278,-.08,-.273,.201,-.051,.119,1.151,-.29,.215,0,0,0,1,0]}},fade:{label:"Fade",matrix:function(){return[1.073,-.015,.092,-.115,-.017,.107,.859,.184,-.115,-.017,.015,.077,1.104,-.115,-.017,0,0,0,1,0]}},mono:{label:"Mono",matrix:function(){return[.212,.715,.114,0,0,.212,.715,.114,0,0,.212,.715,.114,0,0,0,0,0,1,0]}},noir:{label:"Noir",matrix:function(){return[.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,0,0,0,1,0]}}},E.OBJECT],crop:[null,E.OBJECT],cropShowSize:[!1,E.BOOLEAN],cropZoomTimeout:[null,E.INT],cropMask:[null,E.FUNCTION],cropMaskInset:[0,E.INT],cropAllowResizeRect:[!0,E.BOOLEAN],cropAllowImageTurnLeft:[!0,E.BOOLEAN],cropAllowImageTurnRight:[!1,E.BOOLEAN],cropAllowImageFlipHorizontal:[!0,E.BOOLEAN],cropAllowImageFlipVertical:[!0,E.BOOLEAN],cropAllowToggleLimit:[!1,E.BOOLEAN],cropLimitToImageBounds:[!0,E.BOOLEAN],cropAllowInstructionZoom:[!1,E.BOOLEAN],cropAllowRotate:[!0,E.BOOLEAN],cropResizeMatchImageAspectRatio:[!1,E.BOOLEAN],cropResizeKeyCodes:[[18,91,92,93],E.ARRAY],cropResizeScrollRectOnly:[!1,E.BOOLEAN],cropAspectRatio:[null,E.STRING],cropAspectRatioOptions:[null,E.ARRAY],cropMinImageWidth:[1,E.INT],cropMinImageHeight:[1,E.INT],color:[void 0,E.OBJECT],colorBrightness:[0,E.NUMBER],colorBrightnessRange:[[-.25,.25],E.ARRAY],colorContrast:[1,E.NUMBER],colorContrastRange:[[.5,1.5],E.ARRAY],colorExposure:[1,E.NUMBER],colorExposureRange:[[.5,1.5],E.ARRAY],colorSaturation:[1,E.NUMBER],colorSaturationRange:[[0,2],E.ARRAY],markup:[null,E.ARRAY],markupUtil:["select",E.STRING],markupFilter:[function(){return!0},E.FUNCTION],markupAllowAddMarkup:[!0,E.BOOLEAN],markupAllowCustomColor:[!0,E.BOOLEAN],markupDrawDistance:[4,E.NUMBER],markupColor:["#000",E.STRING],markupColorOptions:[[["White","#fff","#f6f6f6"],["Silver","#9e9e9e"],["Black","#000","#333"],["Red","#f44336"],["Orange","#ff9800"],["Yellow","#ffeb3b"],["Green","#4caf50"],["Blue","#2196f3"],["Violet","#3f51b5"],["Purple","#9c27b0"]],E.ARRAY],markupFontSize:[.1,E.NUMBER],markupFontSizeOptions:[[["XL",.15],["L",.125],["M",.1],["S",.075],["XS",.05]],E.ARRAY],markupFontFamily:["Helvetica, Arial, Verdana",E.STRING],markupFontFamilyOptions:[[["Serif","Palatino, 'Times New Roman', serif"],["Sans Serif","Helvetica, Arial, Verdana"],["Monospaced","Monaco, 'Lucida Console', monospaced"]],E.ARRAY],markupShapeStyle:[[.015,null],E.ARRAY],markupShapeStyleOptions:[[["Fill",0,null,0],["Outline thick",.025,null,4],["Outline default",.015,null,2],["Outline thin",.005,null,1],["Outline dashed",.005,[.01],1]],E.ARRAY],markupLineStyle:[[.015,null],E.ARRAY],markupLineStyleOptions:[[["Thick",.025,null,4],["Default",.015,null,2],["Thin",.005,null,1],["Dashed",.005,[.01],1]],E.ARRAY],markupLineDecoration:[["arrow-end"],E.ARRAY],markupLineDecorationOptions:[[["None",[]],["Single arrow",["arrow-end"]],["Double arrow",["arrow-begin","arrow-end"]]],E.ARRAY],stickers:[null,E.ARRAY],beforeReset:[null,E.FUNCTION],beforeLoadImage:[null,E.FUNCTION],beforeCreateBlob:[null,E.FUNCTION],afterCreateBlob:[null,E.FUNCTION],afterCreateOutput:[null,E.FUNCTION],onconfirm:[null,E.FUNCTION],oncancel:[null,E.FUNCTION],onclose:[null,E.FUNCTION],onloadstart:[null,E.FUNCTION],onload:[null,E.FUNCTION],onloaderror:[null,E.FUNCTION],oninit:[null,E.FUNCTION],onready:[null,E.FUNCTION],onupdate:[null,E.FUNCTION],ondestroy:[null,E.FUNCTION],labelButtonReset:["Reset",E.STRING],labelButtonCancel:["Cancel",E.STRING],labelButtonConfirm:["Done",E.STRING],labelButtonUtilCrop:["Crop",E.STRING],labelButtonUtilResize:["Resize",E.STRING],labelButtonUtilFilter:["Filter",E.STRING],labelButtonUtilColor:["Colors",E.STRING],labelButtonUtilMarkup:["Markup",E.STRING],labelButtonUtilSticker:["Stickers",E.STRING],labelStatusMissingWebGL:["WebGL is required but is disabled on your browser",E.STRING],labelStatusAwaitingImage:["Waiting for image\u2026",E.STRING],labelStatusLoadImageError:["Error loading image\u2026",E.STRING],labelStatusLoadingImage:["Loading image\u2026",E.STRING],labelStatusProcessingImage:["Processing image\u2026",E.STRING],labelColorBrightness:["Brightness",E.STRING],labelColorContrast:["Contrast",E.STRING],labelColorExposure:["Exposure",E.STRING],labelColorSaturation:["Saturation",E.STRING],labelMarkupTypeRectangle:["Square",E.STRING],labelMarkupTypeEllipse:["Circle",E.STRING],labelMarkupTypeText:["Text",E.STRING],labelMarkupTypeLine:["Arrow",E.STRING],labelMarkupSelectFontSize:["Size",E.STRING],labelMarkupSelectFontFamily:["Font",E.STRING],labelMarkupSelectLineDecoration:["Decoration",E.STRING],labelMarkupSelectLineStyle:["Style",E.STRING],labelMarkupSelectShapeStyle:["Style",E.STRING],labelMarkupRemoveShape:["Remove",E.STRING],labelMarkupToolSelect:["Select",E.STRING],labelMarkupToolDraw:["Draw",E.STRING],labelMarkupToolLine:["Arrow",E.STRING],labelMarkupToolText:["Text",E.STRING],labelMarkupToolRect:["Square",E.STRING],labelMarkupToolEllipse:["Circle",E.STRING],labelResizeWidth:["Width",E.STRING],labelResizeHeight:["Height",E.STRING],labelResizeApplyChanges:["Apply",E.STRING],labelCropInstructionZoom:["Zoom in and out with your scroll wheel or touchpad.",E.STRING],labelButtonCropZoom:["Zoom",E.STRING],labelButtonCropRotateLeft:["Rotate left",E.STRING],labelButtonCropRotateRight:["Rotate right",E.STRING],labelButtonCropRotateCenter:["Center rotation",E.STRING],labelButtonCropFlipHorizontal:["Flip horizontal",E.STRING],labelButtonCropFlipVertical:["Flip vertical",E.STRING],labelButtonCropAspectRatio:["Aspect ratio",E.STRING],labelButtonCropToggleLimit:["Crop selection",E.STRING],labelButtonCropToggleLimitEnable:["Limited to image",E.STRING],labelButtonCropToggleLimitDisable:["Select outside image",E.STRING],pointerEventsPolyfillScope:["root",E.STRING],styleCropCorner:["circle",E.STRING],styleFullscreenSafeArea:[Se()&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",E.STRING],styleLayoutMode:[null,E.STRING]},Ht=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(n,Math.max(t,e))},N=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10;return parseFloat(e.toFixed(t))},Gc=function(e,t){return N(e.x)===N(t.x)&&N(e.y)===N(t.y)},$r=function(e,t){return{x:N(e.x,t),y:N(e.y,t)}},wr=function(e,t){return Mt(e.x-t.x,e.y-t.y)},kc=function(e,t){return e.x*t.x+e.y*t.y},Kn=function(e,t){return kc(wr(e,t),wr(e,t))},cn=function(e,t){return Math.sqrt(Kn(e,t))},Dc=function(e,t){var n=wr(e,t);return Math.atan2(n.y,n.x)},eo=function(e,t){return Mt(Ht(e.x,t.x,t.x+t.width),Ht(e.y,t.y,t.y+t.height))},wt=function(e,t,n){var r=Math.cos(t),i=Math.sin(t),o=Mt(e.x-n.x,e.y-n.y);return Mt(n.x+r*o.x-i*o.y,n.y+i*o.x+r*o.y)},Mt=function(){return{x:arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,y:arguments.length>1&&arguments[1]!==void 0?arguments[1]:0}},no=function(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},Uc=function(e,t){var n=Zt(e),r=Zt(t);return n.left>=r.left&&n.top>=r.top&&n.bottom<=r.bottom&&n.right<=r.right},Vc=function(e,t,n){return t===0?{tl:e.tl,tr:e.tr,br:e.br,bl:e.bl}:{tl:wt(e.tl,t,n),tr:wt(e.tr,t,n),br:wt(e.br,t,n),bl:wt(e.bl,t,n)}},Nc=function(e,t,n){var r=Vc(Qn(e),t,n),i=r.tl,o=r.tr,a=r.br,l=r.bl,u=Math.min(i.x,o.x,a.x,l.x),c=Math.min(i.y,o.y,a.y,l.y),s=Math.max(i.x,o.x,a.x,l.x),d=Math.max(i.y,o.y,a.y,l.y);return Xt(u,c,s-u,d-c)},Bc=function(e,t,n){return Xt(t*(e.x-n.x)+n.x,t*(e.y-n.y)+n.y,t*e.width,t*e.height)},mn=function(e,t){return Xt(e.x+t.x,e.y+t.y,e.width,e.height)},Fc={translate:mn,rotate:Nc,scale:Bc},zc=function(e,t,n){return t.reduce(function(r,i){return(0,Fc[i[0]])(r,i[1],n)},e)},Tr=function(e){return Xt(e.x,e.y,e.width,e.height)},Zt=function(e){return{top:e.y,right:e.x+e.width,bottom:e.y+e.height,left:e.x}},xe=function(e){var t=e.top,n=e.right,r=e.bottom,i=e.left;return{x:i,y:t,width:n-i,height:r-t}},Lt=function(e){return Mt(e.x+.5*e.width,e.y+.5*e.height)},Qn=function(e){return{tl:{x:e.x,y:e.y},tr:{x:e.x+e.width,y:e.y},br:{x:e.x+e.width,y:e.y+e.height},bl:{x:e.x,y:e.y+e.height}}},Xt=function(e,t,n,r){return{x:e,y:t,width:n,height:r}},ke=function(e){if(Sr(e))return e;if(/:/.test(e)){var t=e.split(":"),n=t[0];return t[1]/n}return parseFloat(e)},he=function(e,t){var n=e.width,r=n*t;return r>e.height&&(n=(r=e.height)/t),{x:.5*(e.width-n),y:.5*(e.height-r),width:n,height:r}},Rr=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=e.height/e.width,i=t,o=1,a=r;a>i&&(o=(a=i)/r);var l=Math.max(1/o,i/a),u=e.width/(n*l*o);return{width:u,height:u*t}},dn=function(e,t){return{x:e,y:t}},Hc=function(e,t){return e.x*t.x+e.y*t.y},jr=function(e,t){return dn(e.x-t.x,e.y-t.y)},Wc=function(e,t){return Hc(jr(e,t),jr(e,t))},Kr=function(e,t){return Math.sqrt(Wc(e,t))},Qr=function(e,t){var n=e,r=t,i=1.5707963267948966-t,o=Math.sin(1.5707963267948966),a=Math.sin(r),l=Math.sin(i),u=Math.cos(i),c=n/o;return dn(u*(c*a),u*(c*l))},qc=function(e,t){var n=e.width,r=e.height,i=Qr(n,t),o=Qr(r,t),a=dn(e.x+Math.abs(i.x),e.y-Math.abs(i.y)),l=dn(e.x+e.width+Math.abs(o.y),e.y+Math.abs(o.x)),u=dn(e.x-Math.abs(o.y),e.y+e.height-Math.abs(o.x));return{width:Kr(a,l),height:Kr(a,u)}},Fe=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{x:.5,y:.5},i=r.x>.5?1-r.x:r.x,o=r.y>.5?1-r.y:r.y,a=2*i*e.width,l=2*o*e.height,u=qc(t,n);return Math.max(u.width/a,u.height/l)},De=function(e,t){var n=t.origin,r=t.translation,i=t.scale;return zc(e,[["scale",i],["translate",r]],n)},Jr=function(e,t){var n=e,r=t,i=1.5707963267948966-t,o=Math.sin(1.5707963267948966),a=Math.sin(r),l=Math.sin(i),u=Math.cos(i),c=n/o;return Mt(u*(c*a),u*(c*l))},Yc=function(e,t){var n=e.width,r=e.height,i=t%(Math.PI/2),o=Jr(n,i),a=Jr(r,i),l=Qn(e);return{tl:Mt(l.tl.x+Math.abs(o.x),l.tl.y-Math.abs(o.y)),tr:Mt(l.tr.x+Math.abs(a.y),l.tr.y+Math.abs(a.x)),br:Mt(l.br.x-Math.abs(o.x),l.br.y+Math.abs(o.y)),bl:Mt(l.bl.x-Math.abs(a.y),l.bl.y-Math.abs(a.x))}},Jn=function(e,t,n,r){var i={x:e.x+t.x,y:e.y+t.y},o=Yc(r,n),a=wt(o.tl,-n,i),l=wt(o.tr,-n,i),u=wt(o.br,-n,i);return Xt(Math.min(a.x,l.x,u.x),Math.min(a.y,l.y,u.y),Math.max(a.x,l.x,u.x)-Math.min(a.x,l.x,u.x),Math.max(a.y,l.y,u.y)-Math.min(a.y,l.y,u.y))},ro=function(e,t,n){var r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],i=n.origin,o=n.translation,a=De(e,n),l=2*Math.PI+n.rotation%(2*Math.PI),u=Jn(i,o,l,t),c=Lt(u),s=t.height/t.width,d={x:(c.x-a.x)/a.width,y:(c.y-a.y)/a.height},f=d.y>.5?1-d.y:d.y,h=2*(d.x>.5?1-d.x:d.x)*a.width,p=2*f*a.height;return{center:d,zoom:r?Math.min(h/u.width,p/u.height):Math.min(a.width/u.width,a.height/u.height),rotation:n.rotation,aspectRatio:s,scaleToFit:r}},io=function(e,t){var n=oo(e,t);return{center:{x:N(n.center.x),y:N(n.center.y)},rotation:N(n.rotation),zoom:N(n.zoom),aspectRatio:N(n.aspectRatio),flip:I({},t.flip),scaleToFit:n.scaleToFit}},oo=function(e,t){var n=ro(e,t.rectangle,t.transforms,t.limitToImageBounds);return{center:{x:n.center.x,y:n.center.y},rotation:n.rotation,zoom:n.zoom,aspectRatio:n.aspectRatio,flip:I({},t.flip),scaleToFit:n.scaleToFit}},Ue=function(e,t,n,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"width",o=e.width,a=e.height;return!o&&!a?{width:o,height:a}:(o=o&&Ht(o,t.width,n.width),a=a&&Ht(a,t.height,n.height),r?(a?o?i==="width"?a=o/r:i==="height"?o=a*r:(a*r<t.width?a=(o=t.width)/r:o/r<t.height&&(o=(a=t.height)*r),a*r>n.width?a=(o=n.width)/r:o/r>n.height&&(o=(a=n.height)*r)):a=Ht(a*r,t.width,n.width)/r:o=Ht(o/r,t.height,n.height)*r,{width:o,height:a}):{width:o,height:a})},Zc=function(e,t){var n=new Array(20);return n[0]=e[0]*t[0]+e[1]*t[5]+e[2]*t[10]+e[3]*t[15],n[1]=e[0]*t[1]+e[1]*t[6]+e[2]*t[11]+e[3]*t[16],n[2]=e[0]*t[2]+e[1]*t[7]+e[2]*t[12]+e[3]*t[17],n[3]=e[0]*t[3]+e[1]*t[8]+e[2]*t[13]+e[3]*t[18],n[4]=e[0]*t[4]+e[1]*t[9]+e[2]*t[14]+e[3]*t[19]+e[4],n[5]=e[5]*t[0]+e[6]*t[5]+e[7]*t[10]+e[8]*t[15],n[6]=e[5]*t[1]+e[6]*t[6]+e[7]*t[11]+e[8]*t[16],n[7]=e[5]*t[2]+e[6]*t[7]+e[7]*t[12]+e[8]*t[17],n[8]=e[5]*t[3]+e[6]*t[8]+e[7]*t[13]+e[8]*t[18],n[9]=e[5]*t[4]+e[6]*t[9]+e[7]*t[14]+e[8]*t[19]+e[9],n[10]=e[10]*t[0]+e[11]*t[5]+e[12]*t[10]+e[13]*t[15],n[11]=e[10]*t[1]+e[11]*t[6]+e[12]*t[11]+e[13]*t[16],n[12]=e[10]*t[2]+e[11]*t[7]+e[12]*t[12]+e[13]*t[17],n[13]=e[10]*t[3]+e[11]*t[8]+e[12]*t[13]+e[13]*t[18],n[14]=e[10]*t[4]+e[11]*t[9]+e[12]*t[14]+e[13]*t[19]+e[14],n[15]=e[15]*t[0]+e[16]*t[5]+e[17]*t[10]+e[18]*t[15],n[16]=e[15]*t[1]+e[16]*t[6]+e[17]*t[11]+e[18]*t[16],n[17]=e[15]*t[2]+e[16]*t[7]+e[17]*t[12]+e[18]*t[17],n[18]=e[15]*t[3]+e[16]*t[8]+e[17]*t[13]+e[18]*t[18],n[19]=e[15]*t[4]+e[16]*t[9]+e[17]*t[14]+e[18]*t[19]+e[19],n},vn=function(e){var t;if(/^#/.test(e)){if(e.length===4){var n=e.split("");e="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]}var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);t=[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]}else/^rgb/.test(e)&&((t=e.match(/\d+/g).map(function(i){return parseInt(i,10)})).length=3);return t},ti=[],ao=function(e){var t=[];return ht(e,function(n,r){return t.push(r)}),t.length?t.reduce(function(n,r){return Zc(Ft(n),r)},t.shift()):[]},lo=function(e){return e.crop.draft.transforms?e.crop.draft.transforms.scale:e.crop.transforms.scale},ei=function(e){var t=e.image.width/e.image.naturalWidth,n=lo(e);return{width:e.options.cropMinImageWidth*n*t,height:e.options.cropMinImageHeight*n*t}},ni=function(e){var t=lo(e);return{width:e.image.width*t,height:e.image.height*t}},Xc=function(e){return e.options.size?e.options.size.width:null},$c=function(e){return e.options.size?e.options.size.height:null},jc=function(e){return e.size.width===!1?Xc(e):e.size.width},Kc=function(e){return e.size.height===!1?$c(e):e.size.height},ri=function(e){return e.options.cropAspectRatioOptions?e.options.cropAspectRatioOptions.map(function(t){var n={aspectRatio:null,width:null,height:null};return typeof t.value=="number"&&(n.aspectRatio=t.value),typeof t.value=="string"&&(n.aspectRatio=ke(t.value)),ne(t.value)==="object"&&t.value!==null&&(n.width=t.value.width,n.height=t.value.height,n.aspectRatio=n.height/n.width),{label:t.label,value:n}}):null},Qc=function(e,t){t.aspectRatio||(t.aspectRatio=e.image.height/e.image.width);var n=co(e.image,t,t.scaleToFit),r=n.width/n.height;return e.stage.width<n.width&&(n.width=e.stage.width,n.height=n.width/r),e.stage.height<n.height&&(n.height=e.stage.height,n.width=n.height*r),Xt(.5*e.stage.width-.5*n.width,.5*e.stage.height-.5*n.height,n.width,n.height)},or=function(e){var t=e.image.naturalWidth,n=e.image.naturalHeight,r=n/t;return e.stage.width<t&&(n=r*(t=e.stage.width)),e.stage.height<n&&(t=(n=e.stage.height)/r),Xt(.5*e.stage.width-.5*t,.5*e.stage.height-.5*n,t,n)},Jc=function(e){return{GET_SIZE:function(){return e.size.width!==!1&&e.size.height!==!1?{width:e.size.width,height:e.size.height}:{width:null,height:null}},GET_SIZE_INPUT:function(){return{width:e.size.width,height:e.size.height}},GET_SIZE_ASPECT_RATIO_LOCK:function(){return e.size.aspectRatioLocked},IS_ACTIVE_VIEW:function(t){return e.activeView===t},GET_ACTIVE_VIEW:function(){return e.activeView},GET_STYLES:function(){return Object.keys(e.options).filter(function(t){return/^style/.test(t)}).map(function(t){return{name:t,value:e.options[t]}})},GET_FILE:function(){return e.file},GET_IMAGE:function(){return e.image},GET_STAGE:function(){return I({},e.stage,e.stageOffset)},GET_STAGE_RECT:function(t){var n,r=e.options.imagePreviewScaleMode;return(n=r==="crop"?t?Qc(e,t):or(e):r==="image"?or(e):I({},e.stage)).fits=n.width<e.stage.width&&n.height<e.stage.height,n.mode=r,n},GET_IMAGE_STAGE_RECT:function(){return or(e)},GET_ROOT:function(){return e.rootRect},GET_ROOT_SIZE:function(){return{width:e.rootRect.width,height:e.rootRect.height}},GET_MIN_IMAGE_SIZE:function(){return{width:e.options.cropMinImageWidth,height:e.options.cropMinImageHeight}},GET_IMAGE_PREVIEW_SCALE_FACTOR:function(){return e.image.width/e.image.naturalWidth},GET_MIN_PREVIEW_IMAGE_SIZE:function(){var t=e.image.width/e.image.naturalWidth;return{width:e.options.cropMinImageWidth*t,height:e.options.cropMinImageHeight*t}},GET_MIN_CROP_SIZE:function(){return ei(e)},GET_MAX_CROP_SIZE:function(){return ni(e)},GET_MIN_PIXEL_CROP_SIZE:function(){var t=e.crop.transforms.scale,n=ei(e);return{width:n.width/t,height:n.height/t}},GET_MAX_PIXEL_CROP_SIZE:function(){var t=e.crop.transforms.scale,n=ni(e);return{width:n.width/t,height:n.height/t}},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return ri(e)},GET_ACTIVE_CROP_ASPECT_RATIO:function(){var t=e.crop.aspectRatio;return Rt(t)?ke(t):t},GET_CROP_ASPECT_RATIO:function(){var t=Rt(e.options.cropAspectRatio)?ke(e.options.cropAspectRatio):e.options.cropAspectRatio,n=ri(e);return!n||n&&!n.length||n.find(function(r){return r.value.aspectRatio===t})?t:n[0].value.aspectRatio},GET_CROP_RECTANGLE_ASPECT_RATIO:function(){var t=e.crop,n=t.rectangle,r=t.aspectRatio;return n?n.width/n.height:r},GET_CROP_RECT:function(){return I({},e.crop.rectangle)},GET_CROP:function(t,n){var r=ti[t];if(r&&r.ts===n)return r;var i=ru(e);return i&&(i.ts=n,ti[t]=i),i},GET_COLOR_MATRIX:function(){return ao(e.colorMatrices)},GET_COLOR_VALUES:function(){return I({exposure:e.options.colorExposure,brightness:e.options.colorBrightness,contrast:e.options.colorContrast,saturation:e.options.colorSaturation},e.colorValues)},GET_MARKUP_TOOL_VALUES:function(){return I({color:e.options.markupColor,fontFamily:e.options.markupFontFamily,fontSize:e.options.markupFontSize,shapeStyle:e.options.markupShapeStyle,lineStyle:e.options.markupLineStyle,lineDecoration:e.options.markupLineDecoration},e.markupToolValues)},GET_PREVIEW_IMAGE_DATA:function(){return e.file.preview},GET_THUMB_IMAGE_DATA:function(){return e.file.thumb},GET_FILTER:function(){return e.filter},GET_UID:function(){return e.uid},GET_MARKUP_BY_ID:function(t){return e.markup.find(function(n){return n[1].id===t})},GET_BACKGROUND_COLOR:function(){var t=e.options.outputCanvasBackgroundColor;if(!t)return tu;if(On[t])return On[t];var n=vn(t);return On[t]=n.concat(1),On[t]}}},On={},tu=[0,0,0,0],eu=function(e,t){var n=jc(e),r=Kc(e),i=t.width/t.height;return Ue({width:n,height:r},e.options.sizeMin,e.options.sizeMax,i)},co=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],r=t.zoom,i=t.rotation,o=t.center,a=t.aspectRatio,l=Rr(e,a,r),u={x:.5*l.width,y:.5*l.height},c={x:0,y:0,width:l.width,height:l.height,center:u},s=r*Fe(e,he(c,a),i,n?o:{x:.5,y:.5});return{widthFloat:l.width/s,heightFloat:l.height/s,width:Math.round(l.width/s),height:Math.round(l.height/s)}},nu=function(e,t){var n=Lt(t),r=Lt(e);return!Gc(r,n)},ru=function(e){if(!e.stage||!e.image)return null;var t=e.crop.draft.rectangle||{free:e.crop.rectangle,limited:e.crop.rectangle},n=e.crop.draft.transforms||e.crop.transforms,r=n.origin,i=n.translation,o=n.scale,a=n.interaction,l=e.crop.rotation,u=e.crop.flip,c=!(!e.crop.draft.rectangle&&!e.crop.draft.transforms),s=c||e.instantUpdate,d=nu(t.limited,e.stage),f=e.crop.isDirty||c,h=e.crop.isRotating,p=e.crop.limitToImageBounds===void 0||e.crop.limitToImageBounds,g={width:e.image.naturalWidth,height:e.image.naturalHeight},m=ao(e.colorMatrices),_=oo(e.image,{rectangle:t.limited,transforms:{origin:r,translation:i,scale:o,rotation:l.main+l.sub},flip:u,limitToImageBounds:e.crop.limitToImageBounds}),y={props:_,crop:co(g,_,e.crop.limitToImageBounds),image:eu(e,t.limited)},v=y.image,T=y.crop,A=T.width,R=T.height,x=T.widthFloat/T.heightFloat;v.width&&v.height?(A=v.width,R=v.height):v.width&&!v.height?(A=v.width,R=v.width/x):v.height&&!v.width&&(R=v.height,A=v.height*x),y.currentWidth=Math.round(A),y.currentHeight=Math.round(R);var b={x:0,y:0},O=0,C=0;if(s&&a){if(a.translation){var M=a.translation.x-i.x,S=a.translation.y-i.y;b.x=100*Math.sign(M)*Math.log10(1+Math.abs(M)/100),b.y=100*Math.sign(S)*Math.log10(1+Math.abs(S)/100)}if(a.scale){var V=a.scale-o;O=.25*Math.sign(V)*Math.log10(1+Math.abs(V)/.25)}if(a.rotation){var B=a.rotation-(l.main+l.sub);C=.05*Math.sign(B)*Math.log10(1+Math.abs(B)/.05)}}var U={},q=t.free,L=Zt(q),k=Zt(t.limited);return ht(L,function(H){var F=L[H]-k[H];U[H]=k[H]+5*Math.sign(F)*Math.log10(1+Math.abs(F)/5)}),{canRecenter:d,canReset:f,isDraft:s,isRotating:h,isLimitedToImageBounds:p,cropRect:{x:U.left,y:U.top,width:U.right-U.left,height:U.bottom-U.top},origin:r,translation:i,translationBand:b,scale:o,scaleBand:O,rotation:l,rotationBand:C,flip:u,interaction:a,cropStatus:y,colorMatrix:m,markup:e.markup,previewSize:{width:e.image.width,height:e.image.height}}},Mr=function(e){return/^image/.test(e)},iu={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},uo=function(e,t,n){return n===-1&&(n=1),iu[n](e,t)},zn=function(e){e.width=1,e.height=1,e.getContext("2d").clearRect(0,0,1,1)},ii=function(e){return e&&(e.horizontal||e.vertical)},ou=function(e,t,n){if(t<=1&&!ii(n))return e.width=e.naturalWidth,e.height=e.naturalHeight,e;var r=document.createElement("canvas"),i=e.naturalWidth,o=e.naturalHeight,a=t>=5&&t<=8;a?(r.width=o,r.height=i):(r.width=i,r.height=o);var l=r.getContext("2d");if(t&&l.transform.apply(l,uo(i,o,t)),ii(n)){var u=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(u[0]=-1,u[4]=i),(!a&&n.vertical||a&&n.horizontal)&&(u[3]=-1,u[5]=o),l.transform.apply(l,u)}return l.drawImage(e,0,0,i,o),r},au=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=r.canvasMemoryLimit,o=r.background,a=o===void 0?null:o,l=n.zoom||1,u=ou(e,t,n.flip),c={width:u.width,height:u.height},s=n.aspectRatio||c.height/c.width,d=Rr(c,s,l);if(i){var f=d.width*d.height;if(f>i){var h=Math.sqrt(i)/Math.sqrt(f);c.width=Math.floor(c.width*h),c.height=Math.floor(c.height*h),d=Rr(c,s,l)}}var p=document.createElement("canvas"),g={x:.5*d.width,y:.5*d.height},m={x:0,y:0,width:d.width,height:d.height,center:g},_=n.scaleToFit===void 0||n.scaleToFit,y=l*Fe(c,he(m,s),n.rotation,_?n.center:{x:.5,y:.5});p.width=Math.round(d.width/y),p.height=Math.round(d.height/y),g.x/=y,g.y/=y;var v=g.x-c.width*(n.center?n.center.x:.5),T=g.y-c.height*(n.center?n.center.y:.5),A=p.getContext("2d");a&&(A.fillStyle=a,A.fillRect(0,0,p.width,p.height)),A.translate(g.x,g.y),A.rotate(n.rotation||0),A.drawImage(u,v-g.x,T-g.y,c.width,c.height);var R=A.getImageData(0,0,p.width,p.height);return zn(p),R},lu=typeof window<"u"&&window.document!==void 0;lu&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){var r=this.toDataURL(t,n).split(",")[1];setTimeout(function(){for(var i=atob(r),o=i.length,a=new Uint8Array(o),l=0;l<o;l++)a[l]=i.charCodeAt(l);e(new Blob([a],{type:t||"image/png"}))})}}));var cu=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return new Promise(function(r){var i=n?n(e):e;Promise.resolve(i).then(function(o){o.toBlob(r,t.type,t.quality)})})},Hn=function(e,t){return yn(e.x*t,e.y*t)},Wn=function(e,t){return yn(e.x+t.x,e.y+t.y)},so=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return t===0?{x:0,y:0}:yn(e.x/t,e.y/t)},fe=function(e,t,n){var r=Math.cos(t),i=Math.sin(t),o=yn(e.x-n.x,e.y-n.y);return yn(n.x+r*o.x-i*o.y,n.y+i*o.x+r*o.y)},yn=function(){return{x:arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,y:arguments.length>1&&arguments[1]!==void 0?arguments[1]:0}},mt=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;return typeof e=="string"?parseFloat(e)*n:typeof e=="number"?e*(r?t[r]:Math.min(t.width,t.height)):void 0},ge=function(e,t,n){var r=e.borderStyle||e.lineStyle||"solid",i=e.backgroundColor||e.fontColor||"transparent",o=e.borderColor||e.lineColor||"transparent",a=mt(e.borderWidth||e.lineWidth,t,n);return{"stroke-linecap":e.lineCap||"round","stroke-linejoin":e.lineJoin||"round","stroke-width":a||0,"stroke-dasharray":typeof r=="string"?"":r.map(function(l){return mt(l,t,n)}).join(","),stroke:o,fill:i,opacity:e.opacity||1}},St=function(e){return e!=null},He=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=mt(e.x,t,n,"width")||mt(e.left,t,n,"width"),i=mt(e.y,t,n,"height")||mt(e.top,t,n,"height"),o=mt(e.width,t,n,"width"),a=mt(e.height,t,n,"height"),l=mt(e.right,t,n,"width"),u=mt(e.bottom,t,n,"height");return St(i)||(i=St(a)&&St(u)?t.height-a-u:u),St(r)||(r=St(o)&&St(l)?t.width-o-l:l),St(o)||(o=St(r)&&St(l)?t.width-r-l:0),St(a)||(a=St(i)&&St(u)?t.height-i-u:0),{x:r||0,y:i||0,width:o||0,height:a||0}},Ar=function(e){return e.map(function(t,n){return"".concat(n===0?"M":"L"," ").concat(t.x," ").concat(t.y)}).join(" ")},It=function(e,t){return Object.keys(t).forEach(function(n){return e.setAttribute(n,t[n])})},uu="http://www.w3.org/2000/svg",Bt=function(e,t){var n=document.createElementNS(uu,e);return t&&It(n,t),n},su=function(e){return It(e,I({},e.rect,e.styles))},du=function(e){var t=e.rect.x+.5*e.rect.width,n=e.rect.y+.5*e.rect.height,r=.5*e.rect.width,i=.5*e.rect.height;return It(e,I({cx:t,cy:n,rx:r,ry:i},e.styles))},fu={contain:"xMidYMid meet",cover:"xMidYMid slice"},pu=function(e,t){It(e,I({},e.rect,e.styles,{preserveAspectRatio:fu[t.fit]||"none"}))},hu={left:"start",center:"middle",right:"end"},gu=function(e,t,n,r){var i=mt(t.fontSize,n,r),o=t.fontFamily||"sans-serif",a=t.fontWeight||"normal",l=hu[t.textAlign]||"start";It(e,I({},e.rect,e.styles,{"stroke-width":0,"font-weight":a,"font-size":i,"font-family":o,"text-anchor":l})),e.text!==t.text&&(e.text=t.text,e.textContent=t.text.length?t.text:" ")},mu=function(e,t,n,r){It(e,I({},e.rect,e.styles,{fill:"none"}));var i=e.childNodes[0],o=e.childNodes[1],a=e.childNodes[2],l=e.childNodes[3],u=e.rect,c={x:e.rect.x+e.rect.width,y:e.rect.y+e.rect.height};if(It(i,{x1:u.x,y1:u.y,x2:c.x,y2:c.y}),It(l,{x1:u.x,y1:u.y,x2:c.x,y2:c.y}),t.lineDecoration){o.style.display="none",a.style.display="none";var s=so({x:c.x-u.x,y:c.y-u.y}),d=mt(.05,n,r);if(t.lineDecoration.indexOf("arrow-begin")!==-1){var f=Hn(s,d),h=Wn(u,f),p=fe(u,2,h),g=fe(u,-2,h);It(o,{style:"display:block;",d:"M".concat(p.x,",").concat(p.y," L").concat(u.x,",").concat(u.y," L").concat(g.x,",").concat(g.y)})}if(t.lineDecoration.indexOf("arrow-end")!==-1){var m=Hn(s,-d),_=Wn(c,m),y=fe(c,2,_),v=fe(c,-2,_);It(a,{style:"display:block;",d:"M".concat(y.x,",").concat(y.y," L").concat(c.x,",").concat(c.y," L").concat(v.x,",").concat(v.y)})}}},vu=function(e,t,n,r){It(e,I({},e.styles,{fill:"none"}));var i=e.childNodes[0],o=e.childNodes[1],a=Ar(t.points.map(function(l){return{x:mt(l.x,n,r,"width"),y:mt(l.y,n,r,"height")}}));It(i,{d:a}),It(o,{d:a})},ar=function(e){return function(t){return Bt(e,{id:t.id})}},yu=function(e){var t=Bt("image",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return t.onload=function(){t.setAttribute("opacity",e.opacity||1)},t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.src),t},_u=function(e){var t=Bt("g",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=Bt("line");t.appendChild(n);var r=Bt("path");t.appendChild(r);var i=Bt("path");t.appendChild(i);var o=Bt("line",{style:"stroke-width: 40; stroke-opacity: 0;"});return t.appendChild(o),t},Eu=function(e){var t=Bt("g",{id:e.id}),n=Bt("path");t.appendChild(n);var r=Bt("path",{style:"stroke-width: 40; stroke-opacity: 0;"});return t.appendChild(r),t},wu={image:yu,rect:ar("rect"),ellipse:ar("ellipse"),text:ar("text"),path:Eu,line:_u},Tu={rect:su,ellipse:du,image:pu,text:gu,path:vu,line:mu},Lr=function(e,t){return wu[e](t)},Pr=function(e,t,n,r,i){t!=="path"&&(e.rect=He(n,r,i)),e.styles=ge(n,r,i),Tu[t](e,n,r,i)},_n=function(e,t){return e[1].zIndex>t[1].zIndex?1:e[1].zIndex<t[1].zIndex?-1:0},Ru=function(e,t,n,r){return new Promise(function(i){var o=r.background,a=o===void 0?null:o,l=new FileReader;l.onloadend=function(){var u=l.result,c=document.createElement("div");c.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",c.innerHTML=u;var s=c.querySelector("svg");document.body.appendChild(c);var d=s.getBBox();c.parentNode.removeChild(c);var f=c.querySelector("title"),h=s.getAttribute("viewBox")||"",p=s.getAttribute("width")||"",g=s.getAttribute("height")||"",m=parseFloat(p)||null,_=parseFloat(g)||null,y=(p.match(/[a-z]+/)||[])[0]||"",v=(g.match(/[a-z]+/)||[])[0]||"",T=h.split(" ").map(parseFloat),A=T.length?{x:T[0],y:T[1],width:T[2],height:T[3]}:d,R=m!=null?m:A.width,x=_!=null?_:A.height;s.style.overflow="visible",s.setAttribute("width",R),s.setAttribute("height",x);var b="";if(n&&n.length){var O={width:R,height:x};b=n.sort(_n).reduce(function(rt,nt){var ot=Lr(nt[0],nt[1]);return Pr(ot,nt[0],nt[1],O),ot.removeAttribute("id"),ot.getAttribute("opacity")===1&&ot.removeAttribute("opacity"),rt+`
`+ot.outerHTML+`
`},""),b=`

<g>`.concat(b.replace(/&nbsp;/g," "),`</g>

`)}var C=t.aspectRatio||x/R,M=R,S=M*C,V=t.scaleToFit===void 0||t.scaleToFit,B=Fe({width:R,height:x},he({width:M,height:S},C),t.rotation,V?t.center:{x:.5,y:.5}),U=t.zoom*B,q=t.rotation*(180/Math.PI),L={x:.5*M,y:.5*S},k={x:L.x-R*t.center.x,y:L.y-x*t.center.y},H=["rotate(".concat(q," ").concat(L.x," ").concat(L.y,")"),"translate(".concat(L.x," ").concat(L.y,")"),"scale(".concat(U,")"),"translate(".concat(-L.x," ").concat(-L.y,")"),"translate(".concat(k.x," ").concat(k.y,")")],F=["scale(".concat(t.flip.horizontal?-1:1," ").concat(t.flip.vertical?-1:1,")"),"translate(".concat(t.flip.horizontal?-R:0," ").concat(t.flip.vertical?-x:0,")")],P=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="`.concat(M).concat(y,'" height="').concat(S).concat(v,`" 
viewBox="0 0 `).concat(M," ").concat(S,'" ').concat(a?'style="background:'+a+'" ':"",`
preserveAspectRatio="xMinYMin"
xmlns:xlink="http://www.w3.org/1999/xlink"
xmlns="http://www.w3.org/2000/svg">
<!-- Generated by PQINA - https://pqina.nl/ -->
<title>`).concat(f?f.textContent:"",`</title>
<g transform="`).concat(H.join(" "),`">
<g transform="`).concat(F.join(" "),`">
`).concat(s.outerHTML).concat(b,`
</g>
</g>
</svg>`);i(P)},l.readAsText(e)})},Au=function(e){var t;try{t=new ImageData(e.width,e.height)}catch{t=document.createElement("canvas").getContext("2d").createImageData(e.width,e.height)}return t.data.set(e.data),t},fo=function(){var e={resize:function(c,s){var d=s.mode,f=d===void 0?"contain":d,h=s.upscale,p=h!==void 0&&h,g=s.width,m=s.height,_=s.matrix;if(_=!_||l(_)?null:_,!g&&!m)return u(c,_);if(g===null?g=m:m===null&&(m=g),f!=="force"){var y=g/c.width,v=m/c.height,T=1;if(f==="cover"?T=Math.max(y,v):f==="contain"&&(T=Math.min(y,v)),T>1&&p===!1)return u(c,_);g=c.width*T,m=c.height*T}for(var A=c.width,R=c.height,x=Math.round(g),b=Math.round(m),O=c.data,C=new Uint8ClampedArray(x*b*4),M=A/x,S=R/b,V=Math.ceil(.5*M),B=Math.ceil(.5*S),U=0;U<b;U++)for(var q=0;q<x;q++){for(var L=4*(q+U*x),k=0,H=0,F=0,P=0,rt=0,nt=0,ot=0,at=(U+.5)*S,W=Math.floor(U*S);W<(U+1)*S;W++)for(var ft=Math.abs(at-(W+.5))/B,lt=(q+.5)*M,bt=ft*ft,yt=Math.floor(q*M);yt<(q+1)*M;yt++){var gt=Math.abs(lt-(yt+.5))/V,et=Math.sqrt(bt+gt*gt);if(et>=-1&&et<=1&&(k=2*et*et*et-3*et*et+1)>0){var _t=O[(gt=4*(yt+W*A))+3];ot+=k*_t,F+=k,_t<255&&(k=k*_t/250),P+=k*O[gt],rt+=k*O[gt+1],nt+=k*O[gt+2],H+=k}}C[L]=P/H,C[L+1]=rt/H,C[L+2]=nt/H,C[L+3]=ot/F,_&&o(L,C,_)}return{data:C,width:x,height:b}},filter:u},t=function(c,s){var d=c.transforms,f=null;if(d.forEach(function(p){p.type==="filter"&&(f=p)}),f){var h=null;d.forEach(function(p){p.type==="resize"&&(h=p)}),h&&(h.data.matrix=f.data,d=d.filter(function(p){return p.type!=="filter"}))}s(function(p,g){return p.forEach(function(m){g=e[m.type](g,m.data)}),g}(d,c.imageData))};self.onmessage=function(c){t(c.data.message,function(s){self.postMessage({id:c.data.id,message:s},[s.data.buffer])})};var n=1,r=1,i=1;function o(c,s,d){var f=s[c]/255,h=s[c+1]/255,p=s[c+2]/255,g=s[c+3]/255,m=f*d[0]+h*d[1]+p*d[2]+g*d[3]+d[4],_=f*d[5]+h*d[6]+p*d[7]+g*d[8]+d[9],y=f*d[10]+h*d[11]+p*d[12]+g*d[13]+d[14],v=f*d[15]+h*d[16]+p*d[17]+g*d[18]+d[19],T=Math.max(0,m*v)+n*(1-v),A=Math.max(0,_*v)+r*(1-v),R=Math.max(0,y*v)+i*(1-v);s[c]=255*Math.max(0,Math.min(1,T)),s[c+1]=255*Math.max(0,Math.min(1,A)),s[c+2]=255*Math.max(0,Math.min(1,R))}var a=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function l(c){return self.JSON.stringify(c||[])===a}function u(c,s){if(!s||l(s))return c;for(var d=c.data,f=d.length,h=s[0],p=s[1],g=s[2],m=s[3],_=s[4],y=s[5],v=s[6],T=s[7],A=s[8],R=s[9],x=s[10],b=s[11],O=s[12],C=s[13],M=s[14],S=s[15],V=s[16],B=s[17],U=s[18],q=s[19],L=0,k=0,H=0,F=0,P=0,rt=0,nt=0,ot=0,at=0,W=0,ft=0,lt=0;L<f;L+=4)rt=(k=d[L]/255)*h+(H=d[L+1]/255)*p+(F=d[L+2]/255)*g+(P=d[L+3]/255)*m+_,nt=k*y+H*v+F*T+P*A+R,ot=k*x+H*b+F*O+P*C+M,at=k*S+H*V+F*B+P*U+q,W=Math.max(0,rt*at)+n*(1-at),ft=Math.max(0,nt*at)+r*(1-at),lt=Math.max(0,ot*at)+i*(1-at),d[L]=255*Math.max(0,Math.min(1,W)),d[L+1]=255*Math.max(0,Math.min(1,ft)),d[L+2]=255*Math.max(0,Math.min(1,lt));return c}},xu=function(e,t){if(e.getUint32(t+4,!1)===1165519206){t+=4;var n=e.getUint16(t+=6,!1)===18761;t+=e.getUint32(t+4,n);var r=e.getUint16(t,n);t+=2;for(var i=0;i<r;i++)if(e.getUint16(t+12*i,n)===274)return e.setUint16(t+12*i+8,1,n),!0;return!1}},Iu=function(e){var t=new DataView(e);if(t.getUint16(0)!==65496)return null;for(var n,r,i=2,o=!1;i<t.byteLength&&(n=t.getUint16(i,!1),r=t.getUint16(i+2,!1)+2,!(!(n>=65504&&n<=65519||n===65534)||(o||(o=xu(t,i)),i+r>t.byteLength)));)i+=r;return e.slice(0,i)},Cu=function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){return t(Iu(n.result)||null)},n.readAsArrayBuffer(e.slice(0,262144))})},bu=function(){return window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder},Su=function(e,t){var n=bu();if(n){var r=new n;return r.append(e),r.getBlob(t)}return new Blob([e],{type:t})},Ou=function(){return Math.random().toString(36).substr(2,9)},Gr=function(e){var t=new Blob(["(",e.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(t),r=new Worker(n),i=[];return{transfer:function(){},post:function(o,a,l){var u=Ou();i[u]=a,r.onmessage=function(c){var s=i[c.data.id];s&&(s(c.data.message),delete i[c.data.id])},r.postMessage({id:u,message:o},l)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},Mu=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(i){n(i)},r.src=e})},Lu=function(e){return e.reduce(function(t,n){return t.then(function(r){return n().then(Array.prototype.concat.bind(r))})},Promise.resolve([]))},Pu=function(e,t){return new Promise(function(n){var r={width:e.width,height:e.height},i=e.getContext("2d"),o=t.sort(_n).map(function(a){return function(){return new Promise(function(l){Bu[a[0]](i,r,a[1],l)&&l()})}});Lu(o).then(function(){return n(e)})})},We=function(e,t){e.beginPath(),e.lineCap=t["stroke-linecap"],e.lineJoin=t["stroke-linejoin"],e.lineWidth=t["stroke-width"],t["stroke-dasharray"].length&&e.setLineDash(t["stroke-dasharray"].split(",")),e.fillStyle=t.fill,e.strokeStyle=t.stroke,e.globalAlpha=t.opacity||1},qe=function(e){e.fill(),e.stroke(),e.globalAlpha=1},Gu=function(e,t,n){var r=He(n,t),i=ge(n,t);return We(e,i),e.rect(r.x,r.y,r.width,r.height),qe(e),!0},ku=function(e,t,n){var r=He(n,t),i=ge(n,t);We(e,i);var o=r.x,a=r.y,l=r.width,u=r.height,c=l/2*.5522848,s=u/2*.5522848,d=o+l,f=a+u,h=o+l/2,p=a+u/2;return e.moveTo(o,p),e.bezierCurveTo(o,p-s,h-c,a,h,a),e.bezierCurveTo(h+c,a,d,p-s,d,p),e.bezierCurveTo(d,p+s,h+c,f,h,f),e.bezierCurveTo(h-c,f,o,p+s,o,p),qe(e),!0},Du=function(e,t,n,r){var i=He(n,t),o=ge(n,t);We(e,o);var a=new Image;new URL(n.src,window.location.href).origin!==window.location.origin&&(a.crossOrigin=""),a.onload=function(){if(n.fit==="cover"){var l=i.width/i.height,u=l>1?a.width:a.height*l,c=l>1?a.width/l:a.height,s=.5*a.width-.5*u,d=.5*a.height-.5*c;e.drawImage(a,s,d,u,c,i.x,i.y,i.width,i.height)}else if(n.fit==="contain"){var f=Math.min(i.width/a.width,i.height/a.height),h=f*a.width,p=f*a.height,g=i.x+.5*i.width-.5*h,m=i.y+.5*i.height-.5*p;e.drawImage(a,0,0,a.width,a.height,g,m,h,p)}else e.drawImage(a,0,0,a.width,a.height,i.x,i.y,i.width,i.height);qe(e),r()},a.src=n.src},Uu=function(e,t,n){var r=He(n,t),i=ge(n,t);We(e,i);var o=mt(n.fontSize,t),a=n.fontFamily||"sans-serif",l=n.fontWeight||"normal",u=n.textAlign||"left";return e.font="".concat(l," ").concat(o,"px ").concat(a),e.textAlign=u,e.fillText(n.text,r.x,r.y),qe(e),!0},Vu=function(e,t,n){var r=ge(n,t);We(e,r),e.beginPath();var i=n.points.map(function(l){return{x:mt(l.x,t,1,"width"),y:mt(l.y,t,1,"height")}});e.moveTo(i[0].x,i[0].y);for(var o=i.length,a=1;a<o;a++)e.lineTo(i[a].x,i[a].y);return qe(e),!0},Nu=function(e,t,n){var r=He(n,t),i=ge(n,t);We(e,i),e.beginPath();var o={x:r.x,y:r.y},a={x:r.x+r.width,y:r.y+r.height};e.moveTo(o.x,o.y),e.lineTo(a.x,a.y);var l=so({x:a.x-o.x,y:a.y-o.y}),u=.04*Math.min(t.width,t.height);if(n.lineDecoration.indexOf("arrow-begin")!==-1){var c=Hn(l,u),s=Wn(o,c),d=fe(o,2,s),f=fe(o,-2,s);e.moveTo(d.x,d.y),e.lineTo(o.x,o.y),e.lineTo(f.x,f.y)}if(n.lineDecoration.indexOf("arrow-end")!==-1){var h=Hn(l,-u),p=Wn(a,h),g=fe(a,2,p),m=fe(a,-2,p);e.moveTo(g.x,g.y),e.lineTo(a.x,a.y),e.lineTo(m.x,m.y)}return qe(e),!0},Bu={rect:Gu,ellipse:ku,image:Du,text:Uu,line:Nu,path:Vu},Fu=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t},zu=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise(function(r,i){if(!e||!Mr(e.type))return i({status:"not an image file",file:e});var o=n.stripImageHead,a=n.beforeCreateBlob,l=n.afterCreateBlob,u=n.canvasMemoryLimit,c=t.crop,s=t.size,d=t.filter,f=t.markup,h=t.output,p=t.image&&t.image.orientation?Math.max(1,Math.min(8,t.image.orientation)):null,g=h&&h.quality,m=g===null?null:g/100,_=h&&h.type||null,y=h&&h.background||null,v=[];!s||typeof s.width!="number"&&typeof s.height!="number"||v.push({type:"resize",data:s}),d&&d.length===20&&v.push({type:"filter",data:d});var T=function(x){var b=l?l(x):x;Promise.resolve(b).then(r)},A=function(x,b){var O=Fu(x),C=f.length?Pu(O,f):O;Promise.resolve(C).then(function(M){cu(M,b,a).then(function(S){if(zn(M),o)return T(S);Cu(e).then(function(V){V!==null&&(S=new Blob([V,S.slice(20)],{type:S.type})),T(S)})}).catch(i)})};if(/svg/.test(e.type)&&_===null)return Ru(e,c,f,{background:y}).then(function(x){r(Su(x,"image/svg+xml"))});var R=URL.createObjectURL(e);Mu(R).then(function(x){URL.revokeObjectURL(R);var b=au(x,p,c,{canvasMemoryLimit:u,background:y}),O={quality:m,type:_||e.type};if(!v.length)return A(b,O);var C=Gr(fo);C.post({transforms:v,imageData:b},function(M){A(Au(M),O),C.terminate()},[b.data.buffer])}).catch(i)})},Hu=function(e,t){if(e.getUint32(t+=2,!1)!==1165519206)return-1;var n=e.getUint16(t+=6,!1)===18761;t+=e.getUint32(t+4,n);var r=e.getUint16(t,n);t+=2;for(var i=0;i<r;i++)if(e.getUint16(t+12*i,n)===274)return e.getUint16(t+12*i+8,n)},Wu=function(e){var t=new DataView(e);if(t.getUint16(0,!1)!=65496)return null;for(var n,r=t.byteLength,i=2;i<r;){if(t.getUint16(i+2,!1)<=8)return-1;if(n=t.getUint16(i,!1),i+=2,n===65505)return Hu(t,i);if((65280&n)!=65280)return null;i+=t.getUint16(i,!1)}},qu=function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){return t(Wu(n.result)||-1)},n.readAsArrayBuffer(e.slice(0,262144))})},te={HORIZONTAL:1,VERTICAL:2},kr=function(e,t,n){var r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],i=e.center,o=e.zoom,a=e.aspectRatio,l=Lt(t),u={x:l.x-n.width*i.x,y:l.y-n.height*i.y},c=2*Math.PI+e.rotation%(2*Math.PI),s=o*Fe(n,he(t,a||n.height/n.width),c,r?i:{x:.5,y:.5});return{origin:{x:i.x*n.width,y:i.y*n.height},translation:u,scale:s,rotation:e.rotation}},En=function(e){return{origin:I({},e.origin),translation:I({},e.translation),rotation:e.rotation,scale:e.scale}},Ve=function(e,t,n,r){var i=n.translation,o=n.scale,a=n.rotation,l=n.origin,u={origin:I({},l),translation:I({},i),scale:o,rotation:2*Math.PI+a%(2*Math.PI)},c=e.height/e.width,s=Jn(l,i,u.rotation,t),d=Lt(s),f=Zt(s),h=De(e,n),p=Lt(h),g={x:h.x,y:h.y},m={x:p.x,y:p.y},_=d.x,y=d.y,v={x:g.x,y:g.y,width:h.width,height:h.height};if(!Uc(s,h)){if(r==="moving"){v.y>s.y?v.y=s.y:v.y+v.height<f.bottom&&(v.y=f.bottom-v.height),v.x>s.x?v.x=s.x:v.x+v.width<f.right&&(v.x=f.right-v.width);var T=De(e,I({},n,{scale:u.scale})),A=Lt(T);m.x=A.x,m.y=A.y,g.x=T.x,g.y=T.y,v.x=m.x-.5*v.width,v.y=m.y-.5*v.height,v.y>s.y?v.y=s.y:v.y+v.height<f.bottom&&(v.y=f.bottom-v.height),v.x>s.x?v.x=s.x:v.x+v.width<f.right&&(v.x=f.right-v.width);var R={x:v.x-g.x,y:v.y-g.y},x={x:R.x*Math.cos(u.rotation)-R.y*Math.sin(u.rotation),y:R.x*Math.sin(u.rotation)+R.y*Math.cos(u.rotation)};u.translation.x+=x.x,u.translation.y+=x.y}else if(r==="resizing"){h.width<s.width&&(v.width=s.width,v.height=v.width*c,v.height<s.height&&(v.height=s.height,v.width=v.height/c)),h.height<s.height&&(v.height=s.height,v.width=v.height/c,v.width<s.width&&(v.width=s.width,v.height=v.width*c)),v.x=m.x-.5*v.width,v.y=m.y-.5*v.height,v.y>s.y?v.y=s.y:v.y+v.height<f.bottom&&(v.y=f.bottom-v.height),v.x>s.x?v.x=s.x:v.x+v.width<f.right&&(v.x=f.right-v.width),u.scale=Fe(e,t,u.rotation,{x:(_-v.x)/v.width,y:(y-v.y)/v.height});var b=De(e,I({},n,{scale:u.scale})),O=Lt(b);m.x=O.x,m.y=O.y,g.x=b.x,g.y=b.y,v.x=m.x-.5*v.width,v.y=m.y-.5*v.height,v.y>s.y?v.y=s.y:v.y+v.height<f.bottom&&(v.y=f.bottom-v.height),v.x>s.x?v.x=s.x:v.x+v.width<f.right&&(v.x=f.right-v.width);var C={x:v.x-g.x,y:v.y-g.y},M={x:C.x*Math.cos(u.rotation)-C.y*Math.sin(u.rotation),y:C.x*Math.sin(u.rotation)+C.y*Math.cos(u.rotation)};u.translation.x+=M.x,u.translation.y+=M.y}else if(r==="rotating"){var S=!1;if(v.y>s.y){var V=v.y-s.y;v.y=s.y,v.height+=2*V,S=!0}if(v.y+v.height<f.bottom){var B=f.bottom-(v.y+v.height);v.y=f.bottom-v.height,v.height+=2*B,S=!0}if(v.x>s.x){var U=v.x-s.x;v.x=s.x,v.width+=2*U,S=!0}if(v.x+v.width<f.right){var q=f.right-(v.x+v.width);v.x=f.right-v.width,v.width+=2*q,S=!0}S&&(u.scale=Fe(e,t,u.rotation,{x:(_-h.x)/h.width,y:(y-h.y)/h.height}))}}return I({},u,{rotation:n.rotation})},Yu=function(e,t,n){var r=n.origin,i=n.translation,o=n.scale,a=2*Math.PI+n.rotation%(2*Math.PI),l={x:r.x+i.x,y:r.y+i.y},u=Jn(r,i,a,t),c=De(e,n),s=Qn(c),d=Lt(c),f=wt(s.tl,a,l),h=wt(s.br,a,l),p=f.x+.5*(h.x-f.x),g=f.y+.5*(h.y-f.y),m=mn(c,{x:p-d.x,y:g-d.y}),_=mn(u,{x:p-d.x,y:g-d.y}),y=Lt(_),v={x:m.x,y:m.y},T=m.width,A=m.height,R=(y.x-v.x)/T,x=(y.y-v.y)/A,b={x:R*e.width,y:x*e.height},O=1-o,C=b.x*O,M=b.y*O,S={x:v.x+T*R,y:v.y+A*x},V=wt(v,a,{x:v.x+.5*T,y:v.y+.5*A}),B=wt(v,a,S),U=V.x-B.x,q=V.y-B.y;return{origin:$r(b),translation:$r({x:v.x-C+U,y:v.y-M+q})}},Zu={n:function(e){return{x:e.x+.5*e.width,y:e.y}},e:function(e){return{x:e.x+e.width,y:e.y+.5*e.height}},s:function(e){return{x:e.x+.5*e.width,y:e.y+e.height}},w:function(e){return{x:e.x,y:e.y+.5*e.height}}},oi=function(e,t){return Zu[e](t)},xr=function(e,t,n){var r=n.origin,i=n.translation,o=2*Math.PI+n.rotation%(2*Math.PI),a=De(e,n),l={x:r.x+i.x,y:r.y+i.y},u=Jn(r,i,o,t),c=Zt(u),s=Zt(a),d=a;if(c.top<s.top||c.right>s.right||c.bottom>s.bottom||c.left<s.left){var f=I({},s);if(c.top<=f.top){var h=f.bottom-f.top,p=f.right-f.left,g=Math.max(1,u.height/h),m=h*g,_=p*g-p;f.bottom=c.top+m,f.top=c.top,f.left-=.5*_,f.right+=.5*_}if(c.bottom>=f.bottom){var y=f.bottom-f.top,v=f.right-f.left,T=Math.max(1,u.height/y),A=y*T,R=v*T-v;f.bottom=c.bottom,f.top=c.bottom-A,f.left-=.5*R,f.right+=.5*R}if(c.left<=f.left){var x=f.bottom-f.top,b=f.right-f.left,O=Math.max(1,u.width/b),C=b*O,M=x*O-x;f.right=c.left+C,f.left=c.left,f.top-=.5*M,f.bottom+=.5*M}if(c.right>=f.right){var S=f.bottom-f.top,V=f.right-f.left,B=Math.max(1,u.width/V),U=V*B,q=S*B-S;f.right=c.right,f.left=c.right-U,f.top-=.5*q,f.bottom+=.5*q}d=Xt(f.left,f.top,f.right-f.left,f.bottom-f.top)}var L=Qn(d),k=Lt(d),H=wt(L.tl,o,l),F=wt(L.br,o,l),P=H.x+.5*(F.x-H.x),rt=H.y+.5*(F.y-H.y),nt=mn(d,{x:P-k.x,y:rt-k.y}),ot=mn(u,{x:P-k.x,y:rt-k.y}),at=Lt(ot),W={x:nt.x,y:nt.y},ft=nt.width,lt=nt.height,bt=(at.x-W.x)/ft,yt=(at.y-W.y)/lt,gt=ft/e.width,et={x:bt*e.width,y:yt*e.height},_t=1-gt,$t=et.x*_t,j=et.y*_t,ct={x:W.x+ft*bt,y:W.y+lt*yt},G=wt(W,o,{x:W.x+.5*ft,y:W.y+.5*lt}),Q=wt(W,o,ct),ut=G.x-Q.x,J=G.y-Q.y;return{origin:et,translation:{x:W.x-$t+ut,y:W.y-j+J},scale:gt,rotation:n.rotation}},Xu=function(e,t,n,r,i,o,a,l,u){var c=o.left,s=o.right,d=o.top,f=o.bottom,h=s-c,p=f-d,g=i.left,m=i.right,_=i.top,y=i.bottom;if(n===te.VERTICAL){if(_=e.y>0?r.y:Math.min(r.y,Math.max(t.y,d)),y=e.y>0?Math.max(r.y,Math.min(t.y,f)):r.y,a){var v=(y-_)/a;g=r.x-.5*v,m=r.x+.5*v}}else if(g=e.x>0?r.x:Math.min(r.x,Math.max(t.x,c)),m=e.x>0?Math.max(r.x,Math.min(t.x,s)):r.x,a){var T=(m-g)*a;_=r.y-.5*T,y=r.y+.5*T}var A,R,x,b,O=l.width,C=l.height;if(n===te.VERTICAL?(A=r.x-.5*O,R=r.x+.5*O,e.y<0?(x=r.y-C,b=r.y):e.y>0&&(x=r.y,b=r.y+C)):(x=r.y-.5*C,b=r.y+.5*C,e.x<0?(A=r.x-O,R=r.x):e.x>0&&(A=r.x,R=r.x+O)),a)if(n===te.VERTICAL){var M=Math.min((y-_)/a,h),S=M*a;g<c&&(m=(g=c)+M),m>s&&(g=(m=s)-M),r.x=g+.5*M,e.y<0?_=r.y-S:e.y>0&&(y=r.y+S)}else{var V=Math.min((m-g)*a,p),B=V/a;_<d&&(y=(_=d)+V),y>f&&(_=(y=f)-V),r.y=_+.5*V,e.x<0?g=r.x-B:e.x>0&&(m=r.x+B)}var U=xe({top:_,right:m,bottom:y,left:g}),q=function(){var W=O*a;n===te.HORIZONTAL?(_=r.y-.5*W,y=r.y+.5*W):e.y<0?(y=r.y,_=y-W):e.y>0&&(_=r.y,y=_+W)},L=function(){var W=C/a;n===te.VERTICAL?(g=r.x-.5*W,m=r.x+.5*W):e.x<0?(m=r.x,g=m-W):e.x>0&&(g=r.x,m=g+W)};m<R&&(m=R,g=R-O,a&&q()),g>A&&(g=A,m=A+O,a&&q()),_>x&&(_=x,y=x+C,a&&L()),y<b&&(y=b,_=b-C,a&&L());var k=u.width,H=u.height;if(a&&(a<1?k=H/a:H=k*a),m-g>k&&(e.x<0?g=r.x-k:m=r.x+k),y-_>H&&(e.y<0?_=r.y-H:y=r.y+H),m-g==0&&(e.x>0?m=r.x+2:g=r.x-2),y-_==0&&(e.y>0?y=r.y+2:_=r.y-2),Math.round(g)<c||Math.round(m)>s||Math.round(_)<d||Math.round(y)>f){var F=f-d,P=s-c;if(g<c){g=c;var rt=Math.min(m-g,P);m=g+rt}if(m>s){m=s;var nt=Math.min(m-g,P);g=m-nt}if(_<d){_=d;var ot=Math.min(y-_,F);y=_+ot}if(y>f){y=f;var at=Math.min(y-_,F);_=y-at}U=xe({top:_,right:m,bottom:y,left:g})}return{free:U,limited:xe({top:_,right:m,bottom:y,left:g})}},$u={nw:function(e){return{x:e.x,y:e.y}},ne:function(e){return{x:e.x+e.width,y:e.y}},se:function(e){return{x:e.x+e.width,y:e.y+e.height}},sw:function(e){return{x:e.x,y:e.y+e.height}}},ai=function(e,t){return $u[e](t)},ju=function(e,t,n,r,i,o,a){var l=Zt(r),u=l.left,c=l.right,s=l.top,d=l.bottom,f=eo({x:t.x,y:t.y},r),h=e.x>0?n.x:Math.min(f.x,n.x),p=e.x>0?Math.max(n.x,f.x):n.x,g=e.y>0?n.y:Math.min(f.y,n.y),m=e.y>0?Math.max(n.y,f.y):n.y;if(i){var _=f.x-n.x;e.x>0?p=Math.max(n.x,n.x+e.x*_):h=Math.min(n.x,n.x-e.x*_),e.y>0?m=Math.max(n.y,n.y+e.x*_*i):g=Math.min(n.y,n.y-e.x*_*i)}var y=xe({top:g,right:p,bottom:m,left:h});if(xe({top:g,right:p,bottom:m,left:h}),o.width&&o.height){var v=o.width,T=o.height;i&&(i===1?T=v=Math.max(v,T):v<T?v=T/i:v>T?T=v*i:v=T/i),p-h<v&&(e.x>0?p=n.x+v:h=n.x-v),m-g<T&&(e.y>0?m=n.y+T:g=n.y-T);var A=a.width,R=a.height;i&&(i<1?A=R/i:R=A*i),p-h>A&&(e.x<0?h=n.x-A:p=n.x+A),m-g>R&&(e.y<0?g=n.y-R:m=n.y+R)}if(p-h==0&&(e.x>0?p=n.x+2:h=n.x-2),m-g==0&&(e.y>0?m=n.y+2:g=n.y-2),Math.round(h)<u||Math.round(p)>c||Math.round(g)<s||Math.round(m)>d){var x=d-s,b=c-u;if(h<u){h=u;var O=Math.min(p-h,b);p=h+O,i&&(e.y>0&&(m=n.y+O*i),e.y<0&&(g=n.y-O*i))}if(p>c){p=c;var C=Math.min(p-h,b);h=p-C,i&&(e.y>0&&(m=n.y+C*i),e.y<0&&(g=n.y-C*i))}if(g<s){g=s;var M=Math.min(m-g,x);m=g+M,i&&(e.x>0&&(p=n.x+M/i),e.x<0&&(h=n.x-M/i))}if(m>d){m=d;var S=Math.min(m-g,x);g=m-S,i&&(e.x>0&&(p=n.x+S/i),e.x<0&&(h=n.x-S/i))}y=xe({top:g,right:p,bottom:m,left:h})}return{free:y,limited:xe({top:g,right:p,bottom:m,left:h})}},Ku=function(e,t,n){var r=Tr(e);return r.width=Math.min(r.height,r.width),r.height=r.width,r.height=r.width*t,r.height<n.height&&(r.height=n.height,r.width=r.height/t),r.width<n.width&&(r.width=n.width,r.height=r.width*t),r},Qu=Math.PI/2,Ju=Math.PI/4,Dr=function(e){var t=N(Ju),n=N(Qu),r=e/n,i=Math.floor(r)*n,o=e-i;return o>t&&(o-=n,i+=n),{main:i,sub:o}},ts=function(e){return new Promise(function(t,n){var r=new Image;r.src=URL.createObjectURL(e),r.onerror=function(o){clearInterval(i),n(o)};var i=setInterval(function(){r.naturalWidth&&r.naturalHeight&&(clearInterval(i),URL.revokeObjectURL(r.src),t({width:r.naturalWidth,height:r.naturalHeight}))},1)})},po=function(e,t){var n={width:e.width,height:e.height};if(e.width>t.width||e.height>t.height){var r=e.height/e.width,i=t.width/e.width,o=t.height/e.height;i<o?(n.width=e.width*i,n.height=n.width*r):(n.height=e.height*o,n.width=n.height/r)}return n},Ke=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return(t+e).slice(-t.length)},ho=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Date;return"".concat(e.getFullYear(),"-").concat(Ke(e.getMonth()+1,"00"),"-").concat(Ke(e.getDate(),"00"),"_").concat(Ke(e.getHours(),"00"),"-").concat(Ke(e.getMinutes(),"00"),"-").concat(Ke(e.getSeconds(),"00"))},lr=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=e("GET_CROP_ASPECT_RATIO"),o={center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null};n?Object.assign(o,n):t.options.crop?Object.assign(o,t.options.crop):o.aspectRatio=i;var a=r.width,l=r.height;if(a&&l)o.aspectRatio=l/a;else if(t.instructions.size){var u=t.instructions.size,c=u.width,s=u.height;c&&s&&(o.aspectRatio=s/c)}return o},Qe=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},go=function(e){return e.split(".").pop()},es=function(e){if(typeof e!="string")return"";var t=e.split("/").pop();return/svg/.test(t)?"svg":/zip|compressed/.test(t)?"zip":/plain/.test(t)?"txt":/msword/.test(t)?"doc":/[a-z]+/.test(t)?t==="jpeg"?"jpg":t:""},ns=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=typeof n=="string"?e.slice(0,e.size,n):e.slice(0,e.size,e.type);return i.lastModifiedDate=new Date,Rt(t)||(t=ho()),t&&r===null&&go(t)?i.name=t:(r=r||es(i.type),i.name=t+(r?"."+r:"")),i},rs=function(e){return e.substr(0,e.lastIndexOf("."))||e},is={jpeg:"jpg","svg+xml":"svg"},os=function(e,t){var n=rs(e),r=t.split("/")[1],i=is[r]||r;return"".concat(n,".").concat(i)},as=function(e){return/jpeg|png|svg\+xml/.test(e)?e:"image/jpeg"},mo=function(e){return Array.isArray(e)&&e.length===20},ls=["x","y","left","top","right","bottom","width","height"],cs=function(e){return typeof e=="string"&&/%/.test(e)?parseFloat(e)/100:e},us=function(){return Math.random().toString(36).substr(2,9)},li=function(e){var t=Ge(e,2),n=t[0],r=t[1],i=r.allowSelect!==!1,o=r.allowMove!==!1,a=r.allowResize!==!1,l=r.allowInput!==!1,u=r.allowDestroy!==!1,c=r.allowEdit===void 0||r.allowEdit;(r.allowResize===!0||r.allowMove===!0||r.allowInput===!0||r.allowEdit)&&(i=!0),r.allowMove===!1&&(a=!1),r.allowResize===!0&&(o=!0);var s=r.points?{}:ls.reduce(function(d,f){return d[f]=cs(r[f]),d},{});return r.points&&(a=!1),[n,I({zIndex:0,id:us()},r,s,{isDestroyed:!1,isSelected:!1,isDirty:!0,allowDestroy:u,allowSelect:i,allowMove:o,allowResize:a,allowInput:l,allowEdit:c})]},ss=function(e){if(!e)return null;var t=e.split(/filename=|filename\*=.+''/).splice(1).map(function(n){return n.trim().replace(/^["']|[;"']{0,2}$/g,"")}).filter(function(n){return n.length});return t.length?decodeURI(t[t.length-1]):null},ds=function(e){return[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0]},fs=function(e){return[e,0,0,0,.5*(1-e),0,e,0,0,.5*(1-e),0,0,e,0,.5*(1-e),0,0,0,1,0]},ps=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return[.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715+.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,0,1,0]},hs=function(e){return[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0]},gs="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=",vo=void 0,Je=Se()?new Image:{};Je.onload=function(){vo=Je.naturalWidth>Je.naturalHeight,Je=void 0},Je.src=gs;var ms=function(){return vo},cr=null,Ir=function(){return cr===null&&(cr=/MSIE|Trident/.test(window.navigator.userAgent)),cr},tn={contrast:fs,exposure:hs,brightness:ds,saturation:ps},vs=function(e){return e.borderWidth?"borderColor":e.lineWidth?"lineColor":e.fontColor?"fontColor":e.backgroundColor?"backgroundColor":void 0},ys=function(e){var t=e.fontColor,n=e.backgroundColor,r=e.lineColor,i=e.borderColor;return t||n||r||i},un=Math.PI/2,yo=function(e){var t={upscale:e("GET_OUTPUT_UPSCALE"),mode:e("GET_OUTPUT_FIT"),width:e("GET_OUTPUT_WIDTH"),height:e("GET_OUTPUT_HEIGHT")},n=e("GET_SIZE_INPUT");if(n.width||n.height){var r=n.width,i=n.height,o=e("GET_CROP_RECTANGLE_ASPECT_RATIO");r&&!i?i=r/o:i&&!r&&(r=i*o),t.width=r,t.height=i,t.upscale=!0,t.mode="force"}return t},_s=function(e,t){var n=t("GET_UID"),r=t("GET_CROP",n,Date.now()),i={width:r.cropStatus.currentWidth,height:r.cropStatus.currentHeight},o=e.mode,a=e.width,l=e.height,u=e.upscale;if(!a&&!l)return i;if(a===null?a=l:l===null&&(l=a),o!=="force"){var c=a/i.width,s=l/i.height,d=1;if(o==="cover"?d=Math.max(c,s):o==="contain"&&(d=Math.min(c,s)),d>1&&u===!1)return i;a=i.width*d,l=i.height*d}return{width:Math.round(a),height:Math.round(l)}},Es=function(e){return e.markup.filter(function(t){return!t[1].isDestroyed})},ws=function(e){return e.map(function(t){var n=I({},t[1]);return Object.keys(n).forEach(function(r){n[r]===void 0&&delete n[r]}),delete n.isDestroyed,delete n.isSelected,delete n.isDirty,[t[0],n]})},Ts=function(e,t,n){return new Promise(function(r,i){var o={data:null,file:null},a=io(t.image,t.crop),l=yo(n),u={crop:a,image:I({},_s(l,n),{orientation:t.file.orientation}),size:l,output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY"),background:t.options.outputCanvasBackgroundColor},filter:t.colorMatrices.filter?{id:t.filterName,value:t.filterValue,matrix:t.colorMatrices.filter}:null,color:Object.keys(t.colorValues).length?Object.keys(t.colorValues).reduce(function(f,h){return f[h]={value:t.colorValues[h],matrix:t.colorMatrices[h].map(function(p){return N(p,5)})},f},{}):null,markup:ws(Es(t).map(function(f){return[f[0],I({},f[1])]})),colorMatrix:n("GET_COLOR_MATRIX")};if(e.data&&(o.data=u),e.file){var c={beforeCreateBlob:n("GET_BEFORE_CREATE_BLOB"),afterCreateBlob:n("GET_AFTER_CREATE_BLOB"),stripImageHead:n("GET_OUTPUT_STRIP_IMAGE_HEAD"),canvasMemoryLimit:n("GET_OUTPUT_CANVAS_MEMORY_LIMIT")},s=t.file.data,d=I({},u,{filter:u.colorMatrix,markup:u.markup});zu(s,d,c).then(function(f){o.file=ns(f,os(s.name,as(f.type))),r(o)}).catch(i)}else r(o)})},wn=function(e){e.crop.draft.rotateMinScale=null},Rs=function(e){e.crop.draft.rotateMinScale||(e.crop.draft.rotateMinScale=e.crop.transforms.scale)},en=function(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];Rs(e);var o=I({},e.crop.transforms,{scale:e.crop.draft.rotateMinScale});e.crop.draft.transforms=xs(e.image,e.crop.rectangle,o,t.main+t.sub,n,e.crop.draft.transforms?e.crop.draft.transforms.rotation:e.crop.rotation.main+e.crop.rotation.sub,r,i),e.crop.rotation=Dr(e.crop.draft.transforms.rotation)},_o=function(e,t){if(e.stage!==null){var n=e.instructions.crop.scaleToFit===void 0?e.crop.limitToImageBounds===void 0?e.options.cropLimitToImageBounds:e.crop.limitToImageBounds:e.instructions.crop.scaleToFit,r=t("GET_STAGE_RECT",e.instructions.crop);e.crop.rectangle=he(r.fits?r:e.stage,e.instructions.crop.aspectRatio||e.image.aspectRatio),e.crop.draft.rectangle=null,r.mode!=="stage"&&r.fits&&(e.crop.rectangle.x=r.x,e.crop.rectangle.y=r.y),e.crop.transforms=kr(e.instructions.crop,r,e.image,n),e.crop.draft.transforms=null,e.crop.rotation=Dr(e.instructions.crop.rotation),e.crop.flip=I({},e.instructions.crop.flip);var i=t("GET_CROP_ASPECT_RATIO_OPTIONS")||[],o=i.map(function(l){return l.value.aspectRatio}).find(function(l){return l===e.instructions.crop.aspectRatio}),a=i.find(function(l){return l.value.aspectRatio===null});o?e.crop.aspectRatio=o:a&&i.length?e.crop.aspectRatio=null:e.crop.aspectRatio=t("GET_CROP_ASPECT_RATIO"),e.crop.isDirty=!1}},ci=function(e,t,n){if(e.stage!==null){st(e),e.size.width=!!e.instructions.size&&e.instructions.size.width,e.size.height=!!e.instructions.size&&e.instructions.size.height,e.size.aspectRatioLocked=!0,e.size.aspectRatioPrevious=!1;var r=e.instructions.crop.scaleToFit===void 0?e.crop.limitToImageBounds===void 0?e.options.cropLimitToImageBounds:e.crop.limitToImageBounds:e.instructions.crop.scaleToFit;_o(e,t),e.instructions.markup&&n("MARKUP_SET_VALUE",{value:e.instructions.markup}),n("CROP_SET_LIMIT",{value:r,silent:!0}),Object.keys(e.instructions.color).forEach(function(i){return n("COLOR_SET_VALUE",{key:i,value:e.instructions.color[i]})}),n("FILTER_SET_VALUE",{value:e.instructions.filter}),wn(e)}},Mn=function(e,t){if(e.stage){st(e);var n=e.crop.rectangle,r=n.height/n.width,i=e.crop.aspectRatio;if(i!==null&&N(r,3)!==N(i,3)){var o=t("GET_MIN_CROP_SIZE");o.width=N(o.width),o.height=N(o.height);var a=Math.min(n.width,n.height);Math.min(a*i,a/i)<Math.max(o.width,o.height)&&(e.crop.rectangle=Ku(I({},e.crop.rectangle),i,o),e.crop.draft.transforms=xr(e.image,e.crop.rectangle,e.crop.transforms))}var l=e.crop.draft.transforms||e.crop.transforms,u=ro(e.image,e.crop.rectangle,l,e.crop.limitToImageBounds);e.crop.aspectRatio&&(u.aspectRatio=e.crop.aspectRatio);var c=t("GET_STAGE_RECT",u);e.crop.transforms=kr(u,c,e.image,u.scaleToFit),e.crop.draft.transforms=null;var s=e.crop.aspectRatio||e.crop.rectangle.height/e.crop.rectangle.width;e.crop.rectangle=he(c,s),e.crop.draft.rectangle=null,c.mode!=="stage"&&(e.crop.rectangle.x+=c.x,e.crop.rectangle.y+=c.y),wn(e)}},sn=function(e,t,n){var r=t("GET_CROP_ZOOM_TIMEOUT");r&&(clearTimeout(e.zoomTimeoutId),e.zoomTimeoutId=setTimeout(function(){n("CROP_ZOOM")},r))},Ln=function(e,t,n){st(e),sn(e,t,n)},st=function(e){clearTimeout(e.zoomTimeoutId)},As=function(e){e.crop.rectangle=e.crop.draft.rectangle.limited,e.crop.draft.rectangle=null,se(e),wn(e)},Pn=function(e){e.crop.draft.transforms=En(e.crop.transforms),e.crop.draft.rectangle={limited:Tr(e.crop.rectangle),free:Tr(e.crop.rectangle)},st(e)},qn=function(e,t){return Math.min(e.width/t.width,e.height/t.height)},xs=function(e,t,n,r,i,o,a,l){var u=I({},En(n),{rotation:r}),c=l?Ve(e,t,u,"rotating"):u,s=qn(t,i);return N(c.scale,5)>N(s,5)?(a&&(o+=2*a),I({},En(n),{rotation:o,interaction:{rotation:c.rotation}})):(c.scale=Math.min(s,c.scale),c.interaction={rotation:c.rotation},c)},Gn=function(e,t,n,r,i,o){var a=Math.max(1e-10,r),l=I({},En(n),{scale:a}),u=o?Ve(e,t,l,"resizing"):l,c=qn(t,i);return u.scale=Math.min(c,u.scale),u.interaction={scale:a},u},Is=function(e,t,n,r,i){var o={x:n.translation.x+r.x,y:n.translation.y+r.y},a=I({},En(n),{translation:o}),l=i?Ve(e,t,a,"moving"):a;return l.interaction={translation:o},l},Cs=function(e,t){var n=N(e.crop.draft.transforms.scale,5);if(!(N(e.crop.draft.targetSize,5)<n)||e.crop.aspectRatio!==null||e.crop.limitToImageBounds===!1||N(e.crop.rotation.sub,5)!==0)return!1;var r=N(e.crop.rotation.main/un,5)%2!=0?e.image.width/e.image.height:e.image.height/e.image.width;if(r===e.crop.rectangle.height/e.crop.rectangle.width)return!1;var i=e.stage.x+.5*e.stage.width,o=e.stage.y+.5*e.stage.height,a=e.crop.rectangle.x+.5*e.crop.rectangle.width,l=e.crop.rectangle.y+.5*e.crop.rectangle.height;if(a!==i||l!==o)return!1;var u=t("GET_STAGE_RECT");return e.crop.rectangle=he(u,r),u.mode!=="stage"&&(e.crop.rectangle.x+=u.x,e.crop.rectangle.y+=u.y),e.crop.transforms=kr({center:{x:.5,y:.5},rotation:e.crop.transforms.rotation,zoom:1,aspectRatio:r},u,e.image,!0),e.crop.draft.transforms=null,!0},se=function(e){e.crop.draft.rectangle=null,e.crop.transforms=e.crop.draft.transforms||e.crop.transforms,e.crop.transforms.interaction=null,e.crop.draft.transforms=null,e.crop.transforms=I({},e.crop.transforms,Yu(e.image,e.crop.rectangle,e.crop.transforms)),e.crop.isRotating=!1,e.crop.isDirty=!0},ui=function(e,t){return e.getAllResponseHeaders().indexOf(t)>=0?e.getResponseHeader(t):null},bs={svg:"svg+xml",jpg:"jpeg"},Ss=function(e,t){if(Mr(e)||!t)return e;var n=go(t);return n?"image/".concat(bs[n]||n):e},Os=function(e){return e.split("/").pop().split("?").shift()},Ms=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.progress,r=n===void 0?function(c){}:n,i=t.load,o=i===void 0?function(c,s){}:i,a=t.error,l=a===void 0?function(){}:a,u=new XMLHttpRequest;u.onprogress=function(c){return r(c.lengthComputable?c.loaded/c.total:null)},u.onerror=function(){return l(u)},u.onload=function(){var c=u.status>=200&&u.status<300,s=u.response;if(!c||!s)return l(u);var d=ui(u,"Content-Disposition"),f=d?ss(d):Os(e),h=Ss(u.getResponseHeader("Content-Type"),f),p=ui(u,"Content-Doka"),g=null;if(p)try{g=JSON.parse(p)}catch{}!Mr(s.type)&&h&&(s=s.slice(0,s.size,h)),"name"in s||!f||(s.name=f),o(s,g)},u.open("GET",e),u.responseType="blob",u.send()},Ls=function(e){for(var t=e.split(","),n=t[0].match(/([a-z]+\/[a-z]+)/)[0],r=atob(t[1]),i=r.length,o=new ArrayBuffer(r.length),a=new Uint8Array(o),l=0;l<i;l++)a[l]=r.charCodeAt(l);return new Blob([o],{type:n})},Ps=function(e){return/^data:/.test(e)},Gs=function(e,t){var n=t.progress;return new Promise(function(r,i){if(Rt(e)){var o=Ps(e);return o&&Ir()?r({file:Ls(e)}):void Ms(e,{progress:o?function(){}:n,error:i,load:function(l,u){return r({file:l,fileInstructions:u})}})}if(e instanceof Blob)r({file:e});else{if(e.nodeName==="IMG"){var a=function(l){var u=document.createElement("canvas");u.width=l.naturalWidth,u.height=l.naturalHeight,u.getContext("2d").drawImage(l,0,0),u.toBlob(function(c){return r({file:c})})};return e.complete?void a(e):void(e.onload=function(){return a(e)})}e.nodeName!=="CANVAS"?i(e):e.toBlob(function(l){return r({file:l})})}})},le=function(e){return e.file===!1},ks=function(e,t,n){return I({SET_UID:function(r){var i=r.id;n.uid=i},AWAIT_IMAGE:function(){n.file||(n.noImageTimeout=setTimeout(function(){e("AWAITING_IMAGE")},250))},REQUEST_REMOVE_IMAGE:function(){e("UNLOAD_IMAGE"),n.file=!1,n.noImageTimeout=setTimeout(function(){e("AWAITING_IMAGE")},500)},DID_UNLOAD_IMAGE:function(){e("ABORT_IMAGE")},REQUEST_ABORT_IMAGE:function(r){e("UNLOAD_IMAGE"),n.file=!1,n.queuedFile=r},DID_SET_SRC:function(r){r.value!==r.prevValue&&(clearTimeout(n.noImageTimeout),e("REQUEST_LOAD_IMAGE",{source:r.value}))},ABORT_IMAGE:function(){if(n.file=null,n.queuedFile){var r=n.queuedFile;n.queuedFile=null,e("REQUEST_LOAD_IMAGE",r)}},REQUEST_LOAD_IMAGE:function(r){var i=r.source,o=r.success,a=o===void 0?function(){}:o,l=r.failure,u=l===void 0?function(h){}:l,c=r.options,s=r.resolveOnConfirm,d=s!==void 0&&s;if(clearTimeout(n.noImageTimeout),!i)return u("no-image-source");if(n.file!==null)return n.file.error?(n.file=null,void e("REQUEST_LOAD_IMAGE",{source:i,success:a,failure:u,options:c,resolveOnConfirm:d})):void e("REQUEST_ABORT_IMAGE",{source:i,success:a,failure:u,options:c,resolveOnConfirm:d});ln(n),n.file={uid:Yt()},e("DID_REQUEST_LOAD_IMAGE",{source:i});var f=function(h){if(le(n))return e("ABORT_IMAGE");n.file.error=!0,e("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_LOAD_ERROR",data:h}}),u(h)};Gs(i,{progress:function(h){return h!==null&&e("DID_MAKE_PROGRESS",{progress:h})}}).then(function(h){var p=h.file,g=h.fileInstructions;if(!c&&g){var m=g.crop,_=g.filter,y=g.colorMatrix,v=g.color,T=g.markup,A=g.size;c={crop:m,filter:_?_.id||_.matrix:y,color:v,markup:T,size:A}}if(le(n))return e("ABORT_IMAGE");var R=n.options.beforeLoadImage,x=R?R(p):p;Promise.resolve(x).then(function(b){b.name||(b.name=ho()),n.file.orientation=-1,n.file.data=b,e("LOAD_IMAGE",{success:a,failure:u,options:c,resolveOnConfirm:d},!0),e("KICK")}).catch(function(b){setTimeout(function(){f(b)},100)})}).catch(f)},LOAD_IMAGE:function(r){var i=r.success,o=r.failure,a=r.options,l=a===void 0?{}:a,u=r.resolveOnConfirm;if(le(n))return e("ABORT_IMAGE");var c=n.file.data;Promise.all([ts(c),qu(c)]).then(function(s){var d=Ge(s,2),f=d[0],h=d[1];if(le(n))return e("ABORT_IMAGE");if(n.file.orientation=t("GET_OUTPUT_CORRECT_IMAGE_EXIF_ORIENTATION")&&ms()?h:-1,n.file.orientation>-1){var p=f.width,g=f.height;h>=5&&h<=8&&(f.width=g,f.height=p)}var m=t("GET_MIN_IMAGE_SIZE");if(f.width<m.width||f.height<m.height)return e("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_MIN_SIZE_VALIDATION_ERROR",data:{size:f,minImageSize:m}}}),ln(n),void o();var _=po(f,{width:t("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:t("GET_MAX_IMAGE_PREVIEW_HEIGHT")});if(n.image={x:0,y:0,width:_.width,height:_.height,naturalWidth:f.width,naturalHeight:f.height,aspectRatio:f.height/f.width,orientation:h},l.size&&(l.size.hasOwnProperty("mode")&&l.size.hasOwnProperty("upscale")?(n.options.outputWidth=l.size.width,n.options.outputHeight=l.size.height,n.options.outputFit=l.size.mode,n.options.upscale=l.size.upscale):(n.size.width=l.size.width,n.size.height=l.size.height,n.size.aspectRatioLocked=!0,n.size.aspectRatioPrevious=!1,n.instructions.size={width:l.size.width,height:l.size.height})),n.instructions.crop=lr(t,n,l.crop?I({},l.crop):null,n.size),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,n.instructions.crop.scaleToFit===!1&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),l.filter===void 0)n.options.filter?typeof n.options.filter=="string"?n.instructions.filter=n.options.filter:n.options.filter.id&&(n.instructions.filter=n.options.filter.id):n.instructions.filter=void 0;else{var y=l.filter;n.instructions.filter=y===null?y:y.id||y.matrix||y}var v=n.options.markup||[];n.instructions.markup=v.concat(l.markup||[]),n.instructions.color=Object.keys(tn).reduce(function(T,A){var R=null;return n.options.color&&n.options.color[A]&&(R=n.options.color[A].value),T[A]=l.color&&l.color[A]!==void 0?typeof l.color[A]=="number"?l.color[A]:l.color[A].value:R===null?n.options["color".concat(Qe(A))]:R,T},{}),e("DID_LOAD_IMAGE",{image:I({size:n.file.data.size,name:n.file.data.name,type:n.file.data.type,orientation:h},f)}),n.filePromise={resolveOnConfirm:u,success:i,failure:o}}).catch(function(s){if(le(n))return e("ABORT_IMAGE");e("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_UNKNOWN_ERROR",data:s}}),ln(n),o()})},CHANGE_VIEW:function(r){var i=r.id;n.activeView=i,e("SHOW_VIEW",{id:i})},UPDATE_ROOT_RECT:function(r){var i=r.rect;n.rootRect=i},DID_RESIZE_STAGE:function(r){var i=r.size,o=r.offset,a=r.animate,l=n.stage===null;if(n.stage=Xt(0,0,i.width,i.height),n.stageOffset=Mt(o.x,o.y),!t("GET_ALLOW_PREVIEW_FIT_TO_VIEW")){var u=t("GET_IMAGE_STAGE_RECT");n.stage=Xt(0,0,u.width,u.height),n.stageOffset=Mt(n.stageOffset.x+u.x,n.stageOffset.y+u.y)}if(l){if(ci(n,t,e),e("DID_SHOW_IMAGE",{image:{size:n.file.data.size,name:n.file.data.name,type:n.file.data.type,orientation:n.image.orientation,width:n.image.naturalWidth,height:n.image.naturalHeight}}),!n.filePromise.resolveOnConfirm){var c=io(n.image,n.crop),s=yo(t);n.filePromise.success({crop:c,image:{orientation:n.file.orientation},size:s,output:{type:t("GET_OUTPUT_TYPE"),quality:t("GET_OUTPUT_QUALITY")}})}}else n.instantUpdate=!a,Mn(n,t),setTimeout(function(){n.instantUpdate=!1},16)},RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK:function(r){var i=r.value;n.size.aspectRatioLocked=i},RESIZE_SET_OUTPUT_SIZE:function(r){var i=r.width,o=r.height,a=Ue({width:i=i||null,height:o=o||null},t("GET_SIZE_MIN"),t("GET_SIZE_MAX"),t("GET_CROP_RECTANGLE_ASPECT_RATIO"));if(n.size.width=a.width?Math.round(a.width):null,n.size.height=a.height?Math.round(a.height):null,i&&o){var l=o/i;if(l===n.crop.aspectRatio)return;n.size.aspectRatioPrevious===!1&&(n.size.aspectRatioPrevious=n.crop.aspectRatio),e("CROP_SET_ASPECT_RATIO",{value:l})}else n.size.aspectRatioPrevious!==!1&&(e("CROP_SET_ASPECT_RATIO",{value:n.size.aspectRatioPrevious}),n.size.aspectRatioPrevious=!1)},CROP_SET_ASPECT_RATIO:function(r){var i=r.value;if(st(n),n.crop.aspectRatio=Rt(i)?ke(i):i,n.crop.aspectRatio&&Mn(n,t),n.crop.isDirty=!0,n.size.width&&n.size.height)if(n.crop.aspectRatio){var o=n.size.width*n.crop.aspectRatio,a=Ht(o,t("GET_SIZE_MIN").height,t("GET_SIZE_MAX").height);n.size.height=a,n.size.width=a/n.crop.aspectRatio}else n.size.height=null},DID_SET_CROP_ASPECT_RATIO:function(r){var i=r.value,o=r.prevValue;ke(i)!==ke(o)&&e("CROP_SET_ASPECT_RATIO",{value:i})},CROP_ZOOM:function(){n.stage&&(st(n),Mn(n,t))},DID_SET_CROP_LIMIT_TO_IMAGE_BOUNDS:function(r){var i=r.value,o=r.prevValue;n.crop.limitToImageBounds=i,o===!1&&i===!0&&e("CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS")},CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS:function(){var r=n.stage,i=n.image;if(n.crop.rectangle){var o=n.crop.rectangle.height/n.crop.rectangle.width,a=he(r,o);n.crop.rectangle=a,n.crop.transforms=Ve(i,n.crop.rectangle,n.crop.transforms,"moving"),n.crop.transforms=Ve(i,n.crop.rectangle,n.crop.transforms,"resizing"),n.crop.transforms=Ve(i,n.crop.rectangle,n.crop.transforms,"rotating"),n.crop.draft.rectangle=null,n.crop.draft.transforms=null,Mn(n,t)}},CROP_SET_LIMIT:function(r){var i=r.value,o=r.silent,a=o!==void 0&&o,l=n.crop.limitToImageBounds!==i;n.crop.limitToImageBounds=i,l&&!a&&(n.crop.isDirty=!0),l&&i&&e("CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS")},CROP_IMAGE_RESIZE_GRAB:function(){Pn(n),st(n)},CROP_IMAGE_ROTATE_GRAB:function(){Pn(n),st(n),n.crop.isRotating=!0},CROP_RECT_DRAG_GRAB:function(){Pn(n),st(n)},CROP_RECT_DRAG_RELEASE:function(){As(n),sn(n,t,e)},CROP_RECT_EDGE_DRAG:function(r){var i=r.offset,o=r.origin,a=r.anchor,l=n.image,u=n.stage,c=/n|s/.test(o)?te.VERTICAL:te.HORIZONTAL,s=oi(o,n.crop.rectangle),d=oi(a,n.crop.rectangle),f=eo({x:s.x+(c===te.HORIZONTAL?i.x:0),y:s.y+(c===te.VERTICAL?i.y:0)},u),h=t("GET_MIN_CROP_SIZE"),p=t("GET_MAX_CROP_SIZE");h.width=N(h.width),h.height=N(h.height);var g=qn(n.crop.rectangle,t("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);p.width=N(p.width*g),p.height=N(p.height*g);var m={x:Math.sign(s.x-d.x),y:Math.sign(s.y-d.y)};n.crop.draft.rectangle=Xu(m,f,c,d,Zt(n.crop.rectangle),Zt(u),n.crop.aspectRatio,h,p),n.crop.limitToImageBounds&&(n.crop.draft.transforms=xr(l,n.crop.draft.rectangle.limited,n.crop.transforms))},CROP_RECT_CORNER_DRAG:function(r){var i=r.offset,o=r.origin,a=r.anchor,l=n.image,u=n.stage,c=ai(o,n.crop.rectangle),s=ai(a,n.crop.rectangle),d={x:c.x+i.x,y:c.y+i.y},f=t("GET_MIN_CROP_SIZE"),h=t("GET_MAX_CROP_SIZE");f.width=N(f.width),f.height=N(f.height);var p=qn(n.crop.rectangle,t("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);h.width=N(h.width*p),h.height=N(h.height*p);var g={x:Math.sign(c.x-s.x),y:Math.sign(c.y-s.y)};n.crop.draft.rectangle=ju(g,d,s,u,n.crop.aspectRatio,f,h),n.crop.limitToImageBounds&&(n.crop.draft.transforms=xr(l,n.crop.draft.rectangle.limited,n.crop.transforms))},CROP_IMAGE_DRAG_GRAB:function(){return Pn(n)||st(n)},CROP_IMAGE_DRAG_RELEASE:function(){se(n),wn(n),sn(n,t,e)},CROP_IMAGE_ROTATE_RELEASE:function(){se(n),sn(n,t,e)},CROP_IMAGE_DRAG:function(r){var i=r.value;st(n),n.crop.draft.transforms=Is(n.image,n.crop.rectangle,n.crop.transforms,i,n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_RELEASE:function(){t("GET_CROP_RESIZE_MATCH_IMAGE_ASPECT_RATIO")&&Cs(n,t),se(n),wn(n),sn(n,t,e)},CROP_IMAGE_RESIZE:function(r){var i=r.value;st(n);var o=n.crop.transforms;n.crop.draft.targetSize=o.scale+o.scale*i,n.crop.draft.transforms=Gn(n.image,n.crop.rectangle,o,n.crop.draft.targetSize,t("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_SET:function(r){var i=r.value,o=Math.max(n.crop.rectangle.width/n.image.width,n.crop.rectangle.height/n.image.height);st(n);var a=n.crop.transforms;n.crop.draft.targetSize=i*o,n.crop.draft.transforms=Gn(n.image,n.crop.rectangle,a,n.crop.draft.targetSize,t("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_MULTIPLY:function(r){var i=r.value;st(n);var o=n.crop.transforms;n.crop.draft.targetSize=o.scale*i,n.crop.draft.transforms=Gn(n.image,n.crop.rectangle,o,n.crop.draft.targetSize,t("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_AMOUNT:function(r){var i=r.value;st(n);var o=n.crop.transforms;n.crop.draft.targetSize=(n.crop.draft.transforms?n.crop.draft.transforms.scale:o.scale)+i,n.crop.draft.transforms=Gn(n.image,n.crop.rectangle,o,n.crop.draft.targetSize,t("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_ROTATE:function(r){var i=r.value;st(n),n.crop.isRotating=!0,en(n,{main:n.crop.rotation.main,sub:i},t("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds)},CROP_IMAGE_ROTATE_ADJUST:function(r){var i=r.value;st(n),en(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+i))},t("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds),se(n)},CROP_IMAGE_ROTATE_CENTER:function(){st(n),en(n,{main:n.crop.rotation.main,sub:0},t("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds),se(n)},CROP_IMAGE_ROTATE_LEFT:function(){Ln(n,t,e),en(n,{main:n.crop.rotation.main-un,sub:n.crop.rotation.sub},t("GET_MIN_PREVIEW_IMAGE_SIZE"),-un,n.crop.limitToImageBounds),se(n),t("GET_CROP_FORCE_LETTERBOX")&&e("CROP_UPDATE_LETTERBOX")},CROP_IMAGE_ROTATE_RIGHT:function(){Ln(n,t,e),en(n,{main:n.crop.rotation.main+un,sub:n.crop.rotation.sub},t("GET_MIN_PREVIEW_IMAGE_SIZE"),un,n.crop.limitToImageBounds),se(n),t("GET_CROP_FORCE_LETTERBOX")&&e("CROP_UPDATE_LETTERBOX")},CROP_IMAGE_FLIP_HORIZONTAL:function(){Ln(n,t,e),N(n.crop.rotation.main%Math.PI/2,5)===0?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){Ln(n,t,e),N(n.crop.rotation.main%Math.PI/2,5)===0?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},DID_RECEIVE_IMAGE_DATA:function(r){var i=r.previewData,o=r.thumbData;n.file.preview=i,n.file.thumb=o},MARKUP_SET_VALUE:function(r){var i=r.value;n.markup=(i||[]).map(li).sort(_n)},MARKUP_ADD_DEFAULT:function(r){var i=r.value,o=function(){return-.5+Math.random()},a=t("GET_CROP_RECTANGLE_ASPECT_RATIO"),l=a>1?.5/a:.5,u=a>1?.5:.5*a,c=function(){return{width:l,height:u,x:.5+.5*o()-.5*l,y:.5+.5*o()-.5*u}},s=function(h){return t("GET_MARKUP_TOOL_VALUES")[h]},d=function(){var h=s("shapeStyle"),p=s("color"),g=h[0]||h[1]?null:p;return{backgroundColor:g,borderWidth:h[0],borderStyle:h[1]?h[1]:null,borderColor:g!==null?null:p}},f={rect:function(){return I({},c(),d())},ellipse:function(){return I({},c(),d())},text:function(){return{x:.5+.5*o()-.1,y:.5+.5*o(),width:0,height:0,fontColor:s("color"),fontSize:s("fontSize"),fontFamily:s("fontFamily"),text:"Text"}},line:function(){var h=s("lineStyle");return I({},c(),{lineColor:s("color"),lineWidth:h[0],lineStyle:h[1]?h[1]:null,lineDecoration:s("lineDecoration")})}}[i]();e("MARKUP_ADD",[i,f])},MARKUP_ADD:function(r){n.markup.forEach(function(o){return o[1].isSelected=!1}),n.markup=n.markup.filter(function(o){return!o[1].isDestroyed});var i=li(r);n.markup.push(i),n.markup.sort(_n),t("GET_MARKUP_UTIL")!=="draw"&&e("MARKUP_SELECT",{id:i[1].id}),n.crop.isDirty=!0},MARKUP_SELECT:function(r){var i=r.id;n.markup.forEach(function(o){o[1].isSelected=o[1].id===i,o[1].isDirty=!0})},MARKUP_ELEMENT_DRAG:function(r){var i=r.id,o=r.origin,a=r.offset,l=r.size,u=n.markup.find(function(m){return m[1].id===i});if(u){var c=u[1],s=o.x/l.width,d=o.y/l.height,f=o.width/l.width,h=o.height/l.height,p=a.x/l.width,g=a.y/l.height;c.x=s+p,c.y=d+g,c.width=f,c.height=h,c.left=void 0,c.top=void 0,c.right=void 0,c.bottom=void 0,c.isDirty=!0,n.crop.isDirty=!0}},MARKUP_ELEMENT_RESIZE:function(r){var i=r.id,o=r.corner,a=r.origin,l=r.offset,u=r.size,c=n.markup.find(function(_){return _[1].id===i});if(c){var s=Ge(c,2),d=s[0],f=s[1],h=(a.x+l.x)/u.width,p=(a.y+l.y)/u.height;if(/n/.test(o))if(d==="line")f.height=f.height-(p-f.y),f.y=p;else{var g=f.y+f.height;p>g&&(p=g),f.height=f.height-(p-f.y),f.y=p}if(/w/.test(o))if(d==="line")f.width=f.width-(h-f.x),f.x=h;else{var m=f.x+f.width;h>m&&(h=m),f.width=f.width-(h-f.x),f.x=h}/s/.test(o)&&(f.height=d==="line"?p-f.y:Math.max(0,p-f.y)),/e/.test(o)&&(f.width=d==="line"?h-f.x:Math.max(0,h-f.x)),f.left=void 0,f.top=void 0,f.right=void 0,f.bottom=void 0,f.isDirty=!0,n.crop.isDirty=!0}},MARKUP_DELETE:function(r){var i=r.id,o=n.markup.find(function(s){return s[1].id===i});if(o){var a=o[1];a.allowDestroy&&(a.isDestroyed=!0,a.isSelected=!1,a.isDirty=!0);for(var l=null,u=n.markup.length;u>0;){u--;var c=n.markup[u][1];if(!c.isDestroyed&&c.allowDestroy){l=c.id;break}}e("MARKUP_SELECT",{id:l})}},MARKUP_UPDATE:function(r){var i=r.style,o=r.value;n.markupToolValues[i]=o,n.markup.map(function(a){return a[1]}).filter(function(a){return a.isSelected}).forEach(function(a){if(i==="color")a[vs(a)]=o;else if(i==="shapeStyle"){var l=ys(a);a.borderColor=l,a.borderWidth=o[0],a.borderStyle=o[1],a.backgroundColor=o[0]||o[1]?null:l,a.backgroundColor!==null&&(a.borderColor=null)}else i==="lineStyle"?(a.lineWidth=o[0],a.lineStyle=o[1]):a[i]=o;a.isDirty=!0}),n.crop.isDirty=!0}},["color","shapeStyle","lineStyle","textDecoration","fontSize","fontFamily"].reduce(function(r,i){var o=i.split(/(?=[A-Z])/).join("_").toUpperCase(),a=Qe(i);return r["SET_MARKUP_"+o]=function(l){var u=l.value;u!==l.prevValue&&(n.options["markup".concat(a)]=u,e("MARKUP_UPDATE",{style:i,value:u}))},r},{}),{DID_SET_CROP:function(r){var i=r.value;i!==r.prevValue&&e("SET_DATA",{crop:i})},COLOR_SET_COLOR_VALUE:function(r){var i=r.key,o=r.value;n.crop.isDirty=!0,e("COLOR_SET_VALUE",{key:i,value:o})},COLOR_SET_VALUE:function(r){var i=r.key,o=r.value;n.colorValues[i]=o,e("SET_COLOR_MATRIX",{key:i,matrix:tn[i](o)})}},Object.keys(tn).reduce(function(r,i){var o=i.toUpperCase(),a=Qe(i);return r["SET_COLOR_".concat(o)]=function(l){var u=l.value;if(u!==l.prevValue){var c=Ge(t("GET_COLOR_".concat(o,"_RANGE")),2),s=c[0],d=c[1],f=Ht(u,s,d);n.options["color".concat(a)]=f,n.instructions.color||(n.instructions.color={}),n.instructions.color[i]=f,e("COLOR_SET_VALUE",{key:i,value:f})}},r},{}),{SET_COLOR_MATRIX:function(r){var i=r.key,o=r.matrix;o?n.colorMatrices[i]=Ft(o):delete n.colorMatrices[i],e("DID_SET_COLOR_MATRIX",{key:i,matrix:o})},FILTER_SET_FILTER:function(r){var i=r.value;n.crop.isDirty=!0,e("FILTER_SET_VALUE",{value:i})},FILTER_SET_VALUE:function(r){var i=r.value,o=mo(i)?i:null;if(Rt(i)){var a=t("GET_FILTERS");ht(a,function(l,u){l===i&&(o=u.matrix())})}n.filter=i,n.filterName=Rt(i)?i:null,e("SET_COLOR_MATRIX",{key:"filter",matrix:o})},DID_SET_UTIL:function(r){var i=r.value;r.prevValue,n.options.utils.indexOf(i)!==-1&&e("CHANGE_VIEW",{id:i})},DID_SET_FILTER:function(r){var i=r.value;i!==r.prevValue&&(i&&i.id&&(i=i.id),e("FILTER_SET_VALUE",{value:i}),e("SET_DATA",{filter:i}))},DID_SET_SIZE:function(r){var i=r.value;i!==r.prevValue&&e("SET_DATA",{size:i})},DID_SET_MARKUP_UTIL:function(r){var i=r.value;i!==r.prevValue&&i&&(/^(draw|line|text|rect|ellipse)$/.test(i)||(i="select"),e("SWITCH_MARKUP_UTIL",{util:i}))},DID_SET_MARKUP:function(r){var i=r.value,o=r.prevValue;i!==o&&JSON.stringify(i)===JSON.stringify(o)||(e("MARKUP_SET_VALUE",{value:i}),e("SET_DATA",{markup:i}))},SET_DATA:function(r){if(r.size){var i=I({width:null,height:null},r.size),o=Ue(i,t("GET_SIZE_MIN"),t("GET_SIZE_MAX"),null);n.instructions.size=I({},o),e("RESIZE_SET_OUTPUT_SIZE",o)}r.filter&&(n.instructions.filter=r.filter?r.filter.id||r.filter.matrix:r.colorMatrix),n.instructions.markup=r.markup||[],n.instructions.markup.forEach(function(a){return a[1].isDirty=!0}),n.instructions.color=Object.keys(tn).reduce(function(a,l){var u=r.color===void 0||r.color[l]===void 0,c=n.options["color".concat(Qe(l))];return a[l]=u?c:Dt(r.color[l])?r.color[l]:r.color[l].value,a},{}),r.crop&&(n.instructions.crop=lr(t,n,r.crop,n.size),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,n.instructions.crop.scaleToFit===!1&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),_o(n,t))},DID_SET_INITIAL_STATE:function(r){var i=r.value||{},o=i.crop,a=i.filter,l=i.color,u=i.size,c=u===void 0?{}:u,s=i.markup,d=s===void 0?[]:s,f=I({width:null,height:null},c),h=Ue(f,t("GET_SIZE_MIN"),t("GET_SIZE_MAX"),null);n.instructions.size=I({},h),n.instructions.crop=lr(t,n,o),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,n.instructions.crop.scaleToFit===!1&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),n.instructions.filter=a||null,n.instructions.color=Object.keys(tn).reduce(function(p,g){return p[g]=l===void 0||l[g]===void 0?n.options["color".concat(Qe(g))]:l[g],p},{}),n.instructions.markup=d,n.crop.isDirty=!0},GET_DATA:function(r){var i=r.success,o=r.failure,a=r.file,l=r.data;if(!n.file)return o("no-image-source");if(!n.stage)return o("image-not-fully-loaded");var u={file:_r(a)?a:t("GET_OUTPUT_FILE"),data:_r(l)?l:t("GET_OUTPUT_DATA"),success:i,failure:o};e(u.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",u)},REQUEST_PREPARE_OUTPUT:function(r){var i=r.file,o=r.data,a=r.success,l=r.failure;e("PREPARE_OUTPUT",{file:i,data:o,success:a,failure:l},!0),e("DID_REQUEST_PREPARE_OUTPUT")},PREPARE_OUTPUT:function(r){var i=r.file,o=r.data,a=r.success,l=a===void 0?function(){}:a,u=r.failure,c=u===void 0?function(){}:u;if(le(n))return e("ABORT_IMAGE");var s=function(d){if(e("DID_PREPARE_OUTPUT"),le(n))return e("ABORT_IMAGE");l(d)};Ts({file:i,data:o},n,t).then(function(d){var f=n.options.afterCreateOutput,h=f?f(d,function(p,g){return e("DID_REQUEST_POSTPROCESS_OUTPUT",{label:p,progress:g}),function(m){e("DID_MAKE_PROGRESS",{progress:m})}}):d;Promise.resolve(h).then(s).catch(function(p){e("DID_REQUEST_POSTPROCESS_OUTPUT_ERROR",{error:p})})}).catch(function(d){if(le(n))return e("ABORT_IMAGE");c(d)})},EDIT_RESET:function(){st(n),ci(n,t,e)},EDIT_CONFIRM:function(){if(n.file&&n.stage){st(n),e("CROP_ZOOM");var r={file:t("GET_OUTPUT_FILE"),data:t("GET_OUTPUT_DATA"),success:function(i){n.filePromise.resolveOnConfirm&&n.filePromise.success(i),e("DID_CONFIRM",{output:i})},failure:console.error};e(r.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",r)}},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.success(null),e("DID_CANCEL")},EDIT_CLOSE:function(){st(n)},EDIT_DESTROY:function(){ln(n)},SET_OPTIONS:function(r){var i=r.options;ht(i,function(o,a){e("SET_".concat(jn(o,"_").toUpperCase()),{value:a})})}})},X=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:24;return'<svg width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">').concat(e,"</svg>")},Tt=D({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},apis:["id"],listeners:!0},tag:"button",create:function(e){var t=e.root,n=e.props;t.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),t.element.setAttribute("type",n.type||"button"),n.name&&n.name.split(" ").forEach(function(r){t.element.className+=" doka--button-".concat(r)}),t.ref.handleClick=function(){typeof n.action=="string"?t.dispatch(n.action):n.action()},t.element.addEventListener("click",t.ref.handleClick),t.ref.handlePointer=function(r){return r.stopPropagation()},t.element.addEventListener("pointerdown",t.ref.handlePointer),n.create&&n.create({root:t,props:n})},destroy:function(e){var t=e.root;t.element.removeEventListener("pointerdown",t.ref.handlePointer),t.element.removeEventListener("click",t.ref.handleClick)}}),Ds=function(e){return D({ignoreRect:!0,tag:e,create:function(t){var n=t.root,r=t.props;n.element.textContent=r.text}})},Us=D({name:"status-progress",tag:"svg",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["progress"],animations:{progress:{type:"spring",stiffness:.25,damping:.25,mass:2.5}}},create:function(e){var t=e.root,n=e.props;t.element.setAttribute("data-value",0),t.element.setAttribute("width",24),t.element.setAttribute("height",24),t.element.setAttribute("viewBox","0 0 20 20");var r=t.ref.circle=document.createElementNS("http://www.w3.org/2000/svg","circle"),i={r:5,cx:10,cy:10,fill:"none",stroke:"currentColor","stroke-width":10,transform:"rotate(-90) translate(-20)"};t.element.appendChild(r),Object.keys(i).forEach(function(o){r.setAttribute(o,i[o])}),t.ref.updateStroke=function(o){t.ref.circle.setAttribute("stroke-dasharray","".concat(31.42*Math.min(1,o)," 31.42"))},typeof n.progress=="number"?(t.progress=n.progress,t.element.setAttribute("data-value",Math.max(n.progress,.001)),t.ref.updateStroke(t.progress)):t.progress=0},write:dt({DID_MAKE_PROGRESS:function(e){var t=e.root,n=e.action;t.progress=n.progress,t.element.setAttribute("data-value",Math.max(n.progress,.001))}},function(e){var t=e.root;t.ref.updateStroke(t.progress)})}),Vs=D({name:"status-bubble-inner",create:function(e){var t=e.root,n=e.props;n.onClose?t.appendChildView(t.createChildView(Tt,{label:"Close",name:"icon-only status-bubble-close",icon:X('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),action:n.onClose})):t.ref.progressIndicator=t.appendChildView(t.createChildView(Us,{progress:n.progress})),t.appendChildView(t.createChildView(Ds("p"),{text:n.label}))}}),Ns=D({name:"status-bubble",mixins:{styles:["opacity","translateY"],apis:["markedForRemoval"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}},create:function(e){var t=e.root,n=e.props;return t.appendChildView(t.createChildView(Vs,n))}}),si=function(e){e.element.dataset.viewStatus="idle",Eo(e)},Eo=function(e){e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0,t.markedForRemoval=!0})},Re=function(e,t,n,r){e.element.dataset.viewStatus="busy";var i=Bs(e,t,n,r);Eo(e),e.ref.busyIndicators.push(i),i.markedForRemoval=!1,i.translateY=0,i.opacity=1},Bs=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return e.appendChildView(e.createChildView(Ns,{translateY:20,opacity:0,label:t,onClose:n,progress:r}))},Fs=D({name:"edit-status",ignoreRect:!0,create:function(e){var t=e.root;t.ref.busyIndicators=[],t.element.setAttribute("tabindex",-1)},write:dt({MISSING_WEBGL:function(e){var t=e.root,n=/fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE"));Re(t,t.query("GET_LABEL_STATUS_MISSING_WEB_G_L"),n?function(){t.dispatch("EDIT_CANCEL")}:null)},AWAITING_IMAGE:function(e){var t=e.root;Re(t,t.query("GET_LABEL_STATUS_AWAITING_IMAGE"))},DID_PRESENT_IMAGE:function(e){var t=e.root;si(t)},DID_LOAD_IMAGE_ERROR:function(e){var t=e.root,n=e.action,r=/fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE")),i=t.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"),o=typeof i=="function"?i(n.error):i;Re(t,o,r?function(){t.dispatch("EDIT_CANCEL")}:null)},DID_REQUEST_LOAD_IMAGE:function(e){var t=e.root;Re(t,t.query("GET_LABEL_STATUS_LOADING_IMAGE"))},DID_REQUEST_PREPARE_OUTPUT:function(e){var t=e.root;Re(t,t.query("GET_LABEL_STATUS_PROCESSING_IMAGE"))},DID_REQUEST_POSTPROCESS_OUTPUT:function(e){var t=e.root,n=e.action;Re(t,n.label,null,n.progress)},DID_REQUEST_POSTPROCESS_OUTPUT_ERROR:function(e){var t=e.root,n=e.action.error;Re(t,n,function(){return t.dispatch("DID_PREPARE_OUTPUT")})},DID_PREPARE_OUTPUT:function(e){var t=e.root;si(t)}}),didWriteView:function(e){var t=e.root;t.ref.busyIndicators=t.ref.busyIndicators.filter(function(n){return!n.markedForRemoval||n.opacity!==0||(t.removeChildView(n),!1)})}}),wo={down:"pointerdown",move:"pointermove",up:"pointerup"},To=function(){var e=[],t=function(n){return e.findIndex(function(r){return r.pointerId===n.pointerId})};return{update:function(n){var r=t(n);r<0||(e[r]=n)},multiple:function(){return e.length>1},count:function(){return e.length},active:function(){return e.concat()},push:function(n){(function(r){return t(r)>=0})(n)||e.push(n)},pop:function(n){var r=t(n);r<0||e.splice(r,1)}}},pe=function(e,t,n,r){return e.addEventListener(wo[t],n,r)},Jt=function(e,t,n){return e.removeEventListener(wo[t],n)},Wt=function(e,t){if("contains"in e)return e.contains(t);var n=t;do if(n===e)return!0;while(n=n.parentNode);return!1},re=function(e,t,n,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{stopPropagation:!0,cancelOnMultiple:!1},o={x:0,y:0},a={enabled:!0,origin:null,cancel:!1,cancelled:!1,pointers:To()},l=null,u=function(h,p){p&&(l||c(h,p),cancelAnimationFrame(l),l=requestAnimationFrame(function(){c(h,p),l=null}))},c=function(h,p){return p.apply(null,[h,function(g){return{x:g.pageX-o.x,y:g.pageY-o.y}}(h)])},s=function(h){var p=a.pointers.count()===0;p&&(a.active=!1,a.cancel=!1,a.cancelled=!1),(e===h.target||Wt(e,h.target))&&(p?h.isPrimary&&(a.pointers.push(h),pe(document.documentElement,"up",f),h.preventDefault(),i.stopPropagation&&(h.stopPropagation(),h.stopImmediatePropagation()),a.active=!0,o.x=h.pageX,o.y=h.pageY,pe(document.documentElement,"move",d),t(h)):i.cancelOnMultiple&&(a.cancel=!0))},d=function(h){h.isPrimary&&(a.cancelled||(h.preventDefault(),i.stopPropagation&&h.stopPropagation(),u(h,n),a.cancel&&(a.cancelled=!0,u(h,r))))},f=function h(p){a.pointers.pop(p),a.pointers.count()===0&&(Jt(document.documentElement,"move",d),Jt(document.documentElement,"up",h)),a.active&&(a.cancelled||(p.preventDefault(),i.stopPropagation&&p.stopPropagation(),u(p,n),u(p,r)))};return pe(document.documentElement,"down",s),{enable:function(){a.enabled||pe(document.documentElement,"down",s),a.enabled=!0},disable:function(){a.enabled&&Jt(document.documentElement,"down",s),a.enabled=!1},destroy:function(){Jt(document.documentElement,"up",f),Jt(document.documentElement,"move",d),Jt(document.documentElement,"down",s)}}},pt={type:"spring",stiffness:.4,damping:.65,mass:7},di=function(e,t,n){if(/^(line|text|ellipse|rect)$/.test(n))e.dispatch("MARKUP_ADD_DEFAULT",{value:n}),e.dispatch("SET_MARKUP_UTIL",{value:"select"});else if(n==="draw"&&!e.ref.drawInput){var r=e.ref,i=r.drawState,o=r.viewSize,a=0,l=0,u={},c=e.query("GET_MARKUP_DRAW_DISTANCE");e.ref.drawInput=re(e.element,function(s){var d=e.query("GET_MARKUP_TOOL_VALUES"),f=d.lineStyle[0],h=d.lineStyle[1];i.lineColor=d.color,i.lineWidth=f,i.lineStyle=h;var p=e.query("GET_ROOT"),g=s.offsetX!==void 0?s.offsetX:s.pageX-p.x-t.stageOffsetX-window.pageXOffset,m=s.offsetY!==void 0?s.offsetY:s.pageY-p.y-t.stageOffsetY-window.pageYOffset;a=g-e.markupX,l=m-e.markupY,u.x=0,u.y=0,i.points.push({x:a/o.width,y:l/o.height})},function(s,d){if(e.dispatch("KICK"),c){var f=cn(d,u);if(f>c){var h=Dc(u,d)+Math.PI/2,p=c-f;u.x+=Math.sin(h)*p,u.y-=Math.cos(h)*p,i.points.push({x:(a+u.x)/o.width,y:(l+u.y)/o.height})}}else i.points.push({x:(a+d.x)/o.width,y:(l+d.y)/o.height})},function(s,d){i.points.length>1&&e.dispatch("MARKUP_ADD",["path",I({},i)]),i.points=[]})}n!=="draw"&&e.ref.drawInput&&(e.ref.drawInput.destroy(),e.ref.drawInput=null)},zs=function(e){var t=e.fontColor,n=e.backgroundColor,r=e.lineColor,i=e.borderColor;return t||n||r||i},kn=10,de=function(e,t){return Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})},Hs="http://www.w3.org/2000/svg",Kt=function(e,t){var n=document.createElementNS(Hs,e);return t&&de(n,t),n},Ro=["nw","se"],Ao=["nw","n","ne","w","e","sw","s","se"],Ws={nw:"nwse",n:"ns",ne:"nesw",w:"ew",e:"ew",sw:"nesw",s:"ns",se:"nwse"},qs={nw:function(e){return{x:e.x,y:e.y}},n:function(e){return{x:e.x+.5*e.width,y:e.y}},ne:function(e){return{x:e.x+e.width,y:e.y}},w:function(e){return{x:e.x,y:e.y+.5*e.height}},e:function(e){return{x:e.x+e.width,y:e.y+.5*e.height}},sw:function(e){return{x:e.x,y:e.y+e.height}},s:function(e){return{x:e.x+.5*e.width,y:e.y+e.height}},se:function(e){return{x:e.x+e.width,y:e.y+e.height}}},Ot=5,Ys={nw:function(e){return{x:e.x-Ot,y:e.y-Ot}},n:function(e){return{x:e.x+.5*e.width,y:e.y-Ot}},ne:function(e){return{x:e.x+e.width+Ot,y:e.y-Ot}},w:function(e){return{x:e.x-Ot,y:e.y+.5*e.height}},e:function(e){return{x:e.x+e.width+Ot,y:e.y+.5*e.height}},sw:function(e){return{x:e.x-Ot,y:e.y+e.height+Ot}},s:function(e){return{x:e.x+.5*e.width,y:e.y+e.height+Ot}},se:function(e){return{x:e.x+e.width+Ot,y:e.y+e.height+Ot}}},Zs=D({tag:"div",name:"image-markup",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:"spring",markupX:pt,markupY:pt,markupWidth:pt,markupHeight:pt},listeners:!0,apis:["toolsReference","onSelect","onDrag","markupX","markupY","markupWidth","markupHeight","allowInteraction","stageOffsetX","stageOffsetY"]},create:function(e){var t=e.root,n=e.props,r=n.onSelect,i=r===void 0?function(){}:r,o=n.onUpdate,a=o===void 0?function(){}:o,l=Kt("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"});t.ref.canvas=l;var u=t.query("GET_ROOT_SIZE");l.setAttribute("width",u.width),l.setAttribute("height",u.height);var c=document.createElement("input");de(c,{type:"text",autocomplete:"off",autocapitalize:"off"}),c.addEventListener("keydown",function(R){R.stopPropagation(),R.keyCode===13||R.keyCode===9?(R.target.blur(),d()):R.keyCode!==8||t.ref.input.value.length||t.dispatch("MARKUP_DELETE",{id:t.ref.selected.id})}),t.ref.input=c,t.ref.elements=[],t.ref.viewSize={width:0,height:0,scale:0},t.ref.resetSelected=function(){return t.ref.selected={id:null,type:null,settings:{}},t.ref.selected},t.ref.resetSelected();var s=function(R){return R.id?R:R.parentNode},d=function(){t.ref.resetSelected(),i(null)};t.ref.handleDeselect=function(R){var x;(t.query("IS_ACTIVE_VIEW","markup")||t.query("IS_ACTIVE_VIEW","sticker"))&&t.ref.selected.id&&R.target!==t.ref.removeButton.element&&(x=R.target,t.ref.selected.id!==s(x).id&&(function(b){return Wt(t.ref.manipulatorGroup,b)||b===t.ref.input}(R.target)||n.isMarkupUtil(R.target)||d()))},pe(document.body,"down",t.ref.handleDeselect),t.ref.handleTextInput=function(){return a("text",t.ref.input.value)},t.ref.input.addEventListener("input",t.ref.handleTextInput),t.ref.handleAttemptDelete=function(R){(t.query("IS_ACTIVE_VIEW","markup")||t.query("IS_ACTIVE_VIEW","sticker"))&&(!t.ref.selected.id||R.keyCode!==8&&R.keyCode!==46||(R.stopPropagation(),R.preventDefault(),t.dispatch("MARKUP_DELETE",{id:t.ref.selected.id})))},document.body.addEventListener("keydown",t.ref.handleAttemptDelete);var f=Kt("g"),h=Kt("g",{class:"doka--shape-group"});f.appendChild(h),t.ref.shapeGroup=h;var p=Kt("g",{fill:"none",class:"doka--manipulator-group"}),g=Kt("rect",{x:0,y:0,width:0,height:0,fill:"none"}),m=Kt("path");p.appendChild(m),p.appendChild(g),t.ref.manipulatorPath=m,t.ref.manipulatorRect=g,t.ref.manipulators=[];for(var _=0;_<10;_++){var y=Kt("circle",{r:6,"stroke-width":2}),v=Kt("circle",{r:22,class:"doka--hitbox",style:"opacity: 0"});p.appendChild(v),p.appendChild(y),t.ref.manipulators.push({visual:y,hitbox:v,dragger:null})}f.appendChild(p),t.ref.manipulatorGroup=p,l.appendChild(f),t.ref.shapeOffsetGroup=f,t.ref.removeButton=t.appendChildView(t.createChildView(Tt,{label:t.query("GET_LABEL_MARKUP_REMOVE_SHAPE"),name:"destroy-shape",action:function(){t.dispatch("MARKUP_DELETE",{id:t.ref.selected.id})}})),(t.query("IS_ACTIVE_VIEW","markup")||t.query("IS_ACTIVE_VIEW","sticker"))&&(t.element.dataset.active=!0),t.ref.drawInput=null,t.ref.drawState={lineColor:null,lineWidth:null,lineStyle:null,points:[]};var T=Kt("path",{fill:"none",class:"doka--draw-path"});t.ref.drawPath=T,l.appendChild(T);var A=z("div","doka--image-markup-clip");A.appendChild(c),A.appendChild(l),t.ref.clip=A,t.element.appendChild(A),t.query("GET_MARKUP_UTIL")==="draw"&&di(t,n,"draw")},destroy:function(e){var t=e.root;t.ref.elements.concat(t.ref.manipulators).forEach(function(n){n.dragger&&n.dragger.destroy()}),t.ref.input.removeEventListener("input",t.ref.handleTextInput),document.body.removeEventListener("keydown",t.ref.handleAttemptDelete),Jt(document.body,"down",t.ref.handleDeselect)},read:function(e){var t=e.root;if(!t.rect.element.hidden)for(var n in t.ref.elements){var r=t.ref.elements[n];if(r&&r.nodeName==="text"&&r.parentNode){var i=r.getBBox();r.bbox={x:i.x,y:i.y,width:i.width,height:i.height}}}},write:dt({SHOW_VIEW:function(e){var t=e.root,n=e.props,r=e.action;r.id==="markup"||r.id==="sticker"?t.element.dataset.active=!0:(t.element.dataset.active=!1,n.onSelect(null))},MARKUP_SET_VALUE:function(e){var t=e.root;ht(t.ref.elements,function(n,r){r&&r.dragger&&r.dragger.destroy()}),t.ref.elements=[],t.ref.shapeGroup.innerHTML=""},UPDATE_ROOT_RECT:function(e){var t=e.root,n=e.action,r=t.ref.canvas;r.setAttribute("width",n.rect.width),r.setAttribute("height",n.rect.height),t.ref.previousScale=null},SWITCH_MARKUP_UTIL:function(e){var t=e.root,n=e.action,r=e.props,i=n.util;di(t,r,i)}},function(e){var t=e.root,n=e.props,r=e.timestamp;if(!(t.opacity<=0)){var i=t.query("GET_CROP",n.id,r);if(i){var o=t.query("GET_MARKUP_UTIL");t.element.dataset.util=o||"";var a=i.markup,l=i.cropStatus,u=n.onSelect,c=n.onDrag,s=t.ref,d=s.clip,f=s.manipulatorGroup,h=s.drawPath,p=s.viewSize,g=s.shapeOffsetGroup,m=s.manipulators,_=s.manipulatorPath,y=s.manipulatorRect,v=s.removeButton,T=s.drawState,A=t.query("GET_OUTPUT_WIDTH"),R=t.query("GET_OUTPUT_HEIGHT"),x=l.image,b=l.crop,O=b.width,C=b.height,M=b.widthFloat/b.heightFloat;if(A||R){var S=t.query("GET_OUTPUT_FIT");A&&!R&&(R=A),R&&!A&&(A=R);var V,B=A/O,U=R/C;S==="force"?(O=A,C=R):(S==="cover"?V=Math.max(B,U):S==="contain"&&(V=Math.min(B,U)),O*=V,C*=V)}else x.width&&x.height?(O=x.width,C=x.height):x.width&&!x.height?(O=x.width,C=x.width/M):x.height&&!x.width&&(C=x.height,O=x.height*M);var q=T.points.length,L=N(t.markupX,3),k=N(t.markupY,3),H=N(t.markupWidth,3),F=N(t.markupHeight,3),P=N(Math.min(t.markupWidth/O,t.markupHeight/C),4);if(p.width=H,p.height=F,p.scale=P,Xs(t,{drawLength:q,markupX:L,markupY:k,scale:P,markup:a,currentWidth:O,currentHeight:C})){var rt=L,nt=t.rect.element.width-L-H,ot=k,at=t.rect.element.height-k-F,W="inset(".concat(ot,"px ").concat(nt,"px ").concat(at,"px ").concat(rt,"px)");if(d.style.clipPath=W,d.style.webkitClipPath=W,g.setAttribute("transform","translate(".concat(L," ").concat(k,")")),t.ref.previousDrawLength=q,t.ref.previousX=L,t.ref.previousY=k,t.ref.previousScale=P,t.ref.previousCurrentHeight=C,t.ref.previousCurrentWidth=O,t.ref.previousMarkupLength=a.length,!(p.width<1||p.height<1)){var ft,lt=a.find(function(et){return et[1].isSelected}),bt=lt&&t.ref.selected.id!==lt[1].id||t.ref.selected.id&&!lt;if(ft=lt?t.ref.selected={id:lt[1].id,type:lt[0],settings:lt[1]}:t.ref.resetSelected(),T.points.length){var yt=ge(T,p,P);return yt.d=Ar(T.points.map(function(et){return{x:L+et.x*p.width,y:k+et.y*p.height}})),void de(h,yt)}h.removeAttribute("d"),t.ref.input.hidden=t.ref.selected.type!=="text"||!t.ref.selected.settings.allowInput,v.element.dataset.active=t.ref.selected.id!==null,_.setAttribute("style","opacity:0"),y.setAttribute("style","opacity:0"),m.forEach(function(et){et.visual.setAttribute("style","opacity:0; pointer-events:none;"),et.hitbox.setAttribute("style","pointer-events:none;")});var gt=t.query("GET_MARKUP_FILTER");a.filter(gt).sort(_n).forEach(function(et,_t){var $t=Ge(et,2),j=$t[0],ct=$t[1],G=ct.id,Q=ct.isDestroyed,ut=ct.isDirty,J=ct.isSelected,Me=ct.allowSelect,An=ct.allowMove,tr=ct.allowResize,xn=ct.allowInput;if(Q){var me=t.ref.elements[G];me&&(me.dragger&&me.dragger.destroy(),t.ref.elements[G]=null,me.parentNode.removeChild(me))}else{var In,Pt,Cn,Y=t.ref.elements[G];if(Y||(Y=Lr(j,ct),t.ref.elements[G]=Y,Me?(Y.dragger=re(Y,function(){Pt=Date.now(),In=I({},Y.rect),(Cn=G===t.ref.selected.id)||u(G)},function(Gt,Ee){An&&c(G,In,Ee,p,P)},function(Gt,Ee){if(xn&&j==="text"&&Cn){var jt=Kn({x:0,y:0},Ee),ie=Date.now()-Pt;if(!(jt>10||ie>750)){t.ref.input.focus();var oe=t.markupX+Y.bbox.x,we=Y.bbox.width,Te=(Gt.offsetX-oe)/we,ae=Math.round(t.ref.input.value.length*Te);t.ref.input.setSelectionRange(ae,ae)}}}),Y.dragger.disable()):Y.setAttribute("style","pointer-events:none;")),Y.dragger&&(n.allowInteraction?Y.dragger.enable():Y.dragger.disable()),_t!==Y.index){Y.index=_t;var ve=t.ref.shapeGroup;ve.insertBefore(Y,ve.childNodes[_t+1])}if(ut&&Pr(Y,j,ct,p,P),J){var Ze=v.rect.element.width,ye=v.rect.element.height,Ut=t.markupX-.5*Ze,Vt=t.markupY-ye-15,$=j==="text"?Y.bbox:Y.rect,bn=!1,Sn=zs(ct);if(Sn){var Xe=vn(Sn);bn=(.2126*Xe[0]+.7152*Xe[1]+.0722*Xe[2])/255>.65,f.setAttribute("is-bright-color",bn)}j==="line"?(Ut+=$.x,Vt+=$.y,de(_,{d:"M ".concat($.x," ").concat($.y," L ").concat($.x+$.width," ").concat($.y+$.height),style:"opacity:1"})):j==="path"?(Ut+=($={x:ct.points[0].x*p.width,y:ct.points[0].y*p.height,width:0,height:0}).x,Vt+=$.y,de(_,{d:Ar(ct.points.map(function(Gt){return{x:Gt.x*p.width,y:Gt.y*p.height}})),style:"opacity:1"})):$&&(Ut+=$.x+.5*$.width,Vt+=$.y,de(y,{x:$.x-(j==="text"?5:0),y:$.y,width:$.width+(j==="text"?10:0),height:$.height,style:"opacity:1"}));var _e=t.markupY+kn,$e=t.markupY+t.markupHeight-kn,je=t.markupX+kn,Le=t.markupX+t.markupWidth-kn;if(Vt<_e?Vt=_e:Vt+ye>$e&&(Vt=$e-ye),Ut<je?Ut=je:Ut+Ze>Le&&(Ut=Le-Ze),$||(v.element.dataset.active="false"),v.element.setAttribute("style","transform: translate3d(".concat(Ut,"px, ").concat(Vt,"px, 0)")),j==="text"&&$&&xn){var er=$.width+65,nr=t.markupWidth-$.x,xt=`
                        width: `.concat(Math.min(er,nr),`px;
                        height: `).concat($.height,`px;
                        color: `).concat(Y.getAttribute("fill"),`;
                        font-family: `).concat(Y.getAttribute("font-family"),`;
                        font-size: `).concat(Y.getAttribute("font-size").replace(/px/,""),`px;
                        font-weight: `).concat(Y.getAttribute("font-weight")||"normal",`;
                    `);ze()?xt+=`
                            left: `.concat(Math.round(t.markupX+$.x),`px;
                            top: `).concat(Math.round(t.markupY+$.y),`px;
                        `):xt+=`
                            transform: translate3d(`.concat(Math.round(t.markupX+$.x),"px,").concat(Math.round(t.markupY+$.y),`px,0);
                        `),t.ref.input.setAttribute("style",xt),Y.setAttribute("fill","none")}if(j==="text"||!tr)return;var rr=j==="line"?Ro:Ao;m.forEach(function(Gt,Ee){var jt=rr[Ee];if(jt){var ie=j==="line"?"move":"".concat(Ws[jt],"-resize"),oe=qs[jt](Y.rect),we=Y.rect.width<100||Y.rect.height<100,Te=jt.length===2?1:we?0:1;de(Gt.visual,{cx:oe.x,cy:oe.y,style:"opacity:".concat(Te)});var ae=Ys[jt](Y.rect);de(Gt.hitbox,{cx:ae.x,cy:ae.y,style:"cursor:".concat(ie,";")})}})}ct.isDirty=!1}}),bt&&(js(t),ft.type==="text"&&t.ref.selected.settings.allowInput?t.ref.input.value=ft.settings.text:t.ref.selected.id&&$s(t,n.onResize))}}}}})}),nn=function(e){return e.forEach(function(t){return t[1].isDirty=!0})},Xs=function(e,t){var n=t.drawLength,r=t.markup,i=t.markupX,o=t.markupY,a=t.currentWidth,l=t.currentHeight,u=t.scale;return n!==e.ref.previousDrawLength||(i!==e.ref.previousX||o!==e.ref.previousY||u!==e.ref.previousScale||l!==e.ref.previousCurrentHeight||a!==e.ref.previousCurrentWidth?(nn(r),!0):r.length!==e.ref.previousMarkupLength||!!r.find(function(c){return c[1].isDirty}))},$s=function(e,t){var n=e.ref.selected.id,r=e.ref.elements[n].nodeName==="g"?Ro:Ao;e.ref.manipulators.forEach(function(i,o){var a=r[o];if(a){var l=null;i.dragger=re(i.hitbox,function(){l={x:parseFloat(gn(i.hitbox,"cx")),y:parseFloat(gn(i.hitbox,"cy"))}},function(u,c){t(n,a,l,c,e.ref.viewSize)},null,{stopPropagation:!0})}})},js=function(e){e.ref.manipulators.forEach(function(t){t.dragger&&(t.dragger.destroy(),t.dragger=null)})},fi={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},Ur=function(e,t,n,r,i){var o=null,a=!0,l={enabled:!0},u=function(s){var d=fi[s.keyCode]||s.keyCode;n[d]&&(s.stopPropagation(),a&&(o=t(d),a=!1),n[d](o),r(o))},c=function(s){var d=fi[s.keyCode]||s.keyCode;n[d]&&(s.stopPropagation(),i(o),a=!0)};return e.addEventListener("keydown",u),e.addEventListener("keyup",c),{enable:function(){l.enabled||(e.addEventListener("keydown",u),e.addEventListener("keyup",c)),l.enabled=!0},disable:function(){l.enabled&&(e.removeEventListener("keydown",u),e.removeEventListener("keyup",c)),l.enabled=!1},destroy:function(){e.removeEventListener("keydown",u),e.removeEventListener("keyup",c)}}},pi=function(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,i=arguments.length>4?arguments[4]:void 0;t=Math.round(t),n=Math.round(n);var o=i||document.createElement("canvas"),a=o.getContext("2d");return r>=5&&r<=8?(o.width=n,o.height=t):(o.width=t,o.height=n),a.save(),r!==-1&&a.transform.apply(a,uo(t,n,r)),a.drawImage(e,0,0,t,n),a.restore(),o},Ks=function(){self.onmessage=function(e){createImageBitmap(e.data.message.file).then(function(t){self.postMessage({id:e.data.id,message:t},[t])})}},Qs=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},Js=function(e){var t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return!((t?parseInt(t[1]):null)<=58)&&"createImageBitmap"in window&&Qs(e)},td=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(i){n(i)},r.src=e})},hi=function(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),r},ur=function(e,t,n){var r=e.createProgram();return e.attachShader(r,hi(e,t,e.VERTEX_SHADER)),e.attachShader(r,hi(e,n,e.FRAGMENT_SHADER)),e.linkProgram(r),r},ed=function(e,t,n,r,i){var o=e.createTexture();e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.uniform1i(t,r),e.uniform2f(n,i.width,i.height);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)}catch{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i.width,i.height,0,e.RGBA,e.UNSIGNED_BYTE,null)}return o},nd=function(){var e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},rd=function(e,t,n,r,i){var o=1/Math.tan(t/2),a=1/(r-i);e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,e[10]=(i+r)*a,e[14]=2*i*r*a},id=function(e,t){var n=t[0],r=t[1],i=t[2];e[12]=e[0]*n+e[4]*r+e[8]*i+e[12],e[13]=e[1]*n+e[5]*r+e[9]*i+e[13],e[14]=e[2]*n+e[6]*r+e[10]*i+e[14],e[15]=e[3]*n+e[7]*r+e[11]*i+e[15]},od=function(e,t){var n=t[0],r=t[1],i=t[2];e[0]=e[0]*n,e[1]=e[1]*n,e[2]=e[2]*n,e[3]=e[3]*n,e[4]=e[4]*r,e[5]=e[5]*r,e[6]=e[6]*r,e[7]=e[7]*r,e[8]=e[8]*i,e[9]=e[9]*i,e[10]=e[10]*i,e[11]=e[11]*i},ad=function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[4],o=e[5],a=e[6],l=e[7],u=e[8],c=e[9],s=e[10],d=e[11];e[4]=i*r+u*n,e[5]=o*r+c*n,e[6]=a*r+s*n,e[7]=l*r+d*n,e[8]=u*r-i*n,e[9]=c*r-o*n,e[10]=s*r-a*n,e[11]=d*r-l*n},ld=function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],a=e[2],l=e[3],u=e[8],c=e[9],s=e[10],d=e[11];e[0]=i*r-u*n,e[1]=o*r-c*n,e[2]=a*r-s*n,e[3]=l*r-d*n,e[8]=i*n+u*r,e[9]=o*n+c*r,e[10]=a*n+s*r,e[11]=l*n+d*r},cd=function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],a=e[2],l=e[3],u=e[4],c=e[5],s=e[6],d=e[7];e[0]=i*r+u*n,e[1]=o*r+c*n,e[2]=a*r+s*n,e[3]=l*r+d*n,e[4]=u*r-i*n,e[5]=c*r-o*n,e[6]=s*r-a*n,e[7]=d*r-l*n},Qt={create:nd,perspective:rd,translate:id,scale:od,rotateX:ad,rotateY:ld,rotateZ:cd},ud=function(e){return e*Math.PI/180},sd=`
precision mediump float;

uniform sampler2D uTexture;
uniform vec2 uTextureSize;

uniform float uColorOpacity;
uniform mat4 uColorMatrix;
uniform vec4 uColorOffset;

uniform vec4 uOverlayColor;
uniform vec2 uOverlayLeftTop;
uniform vec2 uOverlayRightBottom;

varying vec2 vTexCoord;
varying vec4 vPosition;

void main () {

    vec3 cB = vec3(1.0);

	vec4 cF = texture2D(uTexture, vTexCoord);
	
	vec4 cM = (cF * uColorMatrix) + uColorOffset;

    float r = max(0.0, cM.r * cM.a) + (cB.r * (1.0 - cM.a));
    float g = max(0.0, cM.g * cM.a) + (cB.g * (1.0 - cM.a));
    float b = max(0.0, cM.b * cM.a) + (cB.b * (1.0 - cM.a));

	vec4 color = vec4(r, g, b, cF.a);
	
	// test if falls within
    if ((gl_FragCoord.x < uOverlayLeftTop.x || gl_FragCoord.x > uOverlayRightBottom.x) || 
        (gl_FragCoord.y > uOverlayLeftTop.y || gl_FragCoord.y < uOverlayRightBottom.y)) {
		color *= uOverlayColor;
	}
	
    gl_FragColor = color * uColorOpacity;
}
`,dd=`
attribute vec4 aPosition;
attribute vec2 aTexCoord;
uniform mat4 uMatrix;

// send to fragment shader
varying vec2 vTexCoord;
varying vec4 vPosition;

void main () {
    vPosition = uMatrix * aPosition;
    gl_Position = vPosition;
    vTexCoord = aTexCoord;
}
`,fd=`
precision mediump float;

uniform vec2 uViewportSize;
uniform vec3 uColorStart;
uniform vec3 uColorEnd;
uniform vec2 uOverlayLeftTop;
uniform vec2 uOverlayRightBottom;
uniform vec4 uColorCanvasBackground;

void main() {

	float x = gl_FragCoord.x;
	float y = gl_FragCoord.y;

	vec2 center = vec2(.5, .5);
	vec2 st = vec2(x / uViewportSize.x, y / uViewportSize.y);
	float mixValue = distance(st, center) * 1.5; // expand outside view (same as doka--root::after)
	vec3 color = mix(uColorStart, uColorEnd, mixValue);

	if (uColorCanvasBackground[3] == 1.0) {

		float innerLeft = uOverlayLeftTop.x;
		float innerRight = uOverlayRightBottom.x;
		float innerTop = uOverlayRightBottom.y;
		float innerBottom = uOverlayLeftTop.y;

		if (x < innerLeft || x > innerRight || y < innerTop || y > innerBottom) {
			gl_FragColor = vec4(color, 1.0);
			return;
		}

		gl_FragColor = uColorCanvasBackground;
		return;
	}
	
	gl_FragColor = vec4(color, 1.0);
}
`,pd=`
precision mediump float;

uniform vec2 uOverlayLeftTop;
uniform vec2 uOverlayRightBottom;
uniform vec4 uOutlineColor;
uniform float uOutlineWidth;

void main() {

	float x = gl_FragCoord.x;
	float y = gl_FragCoord.y;

	float innerLeft = uOverlayLeftTop.x;
	float innerRight = uOverlayRightBottom.x;
	float innerTop = uOverlayRightBottom.y;
	float innerBottom = uOverlayLeftTop.y;

	float outerLeft = innerLeft - uOutlineWidth;
	float outerRight = innerRight + uOutlineWidth;
	float outerTop = innerTop - uOutlineWidth;
	float outerBottom = innerBottom + uOutlineWidth;
	
	if (x < outerLeft || x >= outerRight || y < outerTop || y >= outerBottom) {
		discard;
	}

	if (x < innerLeft || x >= innerRight || y < innerTop || y >= innerBottom) {
		gl_FragColor = uOutlineColor;
	}
}
`,gi=`
attribute vec4 aPosition;
void main() {
	gl_Position = aPosition;
}
`,hd=function(e,t,n){var r={width:0,height:0},i={x:0,y:0},o=null,a=ud(30),l=Math.tan(a/2),u={antialias:!1,alpha:!1},c=e.getContext("webgl",u)||e.getContext("experimental-webgl",u);if(!c)return null;c.enable(c.BLEND),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA);var s=ur(c,gi,fd),d=c.getUniformLocation(s,"uColorStart"),f=c.getUniformLocation(s,"uColorEnd"),h=c.getUniformLocation(s,"uViewportSize"),p=c.getAttribLocation(s,"aPosition"),g=c.getUniformLocation(s,"uOverlayLeftTop"),m=c.getUniformLocation(s,"uOverlayRightBottom"),_=c.getUniformLocation(s,"uColorCanvasBackground"),y=c.createBuffer(),v=new Float32Array([1,-1,1,1,-1,-1,-1,1]);c.bindBuffer(c.ARRAY_BUFFER,y),c.bufferData(c.ARRAY_BUFFER,v,c.STATIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,null);var T=ur(c,gi,pd),A=c.getAttribLocation(T,"aPosition"),R=c.getUniformLocation(T,"uOutlineWidth"),x=c.getUniformLocation(T,"uOutlineColor"),b=c.getUniformLocation(T,"uOverlayLeftTop"),O=c.getUniformLocation(T,"uOverlayRightBottom"),C=c.createBuffer(),M=new Float32Array([1,-1,1,1,-1,-1,-1,1]);c.bindBuffer(c.ARRAY_BUFFER,C),c.bufferData(c.ARRAY_BUFFER,M,c.STATIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,null);var S=ur(c,dd,sd);c.useProgram(S);var V=c.getUniformLocation(S,"uMatrix"),B=c.getUniformLocation(S,"uTexture"),U=c.getUniformLocation(S,"uTextureSize"),q=c.getUniformLocation(S,"uOverlayColor"),L=c.getUniformLocation(S,"uOverlayLeftTop"),k=c.getUniformLocation(S,"uOverlayRightBottom"),H=c.getUniformLocation(S,"uColorOpacity"),F=c.getUniformLocation(S,"uColorOffset"),P=c.getUniformLocation(S,"uColorMatrix"),rt=c.getAttribLocation(S,"aPosition"),nt=c.getAttribLocation(S,"aTexCoord"),ot=ed(c,B,U,0,t),at=t.width*n,W=t.height*n,ft=-.5*at,lt=.5*W,bt=.5*at,yt=-.5*W,gt=new Float32Array([ft,lt,ft,yt,bt,lt,bt,yt]),et=new Float32Array([0,0,0,1,1,0,1,1]),_t=gt.length/2,$t=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,$t),c.bufferData(c.ARRAY_BUFFER,gt,c.STATIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,null);var j=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,j),c.bufferData(c.ARRAY_BUFFER,et,c.STATIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,null);var ct=0,G=0,Q={release:function(){e.width=1,e.height=1},resize:function(ut,J){e.width=ut*n,e.height=J*n,e.style.width="".concat(ut,"px"),e.style.height="".concat(J,"px"),r.width=ut*n,r.height=J*n,i.x=.5*r.width,i.y=.5*r.height,o=r.width/r.height,c.viewport(0,0,c.canvas.width,c.canvas.height)},update:function(ut,J,Me,An,tr,xn,me,In,Pt,Cn,Y,ve,Ze,ye,Ut,Vt,$,bn,Sn){var Xe=Y?Y.height*n:r.height;ct=t.width*n,G=t.height*n,ut*=n,J*=n,Me*=n,An*=n;var _e=G/2/l*(r.height/Xe)*-1;_e/=-l*_e*2/r.height;var $e=.5*ct,je=.5*G;ut-=$e,J-=je;var Le=In,er=-(i.x-$e)+Me,nr=i.y-je-An,xt=Qt.create();Qt.perspective(xt,a,o,1,2*-_e),Qt.translate(xt,[er,nr,_e]),Qt.translate(xt,[ut,-J,0]),Qt.scale(xt,[Le,Le,Le]),Qt.rotateZ(xt,-me),Qt.translate(xt,[-ut,J,0]),Qt.rotateY(xt,xn),Qt.rotateX(xt,tr),c.clearColor(ye[0],ye[1],ye[2],1),c.clear(c.COLOR_BUFFER_BIT);var rr=ve.x*n,Gt=ve.y*n,Ee=ve.width*n,jt=ve.height*n,ie=rr,oe=ie+Ee,we=r.height-Gt,Te=r.height-(Gt+jt);c.useProgram(s),c.uniform3fv(d,Ut),c.uniform3fv(f,Vt),c.uniform4fv(_,Sn.map(function(ae,Uo){return Uo<3?ae/255:ae})),c.uniform2f(h,r.width,r.height),c.uniform2f(g,ie,we),c.uniform2f(m,oe,Te),c.bindBuffer(c.ARRAY_BUFFER,y),c.vertexAttribPointer(p,2,c.FLOAT,!1,0,0),c.enableVertexAttribArray(p),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.useProgram(S),c.bindFramebuffer(c.FRAMEBUFFER,null),c.bindTexture(c.TEXTURE_2D,ot),c.bindBuffer(c.ARRAY_BUFFER,$t),c.vertexAttribPointer(rt,2,c.FLOAT,!1,0,0),c.enableVertexAttribArray(rt),c.bindBuffer(c.ARRAY_BUFFER,j),c.vertexAttribPointer(nt,2,c.FLOAT,!1,0,0),c.enableVertexAttribArray(nt),c.uniformMatrix4fv(V,!1,xt),c.uniform2f(L,ie,we),c.uniform2f(k,oe,Te),c.uniform4fv(q,Ze),c.uniform1f(H,Cn),c.uniform4f(F,Pt[4],Pt[9],Pt[14],Pt[19]),c.uniformMatrix4fv(P,!1,[].concat(Ft(Pt.slice(0,4)),Ft(Pt.slice(5,9)),Ft(Pt.slice(10,14)),Ft(Pt.slice(15,19)))),c.drawArrays(c.TRIANGLE_STRIP,0,_t),c.useProgram(T),c.uniform1f(R,$),c.uniform4fv(x,bn),c.uniform2f(b,ie,we),c.uniform2f(O,oe,Te),c.bindBuffer(c.ARRAY_BUFFER,C),c.vertexAttribPointer(A,2,c.FLOAT,!1,0,0),c.enableVertexAttribArray(A),c.drawArrays(c.TRIANGLE_STRIP,0,4),Q.onupdate(c)},onupdate:function(){}};return Q},mi=function(e){var t=0,n={},r=zt(e),i=zt(e),o=zt(e),a=zt(e);return r.onupdate=function(l){return n.x=l},r.oncomplete=function(){return t++},i.onupdate=function(l){return n.y=l},i.oncomplete=function(){return t++},o.onupdate=function(l){return n.width=l},o.oncomplete=function(){return t++},a.onupdate=function(l){return n.height=l},a.oncomplete=function(){return t++},{interpolate:function(l){r.interpolate(l),i.interpolate(l),o.interpolate(l),a.interpolate(l)},setTarget:function(l){t=0,r.target=l?l.x:null,i.target=l?l.y:null,o.target=l?l.width:null,a.target=l?l.height:null},getRect:function(){return n},isStable:function(){return t===4}}},vi=function(e){var t=0,n={},r=zt(e),i=zt(e),o=zt(e);return r.onupdate=function(a){return n.r=a},r.oncomplete=function(){return t++},i.onupdate=function(a){return n.g=a},i.oncomplete=function(){return t++},o.onupdate=function(a){return n.b=a},o.oncomplete=function(){return t++},{interpolate:function(a){r.interpolate(a),i.interpolate(a),o.interpolate(a)},setTarget:function(a){t=0,r.target=a?a[0]:null,i.target=a?a[1]:null,o.target=a?a[2]:null},getColor:function(){return[n.r,n.g,n.b]},isStable:function(){return t===3}}},sr={stiffness:.25,damping:.25,mass:2.5},yi=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],gd=D({name:"image-gl",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["top","left","width","height","xOrigin","yOrigin","xTranslation","yTranslation","xRotation","yRotation","zRotation","scale","overlay","stage","colorMatrix","colorOpacity","overlayOpacity","outlineWidth","isDraft"],animations:{xTranslation:pt,yTranslation:pt,xOrigin:pt,yOrigin:pt,scale:pt,xRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},yRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},zRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},colorOpacity:{type:"tween",delay:150,duration:750},overlayOpacity:"spring",introScale:{type:"spring",stiffness:.25,damping:.75,mass:15},outlineWidth:pt}},create:function(e){var t=e.root;t.ref.canvas=document.createElement("canvas"),t.ref.canvas.width=0,t.ref.canvas.height=0,t.appendChild(t.ref.canvas),t.ref.gl=null,t.introScale=1,t.ref.isPreview=t.query("GET_STYLE_LAYOUT_MODE")==="preview",t.ref.shouldZoom=!t.ref.isPreview,t.ref.didZoom=!1,t.ref.backgroundColor=null,t.ref.backgroundColorSpring=vi(sr),t.ref.backgroundColorCenter=null,t.ref.backgroundColorCenterSpring=vi(sr),t.ref.overlaySpring=mi(pt),t.ref.stageSpring=mi(pt),t.ref.outlineSpring=zt(pt),t.ref.colorMatrixSpring=[],t.ref.colorMatrixStable=!0,t.ref.colorMatrixStableCount=0,t.ref.colorMatrixPositions=[];for(var n=0;n<20;n++)(function(){var s=n,d=zt(sr);d.target=yi[s],d.onupdate=function(f){t.ref.colorMatrixPositions[s]=f},d.oncomplete=function(){t.ref.colorMatrixStableCount++},t.ref.colorMatrixSpring[s]=d})();t.ref.dragger=re(t.element,function(){t.dispatch("CROP_IMAGE_DRAG_GRAB")},function(s,d){t.dispatch("CROP_IMAGE_DRAG",{value:d})},function(){t.dispatch("CROP_IMAGE_DRAG_RELEASE")},{cancelOnMultiple:!0});var r=0,i=0;t.ref.keyboard=Ur(t.element,function(){return r=0,i=0,{x:0,y:0}},{up:function(s){s.y-=20},down:function(s){s.y+=20},left:function(s){s.x-=20},right:function(s){s.x+=20},plus:function(){r+=.1,t.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:r}),t.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){r-=.1,t.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:r}),t.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){i-=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:i})},right_bracket:function(){i+=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:i})},h:function(){t.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){t.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){t.dispatch("CROP_RESET")},r:function(){t.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){t.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){t.dispatch("CROP_ZOOM")}},function(s){s&&t.dispatch("CROP_IMAGE_DRAG",{value:s})},function(s){s&&t.dispatch("CROP_IMAGE_DRAG_RELEASE")});var o=t.query("GET_FILE"),a=URL.createObjectURL(o.data),l=function(s){var d=po(s,{width:t.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:t.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")}),f=pi(s,d.width,d.height,o.orientation),h=Math.max(1,.75*window.devicePixelRatio),p=f.height/f.width,g=96*h,m=pi(f,p>1?g:g/p,p>1?g*p:g),_=f.getContext("2d").getImageData(0,0,f.width,f.height),y=m.getContext("2d").getImageData(0,0,m.width,m.height);zn(f),zn(m),t.ref.gl=hd(t.ref.canvas,_,h);var v=t.query("GET_OUTPUT_CANVAS_SYNC_TARGET");v&&(t.ref.gl.onupdate=function(){var T=t.ref.overlaySpring.getRect();v.getContext("2d").drawImage(t.ref.canvas,T.x*h,T.y*h,T.width*h,T.height*h,0,0,v.width,v.height)}),t.ref.gl?(t.dispatch("DID_RECEIVE_IMAGE_DATA",{previewData:_,thumbData:y}),t.dispatch("DID_PRESENT_IMAGE")):t.dispatch("MISSING_WEBGL")},u=function(){td(a).then(l)};if(Js(o.data)){var c=Gr(Ks);c.post({file:o.data},function(s){c.terminate(),s?l(s):u()})}else u();t.ref.canvasStyle=getComputedStyle(t.ref.canvas),t.ref.previousBackgroundColor,t.ref.previousLeft,t.ref.previousTop,t.ref.previousWidth,t.ref.previousHeight,t.element.dataset.showInteractionIndicator=!1,t.ref.handleFocus=function(s){s.keyCode===9&&(t.element.dataset.showInteractionIndicator=!0)},t.ref.handleBlur=function(s){t.element.dataset.showInteractionIndicator=!1},vr(t.element)("keyup",t.ref.handleFocus),vr(t.element)("blur",t.ref.handleBlur)},destroy:function(e){var t=e.root;t.ref.gl&&(t.ref.gl.release(),t.ref.gl=null),t.ref.dragger.destroy(),yr(t.element)("keyup",t.ref.handleFocus),yr(t.element)("blur",t.ref.handleBlur)},read:function(e){var t=e.root,n=t.ref.canvasStyle.backgroundColor,r=t.ref.canvasStyle.color;if(r!=="transparent"&&r!==""||(r=null),n!=="transparent"&&n!==""||(n=null),n&&n!==t.ref.previousBackgroundColor){var i=vn(n).map(function(a){return a/255}),o=(i[0]+i[1]+i[2])/3;t.ref.backgroundColor=i,t.ref.backgroundColorCenter=i.map(function(a){return o>.5?a-.15:a+.15}),t.ref.previousBackgroundColor=n}r&&r!==t.ref.previousOutlineColor&&(t.ref.outlineColor=vn(r).map(function(a){return a/255}).concat(1),t.ref.previousOutlineColor=r)},write:dt({SHOW_VIEW:function(e){var t=e.root;e.action.id==="crop"?(t.ref.dragger.enable(),t.element.setAttribute("tabindex","0")):(t.ref.dragger.disable(),t.element.removeAttribute("tabindex"))}},function(e){var t=e.root,n=e.props,r=(e.actions,e.timestamp);if(t.ref.gl&&n.width&&n.height){var i=t.ref,o=i.gl,a=i.previousWidth,l=i.previousHeight,u=i.shouldZoom,c=i.stageSpring,s=i.overlaySpring,d=i.backgroundColorSpring,f=i.backgroundColorCenterSpring;n.width===a&&n.height===l||(t.ref.gl.resize(n.width,n.height),t.ref.previousWidth=n.width,t.ref.previousHeight=n.height),n.left===t.ref.previousLeft&&n.top===t.ref.previousTop||(t.ref.canvas.style.transform="translate(".concat(-n.left,"px, ").concat(-n.top,"px)"),t.ref.previousLeft=n.left,t.ref.previousTop=n.top),u&&!t.ref.didZoom&&(t.introScale=null,t.introScale=1.15,t.introScale=1,t.ref.didZoom=!0),d.setTarget(t.ref.backgroundColor),d.interpolate(r);var h=d.isStable();f.setTarget(t.ref.backgroundColorCenter),f.interpolate(r);var p=f.isStable();t.ref.colorMatrixStableCount=0;var g=n.colorMatrix||yi,m=t.ref.colorMatrixSpring.map(function(T,A){return T.target=g[A],T.interpolate(r),t.ref.colorMatrixPositions[A]}),_=t.ref.colorMatrixStableCount===20;n.isDraft&&s.setTarget(null),s.setTarget(n.overlay),s.interpolate(r);var y=s.isStable();n.isDraft&&c.setTarget(null),c.setTarget(n.stage),c.interpolate(r);var v=c.isStable();return o.update(t.xOrigin,t.yOrigin,t.xTranslation+n.left,t.yTranslation+n.top,t.xRotation,t.yRotation,t.zRotation,t.scale*t.introScale,m,t.ref.isPreview?1:t.colorOpacity,c.getRect(),s.getRect(),[1,1,1,1-t.overlayOpacity],d.getColor(),f.getColor(),d.getColor(),t.outlineWidth,t.ref.outlineColor,t.query("GET_BACKGROUND_COLOR")),y&&v&&_&&h&&p}})}),md=D({name:"image",ignoreRect:!0,mixins:{apis:["offsetTop"]},create:function(e){var t=e.root,n=e.props;t.ref.imageGL=t.appendChildView(t.createChildView(gd)),/markup|sticker/.test(t.query("GET_UTILS"))&&(t.ref.markup=t.appendChildView(t.createChildView(Zs,{id:n.id,opacity:0,onSelect:function(r){t.dispatch("MARKUP_SELECT",{id:r})},onDrag:function(r,i,o,a,l){t.dispatch("MARKUP_ELEMENT_DRAG",{id:r,origin:i,offset:o,size:a,scale:l})},onResize:function(r,i,o,a,l){t.dispatch("MARKUP_ELEMENT_RESIZE",{id:r,corner:i,origin:o,offset:a,size:l})},onUpdate:function(r,i){t.dispatch("MARKUP_UPDATE",{style:r,value:i})},isMarkupUtil:function(r){var i=r;do if(i.className==="doka--markup-tools")return!0;while(i=i.parentNode);return!1}}))),t.ref.isModal=/modal/.test(t.query("GET_STYLE_LAYOUT_MODE"))},write:dt({DID_PRESENT_IMAGE:function(e){e.root.ref.imageGL.colorOpacity=1}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.ref.imageGL,o=t.ref.markup,a=t.query("GET_CROP",n.id,r);if(a){var l=a.isDraft,u=a.cropRect,c=a.cropStatus,s=a.origin,d=a.translation,f=a.translationBand,h=a.scale,p=a.scaleBand,g=a.rotation,m=a.rotationBand,_=a.flip,y=a.colorMatrix,v=t.query("GET_ROOT"),T=t.query("GET_STAGE"),A=T.x,R=T.y;l&&(i.scale=null,i.zRotation=null,i.xTranslation=null,i.yTranslation=null,i.xOrigin=null,i.yOrigin=null),i.colorMatrix=y;var x=t.query("IS_ACTIVE_VIEW","crop"),b=t.query("IS_ACTIVE_VIEW","markup")||t.query("IS_ACTIVE_VIEW","sticker"),O=x?.75:.95,C=I({},u),M=1,S=x?1:5;if(t.query("IS_ACTIVE_VIEW","resize")){var V=c.image.width,B=c.image.height;M=V===null&&B===null?c.crop.width/u.width:V===null?B/u.height:V/u.width,M/=window.devicePixelRatio;var U=u.width*M,q=u.height*M;C.x=C.x+(.5*u.width-.5*U),C.y=C.y+(.5*u.height-.5*q),C.width=U,C.height=q}var L=t.ref.isModal?0:v.left,k=t.ref.isModal?0:v.top,H=t.ref.isModal?0:v.width-t.rect.element.width,F=t.ref.isModal?0:v.height-t.rect.element.height-n.offsetTop,P=(h+p)*M;i.isDraft=l,i.overlayOpacity=O,i.xOrigin=s.x,i.yOrigin=s.y,i.xTranslation=d.x+f.x+A,i.yTranslation=d.y+f.y+R,i.left=L,i.top=k+n.offsetTop,i.width=t.rect.element.width+H,i.height=t.rect.element.height+F+n.offsetTop,i.scale=P,i.xRotation=_.vertical?Math.PI:0,i.yRotation=_.horizontal?Math.PI:0,i.zRotation=g.main+g.sub+m,i.stage={x:T.x+L,y:T.y+k+n.offsetTop,width:T.width,height:T.height},i.overlay={x:C.x+A+L,y:C.y+R+k+n.offsetTop,width:C.width,height:C.height},i.outlineWidth=S,o&&(l&&(o.translateX=null,o.translateY=null,o.markupX=null,o.markupY=null,o.markupWidth=null,o.markupHeight=null),o.opacity=x?.3:1,o.stageOffsetX=A,o.stageOffsetY=R,o.markupX=C.x+A,o.markupY=C.y+R,o.markupWidth=C.width,o.markupHeight=C.height,o.allowInteraction=b)}})}),Vr=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"group",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["opacity"],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return D({ignoreRect:!0,name:e,mixins:{styles:["opacity"].concat(Ft(t)),animations:I({opacity:{type:"spring",stiffness:.25,damping:.5,mass:5}},n)},create:function(r){var i=r.root,o=r.props;(o.controls||[]).map(function(a){var l=i.createChildView(a.view,a);a.didCreateView&&a.didCreateView(l),i.appendChildView(l)}),o.element&&i.element.appendChild(o.element)}})},vd=D({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue","options","onSelect"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(e){var t=e.root,n=e.props;t.element.setAttribute("role","list"),t.ref.handleClick=function(){return n.action&&n.action()},t.element.addEventListener("click",t.ref.handleClick),t.ref.activeOptions=null,t.ref.activeSelectedValue},write:function(e){var t=e.root,n=e.props;if(n.options!==t.ref.activeOptions&&(t.ref.activeOptions=n.options,t.childViews.forEach(function(i){return t.removeChildView(i)}),n.options.map(function(i){var o=t.createChildView(Tt,I({},i,{action:function(){return n.onSelect(i.value)}}));return t.appendChildView(o)})),n.selectedValue!==t.ref.activeSelectedValue){t.ref.activeSelectedValue=n.selectedValue;var r=n.options.findIndex(function(i){return ne(i.value)==="object"&&n.selectedValue?i.value[0]===i.label&&JSON.stringify(i.value.slice(1))===JSON.stringify(n.selectedValue)||JSON.stringify(i.value)===JSON.stringify(n.selectedValue):i.value===n.selectedValue});t.childViews.forEach(function(i,o){i.element.setAttribute("aria-selected",o===r)})}},destroy:function(e){var t=e.root;t.element.removeEventListener("click",t.ref.handleClick)}}),Ae=D({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{styles:["opacity"],animations:{opacity:"spring"},apis:["direction","selectedValue","options","onSelect"]},create:function(e){var t=e.root,n=e.props;t.ref.open=!1;var r=function(i){t.ref.open=i,t.dispatch("KICK")};t.ref.button=t.appendChildView(t.createChildView(Tt,I({},n,{action:function(){r(!t.ref.open)}}))),t.ref.list=t.appendChildView(t.createChildView(vd,I({},n,{opacity:0,action:function(){r(!1)}}))),t.ref.handleBodyClick=function(i){Wt(t.element,i.target)||r(!1)},t.element.addEventListener("focusin",function(i){i.target!==t.ref.button.element&&r(!0)}),t.element.addEventListener("focusout",function(i){i.relatedTarget&&(Wt(t.element,i.relatedTarget)||r(!1))}),document.body.addEventListener("click",t.ref.handleBodyClick)},destroy:function(e){var t=e.root;document.body.removeEventListener("click",t.ref.handleBodyClick)},write:function(e){var t=e.root,n=e.props;if(t.ref.list.opacity=t.ref.open?1:0,t.ref.list.selectedValue=n.selectedValue,t.ref.list.options=n.options,n.direction==="up"){var r=t.ref.list.rect.element.height;t.ref.list.translateY=(t.ref.open?-(r+5):-r)-t.rect.element.height}else t.ref.list.translateY=t.ref.open?0:-5}}),dr=312,yd=function(e,t){return D({name:e,ignoreRect:!0,create:t})},_d=D({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(e){for(var t=e.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">',r=0;r<=180;r+=2){var i=r*.9777777777777777-90+2,o=r%10==0?.5:.2;n+='<circle fill="currentColor" cx="'.concat(i,'" cy="').concat(0,'" r="').concat(o,'"/>'),r%10==0&&(n+='<text fill="currentColor" x="'.concat(i+(i<0?-2.25:i===0?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+r,"&deg;</text>"))}n+="</svg>",t.element.innerHTML=n}}),Ed=D({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity","translateY"],animations:{opacity:{type:"spring",damping:.5,mass:5},translateY:"spring"},apis:["rotation","animate","setAllowInteraction"]},create:function(e){var t=e.root,n=e.props;t.element.setAttribute("tabindex",0);var r=document.createElement("button");r.innerHTML="<span>".concat(t.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),r.className="doka--crop-rotator-center",r.addEventListener("click",function(){t.dispatch("CROP_IMAGE_ROTATE_CENTER")}),t.appendChild(r);var i=null;t.appendChildView(t.createChildView(yd("crop-rotator-line-mask",function(u){var c=u.root,s=u.props;i=c.appendChildView(c.createChildView(_d,{translateX:Math.round(s.rotation*dr)}))}),n)),t.ref.line=i;var o=document.createElement("div");o.className="doka--crop-rotator-bar",t.appendChild(o);var a=Math.PI/4,l=0;t.ref.dragger=re(o,function(){l=i.translateX/dr,t.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(u,c){var s=c.x/t.rect.element.width*(Math.PI/2),d=Ht(l+s,-a,a);t.dispatch("CROP_IMAGE_ROTATE",{value:-d})},function(){t.dispatch("CROP_IMAGE_ROTATE_RELEASE")},{stopPropagation:!0}),n.setAllowInteraction=function(u){u?t.ref.dragger.enable():t.ref.dragger.disable()},t.ref.keyboard=Ur(t.element,function(){l=0},{left:function(){l+=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:l})},right:function(){l-=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:l})}},function(){},function(){}),t.ref.prevRotation},destroy:function(e){var t=e.root;t.ref.dragger.destroy(),t.ref.keyboard.destroy()},write:function(e){var t=e.root,n=e.props,r=e.timestamp,i=n.animate,o=n.rotation;if(t.ref.prevRotation!==o){t.ref.prevRotation=o,i||o===0||(t.ref.line.translateX=null);var a=0,l=t.query("GET_CROP",n.id,r);if(l&&l.interaction&&l.interaction.rotation){var u=Dr(l.interaction.rotation).sub-o;a=.025*Math.sign(u)*Math.log10(1+Math.abs(u)/.025)}t.ref.line.translateX=Math.round((-o-a)*dr)}}}),Ie=["nw","ne","se","sw"],wd=function(e){return Ie[(Ie.indexOf(e)+2)%Ie.length]},fn=["n","e","s","w"],Td=function(e){return fn[(fn.indexOf(e)+2)%fn.length]},qt=Se()&&window.devicePixelRatio===1?function(e){return Math.round(e)}:function(e){return e},Rd=D({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),Ad=function(e){return D({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(e),mixins:{styles:["translateX","translateY","scaleX","scaleY"],apis:["setAllowInteraction"]},create:function(t){var n=t.root,r=t.props;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button");var i=e,o=Td(e);n.ref.dragger=re(n.element,function(){n.dispatch("CROP_RECT_DRAG_GRAB")},function(a,l){return n.dispatch("CROP_RECT_EDGE_DRAG",{offset:l,origin:i,anchor:o})},function(){return n.dispatch("CROP_RECT_DRAG_RELEASE")},{stopPropagation:!0,cancelOnMultiple:!0}),r.setAllowInteraction=function(a){a?n.ref.dragger.enable():n.ref.dragger.disable()},n.ref.keyboard=Ur(n.element,function(){return{x:0,y:0}},{up:function(a){a.y-=20},down:function(a){a.y+=20},left:function(a){a.x-=20},right:function(a){a.x+=20}},function(a){n.dispatch("CROP_RECT_DRAG_GRAB"),n.dispatch("CROP_RECT_EDGE_DRAG",{offset:a,origin:i,anchor:o})},function(){n.dispatch("CROP_RECT_DRAG_RELEASE")})},destroy:function(t){var n=t.root;n.ref.keyboard.destroy(),n.ref.dragger.destroy()}})},xd=function(e,t,n){return D({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(e),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:pt,translateY:pt,scaleX:{type:"spring",delay:n},scaleY:{type:"spring",delay:n},opacity:{type:"spring",delay:t}},apis:["setAllowInteraction"]},create:function(r){var i=r.root,o=r.props;i.element.classList.add("doka--crop-rect-corner"),i.element.setAttribute("role","button"),i.element.setAttribute("tabindex",-1);var a=e,l=wd(e);i.ref.dragger=re(i.element,function(){i.dispatch("CROP_RECT_DRAG_GRAB")},function(u,c){i.dispatch("CROP_RECT_CORNER_DRAG",{offset:c,origin:a,anchor:l})},function(){i.dispatch("CROP_RECT_DRAG_RELEASE")},{stopPropagation:!0,cancelOnMultiple:!0}),o.setAllowInteraction=function(u){u?i.ref.dragger.enable():i.ref.dragger.disable()}},destroy:function(r){r.root.ref.dragger.destroy()}})},Id=D({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{apis:["rectangle","draft","rotating","enabled"]},create:function(e){var t=e.root;t.ref.wasRotating=!1,Ie.forEach(function(r,i){var o=10*i,a=250+o+50,l=250+o;t.ref[r]=t.appendChildView(t.createChildView(xd(r,a,l),{opacity:0,scaleX:.5,scaleY:.5}))}),fn.forEach(function(r){t.ref[r]=t.appendChildView(t.createChildView(Ad(r)))}),t.ref.lines=[];for(var n=0;n<10;n++)t.ref.lines.push(t.appendChildView(t.createChildView(Rd,{opacity:0})));t.ref.animationDir=null,t.ref.previousRotating,t.ref.previousRect={},t.ref.previousEnabled,t.ref.previousDraft},write:function(e){var t=e.root,n=e.props,r=n.rectangle,i=n.draft,o=n.rotating,a=n.enabled;if(r&&(!no(r,t.ref.previousRect)||o!==t.ref.previousRotating||a!==t.ref.previousEnabled||i!==t.ref.previousDraft)){t.ref.previousRect=r,t.ref.previousRotating=o,t.ref.previousEnabled=a,t.ref.previousDraft=i;var l=t.ref,u=l.n,c=l.e,s=l.s,d=l.w,f=l.nw,h=l.ne,p=l.se,g=l.sw,m=l.lines,_=l.animationDir,y=r.x,v=r.y,T=r.x+r.width,A=r.y+r.height,R=A-v,x=T-y,b=Math.min(x,R);t.element.dataset.indicatorSize=b<80?"none":"default",fn.forEach(function(P){return t.ref[P].setAllowInteraction(a)}),Ie.forEach(function(P){return t.ref[P].setAllowInteraction(a)});var O=t.query("IS_ACTIVE_VIEW","crop");if(O&&_!=="in"?(t.ref.animationDir="in",Ie.map(function(P){return t.ref[P]}).forEach(function(P){P.opacity=1,P.scaleX=1,P.scaleY=1})):O||_==="out"||(t.ref.animationDir="out",Ie.map(function(P){return t.ref[P]}).forEach(function(P){P.opacity=0,P.scaleX=.5,P.scaleY=.5})),Dn(i,f,y,v),Dn(i,h,T,v),Dn(i,p,T,A),Dn(i,g,y,A),At(i,u,y,v,x/100,1),At(i,c,T,v,1,R/100),At(i,s,y,A,x/100,1),At(i,d,y,v,1,R/100),o){t.ref.wasRotating=!0;var C=m.slice(0,5),M=1/C.length;C.forEach(function(P,rt){At(i,P,y,v+R*(M+rt*M),x/100,.01),P.opacity=.5});var S=m.slice(5);M=1/S.length,S.forEach(function(P,rt){At(i,P,y+x*(M+rt*M),v,.01,R/100),P.opacity=.5})}else if(i){t.ref.wasRotating=!1;var V=m[0],B=m[1],U=m[2],q=m[3];At(i,V,y,v+.333*R,x/100,.01),At(i,B,y,v+.666*R,x/100,.01),At(i,U,y+.333*x,v,.01,R/100),At(i,q,y+.666*x,v,.01,R/100),V.opacity=.5,B.opacity=.5,U.opacity=.5,q.opacity=.5}else{var L=m[0],k=m[1],H=m[2],F=m[3];!t.ref.wasRotating&&L.opacity>0&&(At(i,L,y,v+.333*R,x/100,.01),At(i,k,y,v+.666*R,x/100,.01),At(i,H,y+.333*x,v,.01,R/100),At(i,F,y+.666*x,v,.01,R/100)),m.forEach(function(P){return P.opacity=0})}}}}),At=function(e,t,n,r,i,o){e&&(t.translateX=null,t.translateY=null,t.scaleX=null,t.scaleY=null),t.translateX=qt(n),t.translateY=qt(r),t.scaleX=i,t.scaleY=o},Dn=function(e,t,n,r){e&&(t.translateX=null,t.translateY=null),t.translateX=qt(n),t.translateY=qt(r)},_i=function(e,t){if(!/svg/.test(e.namespaceURI)||"innerHTML"in e)e.innerHTML=t;else{var n=document.createElement("div");n.innerHTML="<svg>"+t+"</svg>";for(var r=n.firstChild;r.firstChild;)e.appendChild(r.firstChild)}},Cd=D({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-mask",tag:"svg",mixins:{styles:["opacity","translateX","translateY"],animations:{scale:pt,maskWidth:pt,maskHeight:pt,translateX:pt,translateY:pt,opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","animate","maskWidth","maskHeight","scale"]},create:function(e){e.root.ref.writer=null},write:function(e){var t=e.root,n=t.query("GET_CROP_MASK");n!==t.ref.writer&&(t.ref.writer=n,t.ref.writerFn=n?n(t.element,_i):null,t.ref.writer||_i(t.element,""))},didWriteView:function(e){var t=e.root,n=e.props,r=n.maskWidth,i=n.maskHeight,o=n.scale;if(t.ref.writer&&r&&i&&(t.element.setAttribute("width",qt(r)),t.element.setAttribute("height",qt(i)),t.ref.writerFn)){var a=t.query("GET_CROP_MASK_INSET");t.ref.writerFn({x:o*a,y:o*a,width:r-o*a*2,height:i-o*a*2},{width:r,height:i})}}}),Un=function(e,t){var n=e.childNodes[0];n?t!==n.nodeValue&&(n.nodeValue=t):(n=document.createTextNode(t),e.appendChild(n))},Ei={type:"spring",stiffness:.25,damping:.1,mass:1},bd=D({ignoreRect:!0,name:"crop-size",mixins:{styles:["translateX","translateY","opacity"],animations:{translateX:"spring",translateY:"spring",opacity:"spring",sizeWidth:Ei,sizeHeight:Ei},apis:["sizeWidth","sizeHeight"],listeners:!0},create:function(e){var t=e.root,n=z("span");n.className="doka--crop-size-info doka--crop-resize-percentage",t.ref.resizePercentage=n,t.appendChild(n);var r=z("span");r.className="doka--crop-size-info";var i=z("span");i.className="doka--crop-size-multiply",i.textContent="\xD7";var o=z("span"),a=z("span");t.ref.outputWidth=o,t.ref.outputHeight=a,r.appendChild(o),r.appendChild(i),r.appendChild(a),t.appendChild(r),t.ref.previousValues={width:0,height:0,percentage:0}},write:function(e){var t=e.root,n=e.props,r=e.timestamp;if(!(t.opacity<=0)){var i=t.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=i.isDraft,l=t.ref,u=l.outputWidth,c=l.outputHeight,s=l.resizePercentage,d=l.previousValues,f=o.image,h=o.crop,p=o.currentWidth,g=o.currentHeight,m=f.width?Math.round(f.width/h.width*100):0;a&&(t.sizeWidth=null,t.sizeHeight=null),t.sizeWidth=p,t.sizeHeight=g;var _=Math.round(t.sizeWidth),y=Math.round(t.sizeHeight);_!==d.width&&(Un(u,_),d.width=_),y!==d.height&&(Un(c,y),d.height=y),m!==d.percentage&&(f.width?Un(s,"".concat(m,"%")):Un(s,""),d.percentage=m)}}}}),Sd=function(e,t){return D({ignoreRect:!0,name:e,mixins:t,create:function(n){var r=n.root,i=n.props;i.className&&r.element.classList.add(i.className),i.controls.map(function(o){var a=r.createChildView(o.view,o);o.didCreateView&&o.didCreateView(a),r.appendChildView(a)})}})},xo=function(){return console.log("Doka: localStorage not available")},Io=function(e){try{JSON.parse(localStorage.getItem(e)||"{}")}catch{xo()}return{}},Od=function(e,t,n){var r=Io(e);r[t]=n;try{localStorage.setItem(e,JSON.stringify(r))}catch{xo()}return n},Md=function(e,t,n){var r=Io(e);return r[t]===void 0?n:r[t]},Co=function(){return window.matchMedia("(pointer: fine) and (hover: hover)").matches},Ld=D({ignoreRect:!0,ignoreRectUpdate:!0,name:"instructions-bubble",mixins:{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:400}},apis:["seen"]},create:function(e){var t=e.root,n=e.props;return t.element.innerHTML=(n.iconBefore||"")+n.text},write:function(e){var t=e.root;e.props.seen&&(t.opacity=0)}}),wi={type:"spring",stiffness:.4,damping:.65,mass:7},Pd=D({name:"crop-subject",ignoreRect:!0,mixins:{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250},translateX:wi,translateY:wi}},create:function(e){var t=e.root,n=e.props;t.opacity=1,t.ref.timestampOffset=null,t.query("GET_CROP_ALLOW_INSTRUCTION_ZOOM")&&Co()&&(Md(t.query("GET_STORAGE_NAME"),"instruction_zoom_shown",!1)||(t.ref.instructions=t.appendChildView(t.createChildView(Ld,{opacity:0,seen:!1,text:t.query("GET_LABEL_CROP_INSTRUCTION_ZOOM"),iconBefore:X('<rect stroke-width="1.5" fill="none" stroke="currentColor" x="5" y="1" width="14" height="22" rx="7" ry="7"></rect><circle fill="currentColor" stroke="none" cx="12" cy="8" r="2"></circle>')})))),t.ref.maskView=t.appendChildView(t.createChildView(Cd)),t.query("GET_CROP_ALLOW_RESIZE_RECT")&&(t.ref.cropView=t.appendChildView(t.createChildView(Id))),t.query("GET_CROP_SHOW_SIZE")&&(t.ref.cropSize=t.appendChildView(t.createChildView(bd,{id:n.id,opacity:1,scaleX:1,scaleY:1,translateX:null}))),t.query("GET_CROP_ZOOM_TIMEOUT")||(t.ref.btnZoom=t.appendChildView(t.createChildView(Sd("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:Tt,label:t.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:X('<g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g>',26),action:function(){return t.dispatch("CROP_ZOOM")}}]})))},write:dt({CROP_IMAGE_RESIZE_MULTIPLY:function(e){var t=e.root,n=t.ref.instructions;n&&!n.seen&&(n.seen=!0,Od(t.query("GET_STORAGE_NAME"),"instruction_zoom_shown",!0))},CROP_RECT_DRAG_RELEASE:function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.ref.btnZoom;if(i){var o=t.query("GET_CROP",n.id,r).cropRect,a=o.x+.5*o.width,l=o.y+.5*o.height;i.translateX=a,i.translateY=l}}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.ref,o=i.cropView,a=i.maskView,l=i.btnZoom,u=i.cropSize,c=i.instructions;if(!t.query("IS_ACTIVE_VIEW","crop")&&o)return o.enabled=!1,t.ref.timestampOffset=null,void(u&&(u.opacity=0));t.ref.timestampOffset||(t.ref.timestampOffset=r);var s=t.query("GET_CROP",n.id,r);if(s){var d=s.cropRect,f=s.isRotating,h=s.isDraft,p=s.scale,g=t.query("GET_STAGE");if(t.translateX=g.x-t.rect.element.left,t.translateY=g.y-t.rect.element.top,o&&(o.draft=h,o.rotating=f,o.rectangle=d,o.enabled=!0),u){u.opacity=1,h&&(u.translateX=null,u.translateY=null);var m=Gd(t.rect.element,u.rect.element,d);u.translateX=h?m.x:qt(m.x),u.translateY=h?m.y:qt(m.y)}if(t.query("GET_CROP_MASK")&&(h&&(a.translateX=null,a.translateY=null,a.maskWidth=null,a.maskHeight=null),a.translateX=qt(d.x),a.translateY=qt(d.y),a.maskWidth=d.width,a.maskHeight=d.height,a.scale=p),s.canRecenter)c&&(c.opacity=0),l&&(l.opacity=s.isDraft?0:1);else if(l&&(l.opacity=0),c&&!c.seen&&!s.isDraft){var _=d.x+.5*d.width,y=d.y+.5*d.height;c.translateX=Math.round(_-.5*c.rect.element.width),c.translateY=Math.round(y-.5*c.rect.element.height),r-t.ref.timestampOffset>2e3&&(c.opacity=1)}}})}),Gd=function(e,t,n){var r=n.x,i=n.x+n.width,o=n.y+n.height,a=i-t.width-16,l=o-t.height-16;return t.width>n.width-32&&(a=r+(.5*n.width-.5*t.width),(l=o+16)>e.height-t.height&&(l=o-t.height-16)),{x:a=Math.max(0,Math.min(a,e.width-t.width)),y:l}},Pe=function(){return performance.now()},kd=function(e,t){var n=null,r=null;return function(){var i=arguments;if(!r)return e.apply(null,Array.from(arguments)),void(r=Pe());clearTimeout(n),n=setTimeout(function(){Pe()-r>=t&&(e.apply(null,Array.from(i)),r=Pe())},t-(Pe()-r))}},bo=function(e,t){for(;e.nodeType===1&&!t(e);)e=e.parentNode;return e.nodeType===1?e:null},rn=function(e,t){var n=bo(t,function(r){return r.classList.contains("doka--root")});return!!n&&Wt(n,e)},Ti=function(e){var t=e.root,n=e.props,r=e.action.position,i=n.pivotPoint,o=t.ref,a=o.indicatorA,l=o.indicatorB,u=i.x-r.x,c=i.y-r.y,s={x:i.x+u,y:i.y+c},d={x:i.x-u,y:i.y-c};a.style.cssText="transform: translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)"),l.style.cssText="transform: translate3d(".concat(d.x,"px, ").concat(d.y,"px, 0)")},on=function(e){return{x:e.pageX,y:e.pageY}},Dd=D({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint","scrollRect"]},create:function(e){var t=e.root,n=e.props;t.ref.isActive=!1,t.ref.isCropping=!1,t.ref.indicatorA=document.createElement("div"),t.appendChild(t.ref.indicatorA),t.ref.indicatorB=document.createElement("div"),t.appendChild(t.ref.indicatorB);var r=t.query("GET_CROP_RESIZE_KEY_CODES");t.ref.hasEnabledResizeModifier=r.length>0;var i={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},o=Pe();t.ref.state=i;var a=To(),l=0,u=!1;t.ref.resizeStart=function(h){if(t.ref.isActive&&(a.count()===0&&(u=!1),rn(t.element,h.target)&&(a.push(h),pe(document.documentElement,"up",t.ref.resizeEnd),a.multiple()))){h.stopPropagation(),h.preventDefault();var p=a.active(),g=on(p[0]),m=on(p[1]);l=cn(g,m),pe(document.documentElement,"move",t.ref.resizeMove),u=!0}},t.ref.resizeMove=function(h){if(t.ref.isActive&&u&&(h.preventDefault(),a.count()===2)){a.update(h);var p=a.active(),g=on(p[0]),m=on(p[1]),_=(cn(g,m)-l)/l;t.dispatch("CROP_IMAGE_RESIZE",{value:_})}},t.ref.resizeEnd=function(h){if(t.ref.isActive){a.pop(h);var p=a.count()===0;p&&(Jt(document.documentElement,"move",t.ref.resizeMove),Jt(document.documentElement,"up",t.ref.resizeEnd)),u&&(h.preventDefault(),p&&t.dispatch("CROP_IMAGE_RESIZE_RELEASE"))}},pe(document.documentElement,"down",t.ref.resizeStart);var c=performance.now(),s=0,d=1,f=kd(function(h){if(!t.ref.isCropping){var p=Math.sign(h.wheelDelta||h.deltaY),g=Pe(),m=g-c;c=g,(m>750||s!==p)&&(d=1,s=p),d+=.05*p,t.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,d)}),t.dispatch("CROP_IMAGE_RESIZE_RELEASE")}},100);t.ref.wheel=function(h){if(t.ref.isActive&&rn(t.element,h.target)){if(n.scrollRect){var p=n.scrollRect,g=t.query("GET_ROOT"),m=on(h),_={x:m.x-g.leftScroll,y:m.y-g.topScroll};if(_.x<p.x||_.x>p.x+p.width||_.y<p.y||_.y>p.y+p.height)return}h.preventDefault(),f(h)}},document.addEventListener("wheel",t.ref.wheel,{passive:!1}),t.ref.hasEnabledResizeModifier&&(t.ref.move=function(h){if(t.ref.isActive&&!t.ref.isCropping&&(i.position.x=h.pageX-t.ref.state.offsetX,i.position.y=h.pageY-t.ref.state.scrollY-t.ref.state.offsetY,i.enabled))if(rn(t.element,h.target)){t.element.dataset.state==="idle"&&t.dispatch("RESIZER_SHOW",{position:I({},i.position)}),h.preventDefault(),t.dispatch("RESIZER_MOVE",{position:I({},i.position)});var p=n.pivotPoint,g=p.x-i.position.x,m=p.y-i.position.y,_={x:p.x+g,y:p.y+m},y=I({},i.position);if(i.selecting){var v=(cn(_,y)-l)/l,T=performance.now();T-o>25&&(o=T,t.dispatch("CROP_IMAGE_RESIZE",{value:v}))}}else t.dispatch("RESIZER_CANCEL")},t.ref.select=function(h){if(t.ref.isActive&&rn(t.element,h.target)){var p=n.pivotPoint,g=p.x-i.position.x,m=p.y-i.position.y,_={x:p.x+g,y:p.y+m},y=i.position;l=cn(_,y),i.selecting=!0,i.origin.x=h.pageX,i.origin.y=h.pageY,t.dispatch("CROP_IMAGE_RESIZE_GRAB")}},t.ref.confirm=function(h){t.ref.isActive&&rn(t.element,h.target)&&(i.selecting=!1,t.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},t.ref.blur=function(){t.ref.isActive&&(i.selecting=!1,i.enabled=!1,document.removeEventListener("mousedown",t.ref.select),document.removeEventListener("mouseup",t.ref.confirm),t.dispatch("RESIZER_CANCEL"))},window.addEventListener("blur",t.ref.blur),document.addEventListener("mousemove",t.ref.move),t.ref.keyDown=function(h){t.ref.isActive&&r.includes(h.keyCode)&&i.position&&(i.enabled=!0,document.addEventListener("mousedown",t.ref.select),document.addEventListener("mouseup",t.ref.confirm),t.dispatch("RESIZER_SHOW",{position:I({},i.position)}))},t.ref.keyUp=function(h){t.ref.isActive&&r.includes(h.keyCode)&&(i.enabled=!1,document.removeEventListener("mousedown",t.ref.select),document.removeEventListener("mouseup",t.ref.confirm),t.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",t.ref.keyDown),document.body.addEventListener("keyup",t.ref.keyUp))},destroy:function(e){var t=e.root;document.removeEventListener("touchmove",t.ref.resizeMove),document.removeEventListener("touchend",t.ref.resizeEnd),document.removeEventListener("touchstart",t.ref.resizeStart),document.removeEventListener("wheel",t.ref.wheel),document.removeEventListener("mousedown",t.ref.select),document.removeEventListener("mouseup",t.ref.confirm),t.ref.hasEnabledResizeModifier&&(document.removeEventListener("mousemove",t.ref.move),document.body.removeEventListener("keydown",t.ref.keyDown),document.body.removeEventListener("keyup",t.ref.keyUp),window.removeEventListener("blur",t.ref.blur))},read:function(e){var t=e.root;t.ref.state.scrollY=window.scrollY;var n=t.element.getBoundingClientRect();t.ref.state.offsetX=n.x,t.ref.state.offsetY=n.y},write:dt({CROP_RECT_DRAG_GRAB:function(e){e.root.ref.isCropping=!0},CROP_RECT_DRAG_RELEASE:function(e){e.root.ref.isCropping=!1},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.ref.isActive=n.id==="crop"},RESIZER_SHOW:function(e){var t=e.root,n=e.props,r=e.action;t.element.dataset.state="multi-touch",Ti({root:t,props:n,action:r})},RESIZER_CANCEL:function(e){e.root.element.dataset.state="idle"},RESIZER_MOVE:Ti})}),Nt=function(e,t){return e.style.opacity=t},Ri=function(e,t){var n=Array.from(e.element.querySelectorAll(".doka--icon-crop-limit rect"));n.length&&(Nt(n[0],t?.3:0),Nt(n[1],t?1:0),Nt(n[2],t?0:.3),Nt(n[3],t?0:1))},Ai=function(e,t){var n=e.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!t)return Nt(n[0],.2),Nt(n[1],.3),void Nt(n[2],.4);Nt(n[0],t>1?1:.3),Nt(n[1],t===1?.85:.5),Nt(n[2],t<1?1:.3)}},Ud=function(e,t){Array.from(e.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(n){t>1&&(n.setAttribute("x",n.previousElementSibling?5:4),n.setAttribute("width",9)),t<1&&(n.setAttribute("y",11),n.setAttribute("height",10))})},Vd=function(e){var t,n;e>1?(n=14,t=Math.round(n/e)):(t=14,n=Math.round(t*e));var r=Math.round(.5*(23-t)),i=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="'.concat(r,'" y="').concat(i,'" width="').concat(t,'" height="').concat(n,'" rx="2.5"/></g></svg>')},Nd=D({name:"crop",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden","offsetTop"]},create:function(e){var t=e.root,n=e.props;n.viewId="crop",n.hidden=!1,t.ref.isHiding=!1;var r=[];t.query("GET_CROP_ALLOW_IMAGE_TURN_LEFT")&&r.push({view:Tt,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:X('<g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g>',26),action:function(){return t.dispatch("CROP_IMAGE_ROTATE_LEFT")}}),t.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&r.push({view:Tt,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:X('<g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g>',26),action:function(){return t.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),t.query("GET_CROP_ALLOW_IMAGE_FLIP_HORIZONTAL")&&r.push({view:Tt,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:X('<g fill="currentColor" fill-rule="evenodd"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g>',26),action:function(){return t.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}}),t.query("GET_CROP_ALLOW_IMAGE_FLIP_VERTICAL")&&r.push({view:Tt,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:X('<g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g>',26),action:function(){return t.dispatch("CROP_IMAGE_FLIP_VERTICAL")}});var i=t.query("GET_CROP_ASPECT_RATIO_OPTIONS");i&&i.length&&r.push({view:Ae,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:X('<g class="doka--icon-aspect-ratio" fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g>',26),options:null,onSelect:function(o){o.width&&o.height?t.dispatch("RESIZE_SET_OUTPUT_SIZE",{width:o.width,height:o.height}):(t.query("GET_CROP_ASPECT_RATIO_OPTIONS").find(function(a){return a.value&&a.value.width||a.value.height})&&t.dispatch("RESIZE_SET_OUTPUT_SIZE",{width:null,height:null}),t.dispatch("CROP_SET_ASPECT_RATIO",{value:o.aspectRatio}))},didCreateView:function(o){t.ref.aspectRatioDropdown=o}}),t.query("GET_CROP_ALLOW_TOGGLE_LIMIT")&&r.push({view:Ae,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT"),icon:X(`<g class="doka--icon-crop-limit" fill="currentColor" fill-rule="evenodd">
                    <rect x="2" y="3" width="20" height="20" rx="1"/>
                    <rect x="7" y="8" width="10" height="10" rx="1"/>
                    <rect x="4" y="8" width="14" height="14" rx="1"/>
                    <rect x="12" y="4" width="10" height="10" rx="1"/>
                </g>`,26),options:[{value:!0,label:t.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT_ENABLE"),icon:'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="3" y="3" width="17" height="17" rx="2.5" opacity=".3"/><rect x="7" y="7" width="9" height="9" rx="2.5"/></g></svg>'},{value:!1,label:t.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT_DISABLE"),icon:'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="3" y="6" width="13" height="13" rx="2.5" opacity=".3"/><rect x="10" y="3" width="9" height="9" rx="2.5"/></g></svg>'}],onSelect:function(o){t.dispatch("CROP_SET_LIMIT",{value:o})},didCreateView:function(o){t.ref.cropToggleLimitDropdown=o}}),t.ref.menu=t.appendChildView(t.createChildView(Vr("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:50}}),{opacity:0,controls:r})),t.ref.menuItemsRequiredWidth=null,t.ref.subject=t.appendChildView(t.createChildView(Pd,I({},n))),t.query("GET_CROP_ALLOW_ROTATE")&&(t.ref.rotator=t.appendChildView(t.createChildView(Ed,{rotation:0,opacity:0,translateY:20,id:n.id}))),t.ref.resizer=t.appendChildView(t.createChildView(Dd,{pivotPoint:{x:0,y:0}})),t.ref.updateControls=function(){var o=t.query("GET_IMAGE");if(Ud(t,o.height/o.width),t.ref.cropToggleLimitDropdown&&(t.ref.isLimitedToImageBounds=t.query("GET_CROP_LIMIT_TO_IMAGE_BOUNDS"),Ri(t,t.ref.isLimitedToImageBounds),t.ref.cropToggleLimitDropdown.selectedValue=t.ref.isLimitedToImageBounds),t.ref.aspectRatioDropdown){var a=t.query("GET_MIN_IMAGE_SIZE"),l=i.filter(function(u){if(!u.value.aspectRatio)return!0;if(u.value.aspectRatio<1){if(o.naturalWidth*u.value.aspectRatio<a.height)return!1}else if(o.naturalHeight/u.value.aspectRatio<a.width)return!1;return!0});t.ref.aspectRatioDropdown.options=l.map(function(u){return I({},u,{icon:Vd(u.value.aspectRatio)})})}},t.ref.isModal=/modal|fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE"))},read:function(e){var t=e.root,n=e.props;if(n.hidden)t.ref.menuItemsRequiredWidth=null;else{var r=t.rect;if(r.element.width!==0&&r.element.height!==0){if(t.ref.menuItemsRequiredWidth===null){var i=t.ref.menu.childViews.reduce(function(s,d){return s+d.rect.outer.width},0);t.ref.menuItemsRequiredWidth=i===0?null:i}var o=t.ref.subject.rect.element,a=o.left,l=o.top,u=o.width,c=o.height;n.stagePosition={x:a,y:l,width:u,height:c}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:dt({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props,i=t.ref,o=i.menu,a=i.rotator,l=i.subject;r.viewId===n.id?(l.opacity=1,o.opacity=1,a&&(a.opacity=1,a.translateY=0),r.hidden=!1,t.ref.isHiding=!1,t.ref.updateControls()):(l.opacity=0,o.opacity=0,a&&(a.opacity=0,a.translateY=20),t.ref.isHiding=!0)},UNLOAD_IMAGE:function(e){var t=e.root.ref,n=t.menu,r=t.rotator;n.opacity=0,r&&(r.opacity=0,r.translateY=20)},DID_PRESENT_IMAGE:function(e){var t=e.root,n=t.ref,r=n.menu,i=n.rotator;r.opacity=1,i&&(i.opacity=1,i.translateY=0),t.ref.updateControls()}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.ref,o=i.resizer,a=i.subject,l=i.menu,u=i.rotator,c=i.isHiding,s=i.cropToggleLimitDropdown,d=i.aspectRatioDropdown,f=n.hidden,h=a.opacity===0&&l.opacity===0&&(!u||u&&u.opacity===0);if(!f&&c&&h&&(t.ref.isHiding=!1,n.hidden=!0),!n.hidden){var p=t.query("GET_CROP",n.id,r);if(p){if(d){var g=t.query("GET_ACTIVE_CROP_ASPECT_RATIO"),m=t.query("GET_SIZE"),_=d.selectedValue;_?(_.aspectRatio!==g&&Ai(t,g),_.aspectRatio===g&&_.width===m.width&&_.height===m.height||(d.selectedValue={aspectRatio:g,width:m.width,height:m.height})):(d.selectedValue={aspectRatio:g,width:m.width,height:m.height},Ai(t,g))}if(s&&t.ref.isLimitedToImageBounds!==p.isLimitedToImageBounds&&(t.ref.isLimitedToImageBounds=p.isLimitedToImageBounds,Ri(t,p.isLimitedToImageBounds),s.selectedValue=p.isLimitedToImageBounds),o.pivotPoint={x:.5*o.rect.element.width,y:.5*o.rect.element.height},u&&(u.animate=!p.isDraft,u.rotation=p.rotation.sub,u.setAllowInteraction(t.query("IS_ACTIVE_VIEW","crop"))),l.element.dataset.layout=t.ref.menuItemsRequiredWidth>t.ref.menu.rect.element.width?"compact":"spacious",t.query("GET_CROP_RESIZE_SCROLL_RECT_ONLY")){var y=t.query("GET_STAGE"),v=y.x,T=y.y,A=t.query("GET_ROOT"),R=t.ref.isModal?A.left:0,x=t.ref.isModal?A.top:0;o.scrollRect={x:R+v+p.cropRect.x,y:x+T+p.cropRect.y+n.offsetTop,width:p.cropRect.width,height:p.cropRect.height}}}}})}),xi=D({name:"size-input",mixins:{listeners:!0,apis:["id","value","placeholder","getValue","setValue","setPlaceholder","hasFocus","onChange"]},create:function(e){var t=e.root,n=e.props,r=n.id,i=n.min,o=n.max,a=n.value,l=n.placeholder,u=n.onChange,c=u===void 0?function(){}:u,s=n.onBlur,d=s===void 0?function(){}:s,f="doka--".concat(r,"-").concat(Yt()),h=z("input",{type:"number",step:1,id:f,min:i,max:o,value:a,placeholder:l}),p=h.getAttribute("max").length,g=z("label",{for:f});g.textContent=n.label;var m=function(y,v,T){return Rt(y)?((y=y.replace(/[^0-9]/g,"")).length>p&&(y=y.slice(0,p)),y=parseInt(y,10)):y=Math.round(y),isNaN(y)?null:Ht(y,v,T)},_=function(y){return y.length?parseInt(h.value,10):null};t.ref.handleInput=function(){h.value=m(h.value,1,o),c(_(h.value))},t.ref.handleBlur=function(){h.value=m(h.value,i,o),d(_(h.value))},h.addEventListener("input",t.ref.handleInput),h.addEventListener("blur",t.ref.handleBlur),t.appendChild(h),t.appendChild(g),t.ref.input=h,n.hasFocus=function(){return h===document.activeElement},n.getValue=function(){return _(h.value)},n.setValue=function(y){return h.value=y?m(y,1,999999):null},n.setPlaceholder=function(y){return h.placeholder=y}},destroy:function(e){var t=e.root;t.ref.input.removeEventListener("input",t.ref.handleInput),t.ref.input.removeEventListener("blur",t.ref.handleBlur)}}),Bd=D({name:"checkable",tag:"span",mixins:{listeners:!0,apis:["id","checked","onChange","onSetValue","setValue","getValue"]},create:function(e){var t=e.root,n=e.props,r=n.id,i=n.checked,o=n.onChange,a=o===void 0?function(){}:o,l=n.onSetValue,u=l===void 0?function(){}:l,c="doka--".concat(r,"-").concat(Yt()),s=z("input",{type:"checkbox",value:1,id:c});s.checked=i,t.ref.input=s;var d=z("label",{for:c});d.innerHTML=n.label,t.appendChild(s),t.appendChild(d),t.ref.handleChange=function(){u(s.checked),a(s.checked)},s.addEventListener("change",t.ref.handleChange),n.getValue=function(){return s.checked},n.setValue=function(f){s.checked=f,u(s.checked)},setTimeout(function(){u(s.checked)},0)},destroy:function(e){var t=e.root;t.ref.input.removeEventListener("change",t.ref.handleChange)}}),fr=null,Fd=function(){return fr===null&&(fr=/Android/i.test(navigator.userAgent)),fr},zd=D({ignoreRect:!0,name:"resize-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15,delay:150}}},create:function(e){var t=e.root;t.element.setAttribute("novalidate","novalidate"),t.element.setAttribute("action","#"),t.ref.shouldBlurKeyboard=ze()||Fd();var n=t.query("GET_SIZE_MAX"),r=t.query("GET_SIZE_MIN"),i=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=a.axisLock,u=l===void 0?"none":l,c=a.enforceLimits,s=c!==void 0&&c,d=t.ref,f=d.inputImageWidth,h=d.inputImageHeight,p=d.buttonConfirm,g=t.query("GET_SIZE_ASPECT_RATIO_LOCK"),m=t.query("GET_CROP_RECTANGLE_ASPECT_RATIO"),_={width:f.getValue(),height:h.getValue()},y=Ue(_,s?r:{width:1,height:1},s?n:{width:999999,height:999999},g?m:null,u);if(g)u==="width"?h.setValue(y.width/m):u==="height"?f.setValue(y.height*m):(f.setValue(y.width||y.height*m),h.setValue(y.height||y.width/m));else if(y.width&&!y.height){var v=Math.round(y.width/m),T=Ue({width:y.width,height:v},s?r:{width:1,height:1},s?n:{width:999999,height:999999},m,u);s&&f.setValue(Math.round(T.width)),h.setPlaceholder(Math.round(T.height))}else if(y.height&&!y.width){var A=Math.round(y.height*m);f.setPlaceholder(A)}var R=t.query("GET_SIZE_INPUT"),x=R.width,b=R.height,O=Dt(x)?Math.round(x):null,C=Dt(b)?Math.round(b):null,M=f.getValue(),S=h.getValue(),V=M!==O||S!==C;return p.opacity=V?1:0,t.dispatch("KICK"),{width:f.getValue(),height:h.getValue()}},o=t;t.appendChildView(t.createChildView(Hd("Image size",function(a){var l=a.root,u=l.query("GET_SIZE"),c=l.appendChildView(l.createChildView(xi,{id:"image-width",label:l.query("GET_LABEL_RESIZE_WIDTH"),value:Dt(u.width)?Math.round(u.width):null,min:r.width,max:n.width,placeholder:0,onChange:function(){return i({axisLock:"width"})},onBlur:function(){return i({enforceLimits:!1})}})),s=l.appendChildView(l.createChildView(Bd,{id:"aspect-ratio-lock",label:X('<g fill="none" fill-rule="evenodd"><path stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="doka--aspect-ratio-lock-ring" d="M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V14"/><rect fill="currentColor" x="7" y="10" width="10" height="7" rx="1.5"/></g>'),checked:l.query("GET_SIZE_ASPECT_RATIO_LOCK"),onSetValue:function(f){var h=f?0:-3;s.element.querySelector(".doka--aspect-ratio-lock-ring").setAttribute("transform","translate(0 ".concat(h,")"))},onChange:function(f){l.dispatch("RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK",{value:f}),i()}})),d=l.appendChildView(l.createChildView(xi,{id:"image-height",label:l.query("GET_LABEL_RESIZE_HEIGHT"),value:Dt(u.height)?Math.round(u.height):null,min:r.height,max:n.height,placeholder:0,onChange:function(){return i({axisLock:"height"})},onBlur:function(){return i({enforceLimits:!1})}}));o.ref.aspectRatioLock=s,o.ref.inputImageWidth=c,o.ref.inputImageHeight=d}))),t.ref.buttonConfirm=t.appendChildView(t.createChildView(Tt,{name:"app action-confirm icon-only",label:t.query("GET_LABEL_RESIZE_APPLY_CHANGES"),action:function(){},opacity:0,icon:X('<polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),type:"submit"})),t.ref.confirmForm=function(a){var l=i({enforceLimits:!0});a.preventDefault();var u=t.ref,c=u.shouldBlurKeyboard,s=u.buttonConfirm;c&&(document.activeElement.blur(),s.element.focus()),s.opacity=0,t.dispatch("RESIZE_SET_OUTPUT_SIZE",l)},t.element.addEventListener("submit",t.ref.confirmForm)},destroy:function(e){var t=e.root;t.element.removeEventListener("submit",t.ref.confirmForm)},write:dt({EDIT_RESET:function(e){var t=e.root,n=t.query("GET_SIZE"),r=t.ref,i=r.inputImageWidth,o=r.inputImageHeight,a=r.aspectRatioLock,l=r.buttonConfirm;i.setValue(n.width),o.setValue(n.height),a.setValue(t.query("GET_SIZE_ASPECT_RATIO_LOCK")),l.opacity=0},RESIZE_SET_OUTPUT_SIZE:function(e){var t=e.root,n=e.action,r=t.ref,i=r.inputImageWidth,o=r.inputImageHeight;i.setValue(n.width),o.setValue(n.height)},CROP_SET_ASPECT_RATIO:function(e){var t=e.root,n=e.props,r=e.action,i=e.timestamp,o=t.query("GET_CROP",n.id,i);if(o){var a=o.cropStatus,l=t.ref,u=l.inputImageWidth,c=l.inputImageHeight;r.value!==null?(u.setValue(a.image.width),u.setPlaceholder(a.crop.width),c.setValue(a.image.height),c.setPlaceholder(a.crop.height)):u.getValue()&&c.getValue()&&(c.setValue(null),c.setPlaceholder(a.crop.height))}}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){t.opacity;var o=i.cropStatus,a=t.ref,l=a.inputImageWidth,u=a.inputImageHeight;if(!l.hasFocus()&&!u.hasFocus()){var c=t.query("GET_CROP_RECTANGLE_ASPECT_RATIO");if(l.getValue()===null&&u.getValue()===null)l.setPlaceholder(o.crop.width),u.setPlaceholder(o.crop.height);else if(l.getValue()===null&&o.image.height!==null){var s=Math.round(o.image.height*c);l.setPlaceholder(s)}else if(u.getValue()===null&&o.image.width!==null){var d=Math.round(o.image.width/c);u.setPlaceholder(d)}}}})}),Hd=function(e,t){return D({tag:"fieldset",create:function(n){var r=n.root,i=z("legend");i.textContent=e,r.element.appendChild(i),t({root:r})}})},Wd=D({name:"resize",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(e){var t=e.root,n=e.props;n.viewId="resize",n.hidden=!1,t.ref.isHiding=!1,t.ref.form=t.appendChildView(t.createChildView(zd,{opacity:0,id:n.id}))},read:function(e){var t=e.root,n=e.props;if(!n.hidden){var r=t.rect;if(r.element.width!==0&&r.element.height!==0){var i=t.ref.form.rect;n.stagePosition={x:r.element.left,y:r.element.top+i.element.height,width:r.element.width,height:r.element.height-i.element.height}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:dt({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props;n.id===r.viewId?(t.ref.isHiding=!1,t.ref.form.opacity=1):(t.ref.isHiding=!0,t.ref.form.opacity=0)}},function(e){var t=e.root,n=e.props,r=t.ref,i=r.form,o=r.isHiding,a=n.hidden;o&&i.opacity===0&&!a?n.hidden=!0:n.hidden=!1})}),qd=D({name:"range-input",tag:"span",mixins:{listeners:!0,apis:["onUpdate","setValue","getValue","setAllowInteraction"]},create:function(e){var t=e.root,n=e.props,r=n.id,i=n.min,o=n.max,a=n.step,l=n.value,u=n.onUpdate,c=u===void 0?function(){}:u,s="doka--".concat(r,"-").concat(Yt()),d=z("input",{type:"range",id:s,min:i,max:o,step:a});d.value=l,t.ref.input=d;var f=z("span");f.className="doka--range-input-inner";var h=z("label",{for:s});h.innerHTML=n.label;var p=i+.5*(o-i);t.element.dataset.centered=l===p,t.ref.handleRecenter=function(){n.setValue(p),t.ref.handleChange()};var g=z("button",{type:"button"});g.textContent="center",g.addEventListener("click",t.ref.handleRecenter),t.ref.recenter=g,f.appendChild(d),f.appendChild(g),t.appendChild(h),t.appendChild(f),t.ref.handleChange=function(){var _=n.getValue();t.element.dataset.centered=_===p,c(_)},d.addEventListener("input",t.ref.handleChange);var m=null;t.ref.dragger=re(f,function(){m=d.getBoundingClientRect()},function(_){var y=(_.pageX-m.left)/m.width;d.value=i+y*(o-i),t.ref.handleChange()},function(){},{stopPropagation:!0}),n.getValue=function(){return parseFloat(d.value)},n.setValue=function(_){return d.value=_},n.setAllowInteraction=function(_){_?t.ref.dragger.enable():t.ref.dragger.disable()}},destroy:function(e){var t=e.root;t.ref.dragger.destroy(),t.ref.recenter.removeEventListener("click",t.ref.handleRecenter),t.ref.input.removeEventListener("input",t.ref.handleChange)}}),Cr={brightness:{icon:X('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="7"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></g>')},contrast:{icon:X('<g fill="none" fill-rule="evenodd"><circle stroke="currentColor" stroke-width="3" cx="12" cy="12" r="10"/><path d="M12 2v20C6.477 22 2 17.523 2 12S6.477 2 12 2z" fill="currentColor"/></g>')},exposure:{icon:X('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path d="M20.828 3.172L3.172 20.828A3.987 3.987 0 0 1 2 18V6a4 4 0 0 1 4-4h12c1.105 0 2.105.448 2.828 1.172zM7 7H5v2h2v2h2V9h2V7H9V5H7v2zM12 15h5v2h-5z" fill="currentColor"/></g>')},saturation:{icon:X('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path fill="currentColor" opacity=".3" d="M7 2.5h5v18.75H7z"/><path fill="currentColor" opacity=".6" d="M12 2.5h5v18.75h-5z"/><path fill="currentColor" opacity=".9" d="M17 2.5h4v18.75h-4z"/></g>')}},Yd=D({ignoreRect:!0,name:"color-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15}}},create:function(e){var t=e.root;t.element.setAttribute("novalidate","novalidate");var n=t.query("GET_COLOR_VALUES");t.ref.tools=Object.keys(Cr).reduce(function(r,i){var o=i,a=Cr[i].icon,l=t.query("GET_LABEL_COLOR_".concat(i.toUpperCase())),u=t.query("GET_COLOR_".concat(i.toUpperCase(),"_RANGE")),c=n[i];return r[o]={view:t.appendChildView(t.createChildView(qd,{id:o,label:"".concat(a,"<span>").concat(l,"</span>"),min:u[0],max:u[1],step:.01,value:c,onUpdate:function(s){return t.dispatch("COLOR_SET_COLOR_VALUE",{key:o,value:s})}}))},r},{})},write:dt({COLOR_SET_VALUE:function(e){var t=e.root,n=e.action;t.ref.tools[n.key].view.setValue(n.value)},SHOW_VIEW:function(e){var t=e.root,n=e.action;Object.keys(t.ref.tools).forEach(function(r){t.ref.tools[r].view.setAllowInteraction(n.id==="color")})}})}),an=null,pr=null,Ii=function(e,t){var n=t.brightness,r=t.exposure,i=t.contrast,o=t.saturation;if(n!==0){var a=n<0,l=a?"multiply":"overlay",u=a?0:255,c=a?Math.abs(n):1-n;e.ref.imageOverlay.style.cssText="mix-blend-mode: ".concat(l,"; background: rgba(").concat(u,",").concat(u,",").concat(u,",").concat(c,")")}return e.ref.imageOverlay.style.cssText="background:transparent",e.ref.image.style.cssText="filter: brightness(".concat(r,") contrast(").concat(i,") saturate(").concat(o,")"),t},Zd=Object.keys(Cr),Xd=function(e,t){return Zd.findIndex(function(n){return e[n]!==t[n]})<0},$d=function(e){return D({ignoreRect:!0,tag:"li",name:"filter-tile",mixins:{styles:["opacity","translateY"],animations:{translateY:{type:"spring",delay:10*e},opacity:{type:"spring",delay:30*e}}},create:function(t){var n=t.root,r=t.props,i="doka--filter-".concat(r.style,"-").concat(Yt()),o=z("input",{id:i,type:"radio",name:"filter"});n.appendChild(o),o.checked=r.selected,o.value=r.style,o.addEventListener("change",function(){o.checked&&r.onSelect()});var a=z("label",{for:i});a.textContent=r.label,n.appendChild(a);var l=r.imageData,u=Math.min(l.width,l.height),c=u,s=z("canvas");s.width=u,s.height=c;var d=s.getContext("2d");n.ref.image=s;var f=z("div");n.ref.imageOverlay=f;var h={x:.5*u-.5*l.width,y:.5*c-.5*l.height},p=z("div");p.appendChild(s),p.appendChild(f),n.appendChild(p),n.ref.imageWrapper=p,r.matrix?(an||(an=Gr(fo)),clearTimeout(pr),an.post({transforms:[{type:"filter",data:r.matrix}],imageData:l},function(g){d.putImageData(g,h.x,h.y),clearTimeout(pr),pr=setTimeout(function(){an.terminate(),an=null},1e3)},[l.data.buffer]),n.ref.activeColors=Ii(n,n.query("GET_COLOR_VALUES"))):d.putImageData(l,h.x,h.y)},write:function(t){var n=t.root;if(!(n.opacity<=0)){var r=n.query("GET_COLOR_VALUES"),i=n.ref.activeColors;(!i&&r||!Xd(i,r))&&(n.ref.activeColors=r,Ii(n,r))}}})},jd=function(e){var t;try{t=new ImageData(e.width,e.height)}catch{t=document.createElement("canvas").getContext("2d").createImageData(e.width,e.height)}return t.data.set(new Uint8ClampedArray(e.data)),t},Yn=function(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(function(n,r){return n===t[r]})},Kd=D({ignoreRect:!0,tag:"ul",name:"filter-list",mixins:{apis:["filterOpacity","hidden"]},create:function(e){var t=e.root,n=e.props;t.element.setAttribute("role","list"),t.ref.tiles=[];var r=t.query("GET_THUMB_IMAGE_DATA"),i=t.query("GET_FILTERS"),o=[];ht(i,function(a,l){o.push(I({id:a},l))}),t.ref.activeFilter=t.query("GET_FILTER"),t.ref.tiles=o.map(function(a,l){var u=a.matrix(),c=t.ref.activeFilter===a.id||Yn(t.ref.activeFilter,u)||l===0;return t.appendChildView(t.createChildView($d(l),{opacity:0,translateY:-5,id:n.id,style:a.id,label:a.label,matrix:u,imageData:jd(r),selected:c,onSelect:function(){return t.dispatch("FILTER_SET_FILTER",{value:u?a.id:null})}}))})},write:function(e){var t=e.root,n=e.props;if(!n.hidden){var r=t.query("GET_FILTER");if(r!==t.ref.activeFilter){t.ref.activeFilter=r;var i=t.query("GET_FILTERS"),o=r?Rt(r)?r:mo(r)?Object.keys(i).find(function(a){return Yn(i[a].matrix(),r)}):null:"original";Array.from(t.element.querySelectorAll("input")).forEach(function(a){return a.checked=a.value===o})}t.query("IS_ACTIVE_VIEW","filter")?t.ref.tiles.forEach(function(a){a.opacity=1,a.translateY=0}):t.ref.tiles.forEach(function(a){a.opacity=0,a.translateY=-5}),n.filterOpacity=t.ref.tiles.reduce(function(a,l){return a+l.opacity},0)/t.ref.tiles.length}}}),Qd=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return D({name:"scroller doka--".concat(e,"-scroller"),ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"spring"}},apis:n},create:function(r){var i,o=r.root,a=r.props;o.ref.content=o.appendChildView(o.createChildView(t,{id:a.id})),o.element.isScrollContainer=!0,Co()&&(o.ref.handleMouseWheel=function(l){var u=o.element.scrollLeft,c=o.ref.scrollWidth-o.rect.element.width,s=u+l.deltaX;(s<0||s>c)&&(o.element.scrollLeft=Math.min(Math.max(s,0),c),l.preventDefault())},o.element.addEventListener("mousewheel",o.ref.handleMouseWheel),o.element.dataset.dragState="end",o.ref.dragger=re(o.ref.content.element,function(){o.element.dataset.dragState="start",i=o.element.scrollLeft},function(l,u){o.element.scrollLeft=i-u.x,o.ref.scrollWidth-o.rect.element.width!=0&&Kn({x:0,y:0},u)>0&&(o.element.dataset.dragState="dragging")},function(){o.element.dataset.dragState="end"},{stopPropagation:!0}))},destroy:function(r){var i=r.root;i.ref.handleMouseWheel&&i.element.removeEventListener("mousewheel",i.ref.handleMouseWheel),i.ref.dragger&&i.ref.dragger.destroy()},read:function(r){var i=r.root;i.ref.scrollWidth=i.element.scrollWidth},write:function(r){var i=r.root,o=r.props;i.ref.content.hidden=o.hidden,o.contentOpacity=i.ref.content.contentOpacity}})},So=function(e,t){return D({name:e,ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(n){var r=n.root,i=n.props;i.viewId=e,i.hidden=!1,r.ref.isHiding=!1,r.ref.content=r.appendChildView(r.createChildView(Qd(e,t,["hidden","contentOpacity"]),{id:i.id}))},read:function(n){var r=n.root,i=n.props;if(r.ref.content&&!i.hidden){var o=r.rect;if(o.element.width!==0&&o.element.height!==0){var a=r.ref.content.rect,l=a.element.top===0,u=l?o.element.top+a.element.height+a.element.marginBottom:o.element.top,c=l?o.element.height-a.element.height-a.element.marginBottom:o.element.height-a.element.height-o.element.top;i.stagePosition={x:o.element.left,y:u,width:o.element.width,height:c}}}},shouldUpdateChildViews:function(n){var r=n.props,i=n.actions;return!r.hidden||r.hidden&&i&&i.length},write:dt({SHOW_VIEW:function(n){var r=n.root,i=n.action,o=n.props;r.ref.content&&(i.id===o.viewId?(r.ref.isHiding=!1,o.hidden=!1,r.ref.content.hidden=!1):r.ref.isHiding=!0)}},function(n){var r=n.root,i=n.props;r.ref.content.opacity=r.ref.isHiding||r.ref.content.hidden?0:1,r.ref.isHiding&&r.ref.content.contentOpacity<=0&&(r.ref.isHiding=!1,i.hidden=!0,r.ref.content.hidden=!0)})})},Jd=So("filter",Kd),tf=D({name:"color",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(e){var t=e.root,n=e.props;n.viewId="color",n.hidden=!1,t.ref.isHiding=!1,t.ref.form=t.appendChildView(t.createChildView(Yd,{opacity:0,id:n.id}))},read:function(e){var t=e.root,n=e.props;if(!n.hidden){var r=t.rect;if(r.element.width!==0&&r.element.height!==0){var i=t.ref.form.rect,o=i.element.height,a=i.element.top===0,l=a?r.element.top+o:r.element.top,u=a?r.element.height-o:r.element.height-o-r.element.top;n.stagePosition={x:r.element.left,y:l,width:r.element.width,height:u}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:dt({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props;n.id===r.viewId?(t.ref.isHiding=!1,t.ref.form.opacity=1,r.hidden=!1):(t.ref.isHiding=!0,t.ref.form.opacity=0)}},function(e){var t=e.root,n=e.props;t.ref.isHiding&&t.ref.form.opacity===0&&(t.ref.isHiding=!1,n.hidden=!0)})}),ef=function(){try{var e=z("input",{type:"color"}),t=e.type==="color";return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?t:t&&typeof e.selectionStart!="number"}catch{return!1}},nf=function(e,t,n){var r,i=Math.max(e,t,n),o=Math.min(e,t,n),a=i-o,l=i===0?0:a/i,u=i/255;switch(i){case o:r=0;break;case e:r=t-n+a*(t<n?6:0),r/=6*a;break;case t:r=n-e+2*a,r/=6*a;break;case n:r=e-t+4*a,r/=6*a}return[r,l,u]},rf=D({ignoreRect:!0,tag:"div",name:"markup-color",mixins:{animations:{opacity:"spring"},styles:["opacity"],apis:["onSelect","selectedValue"]},create:function(e){var t=e.root,n=e.props,r=n.colors,i=n.name,o=n.onSelect;t.ref.handleChange=function(p){o(p.target.value),p.stopPropagation()},t.element.addEventListener("change",t.ref.handleChange);var a=z("ul");if(t.ref.inputs=r.map(function(p){var g="doka--color-"+Yt(),m=z("li"),_=z("input",{id:g,name:i,type:"radio",value:p[1]}),y=z("label",{for:g,title:p[0],style:"background-color: "+(p[2]||p[1])});return y.textContent=p[0],ue(m)(_),ue(m)(y),ue(a)(m),_}),t.element.appendChild(a),t.query("GET_MARKUP_ALLOW_CUSTOM_COLOR")&&ef()){var l=z("div",{class:"doka--color-input"}),u="doka--color-"+Yt(),c=z("label",{for:u});c.textContent="Choose color";var s=z("input",{id:u,name:i,type:"color"}),d=z("span",{class:"doka--color-visualizer"}),f=z("span",{class:"doka--color-brightness"});t.ref.handleCustomColorChange=function(){var p=vn(s.value),g=nf.apply(void 0,Ft(p)),m=360*g[0]-90,_=.625*g[1],y=1-g[2];d.style.backgroundColor=s.value,d.style.transform="rotateZ(".concat(m,"deg) translateX(").concat(_,"em)"),f.style.opacity=y,o(s.value)};var h=!0;t.ref.handleCustomColorSelect=function(p){h?o(p.target.value):t.ref.handleCustomColorChange(),h=!1},s.addEventListener("click",t.ref.handleCustomColorSelect),s.addEventListener("input",t.ref.handleCustomColorChange),ue(l)(s),ue(l)(c),ue(l)(d),ue(l)(f),t.appendChild(l),t.ref.customInput=s}},write:function(e){var t=e.root,n=e.props;if(n.selectedValue!==t.ref.activeSelectedValue){t.ref.activeSelectedValue=n.selectedValue;var r=!1;if(t.ref.inputs.forEach(function(i){i.checked=i.value===n.selectedValue,i.checked&&(r=!0)}),!t.ref.customInput)return;t.ref.customInput.dataset.selected=t.ref.inputs.length&&!r,r||(t.ref.customInput.value=n.selectedValue,t.ref.handleCustomColorChange())}},destroy:function(e){var t=e.root;t.element.removeEventListener("change",t.ref.handleChange),t.ref.customInput&&(t.ref.customInput.removeEventListener("click",t.ref.handleCustomColorSelect),t.ref.customInput.removeEventListener("input",t.ref.handleCustomColorChange))}}),Ci=function(e){var t=e.ref,n=t.colorSelect,r=t.fontFamilySelect,i=t.fontSizeSelect,o=t.shapeStyleSelect,a=t.lineStyleSelect;[r,i,o,t.lineDecorationSelect].forEach(function(l){l.element.dataset.active="false"}),[n,a].forEach(function(l){l.element.dataset.active="true"})},bi=["fontFamily","fontSize","fontWeight","textAlign","backgroundColor","fontColor","borderColor","borderWidth","borderStyle","lineColor","lineWidth","lineDecoration","lineJoin","lineCap"],Oo=function(e){return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">'.concat(e,"</svg>")},of=function(e){var t=e===0?"currentColor":"none",n=e;return Oo('<rect stroke="'.concat(e===0?"none":"currentColor",'" fill="').concat(t,'" stroke-width="').concat(n,'" x="2" y="3" width="17" height="17" rx="3"/>'))},af=function(e){return Oo('<line stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width="'.concat(e,'" x1="3" y1="12" x2="20" y2="12"/>'))},lf=D({name:"markup-tools",ignoreRect:!0,mixins:{apis:["onUpdate"],animations:{translateY:"spring",opacity:"spring"},styles:["translateY","opacity"]},create:function(e){var t=e.root,n=e.props.onUpdate;t.ref.colorSelect=t.appendChildView(t.createChildView(rf,{onSelect:function(r){t.ref.colorSelect.selectedValue=r,n("color",r)},name:"color-select",colors:t.query("GET_MARKUP_COLOR_OPTIONS")})),t.ref.shapeStyleSelect=t.appendChildView(t.createChildView(Ae,{onSelect:function(r){t.ref.shapeStyleSelect.selectedValue=r,n("shapeStyle",r.slice(1))},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_SHAPE_STYLE"),direction:"up",options:t.query("GET_MARKUP_SHAPE_STYLE_OPTIONS").map(function(r){return{value:r,label:r[0],icon:of(r[3])}})})),t.ref.lineStyleSelect=t.appendChildView(t.createChildView(Ae,{onSelect:function(r){t.ref.lineStyleSelect.selectedValue=r,n("lineStyle",r.slice(1))},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_LINE_STYLE"),direction:"up",options:t.query("GET_MARKUP_LINE_STYLE_OPTIONS").map(function(r){return{value:r,label:r[0],icon:af(r[3])}})})),t.ref.lineDecorationSelect=t.appendChildView(t.createChildView(Ae,{onSelect:function(r){t.ref.lineDecorationSelect.selectedValue=r,n("lineDecoration",r)},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_LINE_DECORATION"),direction:"up",options:t.query("GET_MARKUP_LINE_DECORATION_OPTIONS").map(function(r){return{value:r[1],label:r[0]}})})),t.ref.fontFamilySelect=t.appendChildView(t.createChildView(Ae,{onSelect:function(r){t.ref.fontFamilySelect.selectedValue=r,n("fontFamily",r)},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_FONT_FAMILY"),direction:"up",options:t.query("GET_MARKUP_FONT_FAMILY_OPTIONS").map(function(r){return{value:r[1],label:'<span style="font-family:'.concat(r[1],';font-weight:600;">').concat(r[0],"</span>")}})})),t.ref.fontSizeSelect=t.appendChildView(t.createChildView(Ae,{onSelect:function(r){t.ref.fontSizeSelect.selectedValue=r,n("fontSize",r)},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_FONT_SIZE"),direction:"up",options:t.query("GET_MARKUP_FONT_SIZE_OPTIONS").map(function(r){return{value:r[1],label:r[0]}})})),t.query("GET_MARKUP_UTIL")==="draw"&&Ci(t)},write:dt({SWITCH_MARKUP_UTIL:function(e){var t=e.root;e.action.util==="draw"&&Ci(t)},MARKUP_SELECT:function(e){var t=e.root,n=e.action,r=t.ref,i=r.colorSelect,o=r.fontFamilySelect,a=r.fontSizeSelect,l=r.shapeStyleSelect,u=r.lineStyleSelect,c=r.lineDecorationSelect,s=n.id?t.query("GET_MARKUP_BY_ID",n.id):null,d=[i,o,a,l,u,c],f=[];if(s){var h=Ge(s,2),p=h[0],g=h[1],m=Array.isArray(g.allowEdit)?g.allowEdit:g.allowEdit===!1?[]:bi,_=bi.reduce(function(T,A){return T[A]=m.indexOf(A)!==-1,T},{});if(_.color=!!m.find(function(T){return/[a-z]Color/.test(T)}),p!=="image"&&_.color&&(i.selectedValue=cf(g),f.push(i)),p==="text"&&(_.fontFamily&&(o.selectedValue=g.fontFamily,f.push(o)),_.fontSize&&(a.selectedValue=g.fontSize,f.push(a))),(p==="rect"||p==="ellipse")&&_.borderStyle){var y=t.query("GET_MARKUP_SHAPE_STYLE_OPTIONS").find(function(T){var A=g.borderWidth===T[1],R=g.borderStyle===T[2]||Yn(g.borderStyle,T[2]);return A&&R});l.selectedValue=y,f.push(l)}if(p==="line"||p==="path"){if(_.lineWidth){var v=t.query("GET_MARKUP_LINE_STYLE_OPTIONS").find(function(T){var A=g.lineWidth===T[1],R=g.lineStyle===T[2]||Yn(g.lineStyle,T[2]);return A&&R});u.selectedValue=v,f.push(u)}p==="line"&&_.lineDecoration&&(c.selectedValue=g.lineDecoration,f.push(c))}d.forEach(function(T){T.element.dataset.active="false"}),f.forEach(function(T){T.element.dataset.active="true"})}},MARKUP_UPDATE:function(e){var t=e.root,n=e.action,r=n.style,i=n.value;t.ref[r+"Select"]&&(t.ref[r+"Select"].selectedValue=i)}})}),cf=function(e){var t=e.fontColor,n=e.backgroundColor,r=e.lineColor,i=e.borderColor;return t||n||r||i},uf=D({name:"markup",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(e){var t=e.root,n=e.props;n.viewId="markup",n.hidden=!1,t.ref.isHiding=!1;var r=[["select",{label:t.query("GET_LABEL_MARKUP_TOOL_SELECT"),icon:X('<g fill="none" fill-rule="evenodd"><path d="M7 13H5a1 1 0 01-1-1V5a1 1 0 011-1h7a1 1 0 011 1v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M10.22 8.914l12.58 5.18a1 1 0 01.012 1.844l-4.444 1.904a1 1 0 00-.526.526l-1.904 4.444a1 1 0 01-1.844-.013l-5.18-12.58a1 1 0 011.305-1.305z" fill="currentColor"/></g>',26)}],["draw",{label:t.query("GET_LABEL_MARKUP_TOOL_DRAW"),icon:X('<g fill="currentColor"><path d="M17.86 5.71a2.425 2.425 0 013.43 3.43L9.715 20.714 5 22l1.286-4.715L17.86 5.71z"/></g>',26)}],["line",{label:t.query("GET_LABEL_MARKUP_TOOL_LINE"),icon:X('<g transform="translate(3 4.5)" fill-rule="nonzero" fill="currentColor" stroke="none"><path d="M15.414 9.414l-6.01 6.01a2 2 0 1 1-2.829-2.828L9.172 10H2a2 2 0 1 1 0-4h7.172L6.575 3.404A2 2 0 1 1 9.404.575l6.01 6.01c.362.363.586.863.586 1.415s-.224 1.052-.586 1.414z"/></g>',26)}],["text",{label:t.query("GET_LABEL_MARKUP_TOOL_TEXT"),icon:X('<g transform="translate(5 5)" fill="currentColor" fill-rule="evenodd"><path d="M10 4v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4H1a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-5z"/></g>',26)}],["rect",{label:t.query("GET_LABEL_MARKUP_TOOL_RECT"),icon:X('<g fill="currentColor"><rect x="5" y="5" width="16" height="16" rx="2"/></g>',26)}],["ellipse",{label:t.query("GET_LABEL_MARKUP_TOOL_ELLIPSE"),icon:X('<g fill="currentColor"><circle cx="13" cy="13" r="9"/></g>',26)}]];t.ref.utils=z("fieldset"),t.ref.utils.className="doka--markup-utils",t.ref.utilsList=z("ul");var i="markup-utils-".concat(Yt());t.ref.inputs=r.map(function(a){var l=a[0],u=a[1],c="doka--markup-tool-"+Yt(),s=z("li"),d=z("input");d.id=c,d.checked=t.query("GET_MARKUP_UTIL")===l,d.setAttribute("type","radio"),d.setAttribute("name",i),d.value=l;var f=z("label");return f.setAttribute("for",c),f.className="doka--button-tool",f.innerHTML=u.icon+"<span>"+u.label+"</span>",f.title=u.label,s.appendChild(d),s.appendChild(f),t.ref.utilsList.appendChild(s),d}),t.ref.utils.appendChild(t.ref.utilsList),t.ref.utilsList.addEventListener("change",function(a){t.dispatch("SET_MARKUP_UTIL",{value:a.target.value})}),t.query("GET_MARKUP_ALLOW_ADD_MARKUP")&&(t.ref.menu=t.appendChildView(t.createChildView(Vr("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:50}}),{opacity:0,element:t.ref.utils})));var o=t.ref.tools=t.appendChildView(t.createChildView(lf,{opacity:0,onUpdate:function(a,l){t.dispatch("MARKUP_UPDATE",{style:a,value:l})}}));t.ref.menuItemsRequiredWidth=null,t.query("GET_MARKUP_UTIL")==="draw"&&(o.opacity=1,o.translateY=0,o.element.dataset.active="true")},read:function(e){var t=e.root,n=e.props;if(n.hidden)t.ref.menuItemsRequiredWidth=null;else{var r=t.rect;if(r.element.width!==0&&r.element.height!==0){if(t.ref.menu&&t.ref.menuItemsRequiredWidth===null){var i=t.ref.menu.rect.element.width;t.ref.menuItemsRequiredWidth=i===0?null:i}var o=t.ref.menu&&t.ref.menu.rect,a=t.ref.tools.rect.element.height,l=o?o.element.height:a,u=!o||o.element.top===0,c=u?r.element.top+l:r.element.top,s=u?r.element.height-l:r.element.height-l-r.element.top;n.stagePosition={x:r.element.left+20,y:c,width:r.element.width-40,height:s-a}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:dt({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props;n.id===r.viewId?(r.hidden=!1,t.ref.isHiding=!1,t.ref.menu&&(t.ref.menu.opacity=1)):(t.ref.isHiding=!0,t.ref.menu&&(t.ref.menu.opacity=0),t.ref.tools.opacity=0,t.ref.tools.translateY=5,t.dispatch("SET_MARKUP_UTIL",{value:"select"}))},MARKUP_SELECT:function(e){var t=e.root,n=e.action;t.ref.tools.opacity=n.id?1:0,t.ref.tools.translateY=n.id?0:5,t.ref.tools.element.dataset.active=n.id?"true":"false"},DID_SET_MARKUP_UTIL:function(e){var t=e.root,n=e.action,r=t.ref,i=r.inputs,o=r.tools;i.forEach(function(a){a.checked=a.value===n.value}),n.value==="draw"&&(o.opacity=1,o.translateY=0,o.element.dataset.active="true")}},function(e){var t=e.root,n=e.props;t.ref.isHiding&&t.ref.menu&&t.ref.menu.opacity===0&&(t.ref.isHiding=!1,n.hidden=!0),n.hidden||(t.ref.menu.element.dataset.layout=t.ref.menuItemsRequiredWidth>t.rect.element.width?"compact":"spacious")})}),sf=["x","y","left","top","right","bottom"],df=function(e){return sf.every(function(t){return e[t]===void 0})},Si=function(){return-.5+Math.random()},Oi=function(e){return e.match(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g)!==null},ff=D({ignoreRect:!0,tag:"ul",name:"sticker-list",create:function(e){var t=e.root;t.element.setAttribute("role","list");var n=function(i,o){var a=i.markup;typeof i=="string"||Array.isArray(i)?a=i:i.markup||(a=i.sticker),Array.isArray(i.sticker)&&(a=[a[0],I({},i.sticker[1],a[1])]);var l,u,c=typeof a=="string",s=c&&Oi(a),d=c&&!s,f=0,h=0,p=t.query("GET_CROP_RECTANGLE_ASPECT_RATIO");if(d)l="image",f=.5*-(u={src:a,width:.5,height:.5*p,fit:"contain"}).width,h=.5*-u.height;else{if(s?(l="text",u={text:a}):(l=a[0],u=I({},a[1])),l==="text"){u.fontColor=u.fontColor||"#000000",u.fontSize=u.fontSize||.125,u.allowInput=u.allowInput!==void 0&&u.allowInput,u.allowEdit=u.allowEdit!==void 0&&u.allowEdit;var g=s?.75*u.fontSize:.35*u.fontSize*u.text.length;f=-.5*g,h=.5*(s?g*p*.5:.5*u.fontSize)}typeof u.width=="string"||typeof u.height=="string"||l!=="rect"&&l!=="ellipse"&&l!=="line"&&l!=="image"||(u.height=u.height*p,f=.5*-u.width,h=.5*-u.height)}o&&(u.x=o.x+f,u.y=o.y+h),df(u)&&(u.x=.5+.5*Si()+f,u.y=.5+.5*Si()+h),t.dispatch("MARKUP_ADD",[l,u])};t.element.addEventListener("pointerdown",function(i){var o=i.target.dataset.index||"";if(o.length){var a=t.query("GET_STICKERS")[o];if(a){var l={x:i.pageX,y:i.pageY},u=Date.now();document.documentElement.addEventListener("pointerup",function c(s){document.documentElement.removeEventListener("pointerup",c);var d={x:s.pageX,y:s.pageY},f=Kn(l,d),h=Date.now()-u;if(f<10&&h<300)n(a);else{var p=t.query("GET_ROOT"),g=t.query("GET_STAGE"),m=t.query("GET_CROP_RECT"),_=s.offsetX!==void 0?s.offsetX:s.pageX-p.x-g.x-window.pageXOffset,y=s.offsetY!==void 0?s.offsetY:s.pageY-p.y-g.y-window.pageYOffset,v=g.x+m.x,T=g.y+m.y,A=(_-v)/m.width,R=(y-T)/m.height;A<0||A>1||R<0||R>1||n(a,{x:A,y:R})}})}}});var r=function(){var i=t.query("GET_STICKERS");t.element.innerHTML="",i.forEach(function(o,a){var l,u;typeof o=="string"||Array.isArray(o)?(l="",u=o):(l=o.alt||"",u=o.sticker);var c,s=z("button"),d=typeof u=="string",f=d&&Oi(u);if(d&&!f)(c=new Image).src=u;else{var h,p;c=z("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),f?(h="text",p={text:u}):(h=u[0],p=I({},u[1])),h==="text"&&(p.fontColor=p.fontColor||"#000000",p.fontSize=p.fontSize||.3125);var g=Lr(h,p);Pr(g,h,p,{width:200,height:200}),g.removeAttribute("id");var m=h==="text"?6:0;h==="ellipse"?(g.setAttribute("cx","50"),g.setAttribute("cy","50")):(g.setAttribute("x",50-.5*g.getAttribute("width")),g.setAttribute("y",50-.5*g.getAttribute("height"))),h==="text"&&(g.setAttribute("x","50"),g.setAttribute("y",50+m),g.setAttribute("text-anchor","middle"),g.setAttribute("dominant-baseline","middle")),c.appendChild(g)}l&&(s.innerHTML="<span>".concat(l,"</span>")),s.appendChild(c),s.dataset.index=a,s.setAttribute("type","button"),s.className="doka--button doka--button-tool";var _=z("li");_.appendChild(s),t.element.appendChild(_)})};t.ref.updateStickers=r,r()},write:dt({DID_SET_STICKERS:function(e){var t=e.root;e.action,e.props,t.ref.updateStickers()}})}),pf=So("sticker",ff),hf=function(e,t){return!e||!t||!no(e,t)},gf={crop:Nd,resize:Wd,filter:Jd,color:tf,markup:uf,sticker:pf},mf=D({name:"view-stack",ignoreRect:!0,mixins:{apis:["offsetTop"]},create:function(e){var t=e.root;t.ref.activeView=null,t.ref.activeStagePosition=null,t.ref.shouldFocus=!1},write:dt({SHOW_VIEW:function(e){var t=e.root,n=e.props,r=e.action,i=t.childViews.length===0,o=t.childViews.find(function(l){return l.viewId===r.id});o||(o=t.appendChildView(t.createChildView(gf[r.id],I({},n)))),t.ref.activeView=o,t.childViews.map(function(l){return l.element}).forEach(function(l){l.dataset.viewActive="false",l.removeAttribute("tabindex"),Ir()&&(l.style.transform="")});var a=t.ref.activeView.element;a.dataset.viewActive="true",a.setAttribute("tabindex",-1),Ir()&&setTimeout(function(){a.style.transform="translateZ(0)"},32),t.ref.shouldFocus=!i},DID_PRESENT_IMAGE:function(e){var t=e.root;t.dispatch("CHANGE_VIEW",{id:t.query("GET_UTIL")||t.query("GET_UTILS")[0]})},DID_SET_UTILS:function(e){var t=e.root;t.dispatch("CHANGE_VIEW",{id:t.query("GET_UTIL")||t.query("GET_UTILS")[0]})}},function(e){var t=e.root,n=e.props,r=t.ref,i=r.activeView,o=r.previousStagePosition;if(i&&i.stagePosition&&(t.childViews.forEach(function(d){d.offsetTop=n.offsetTop,d.element.viewHidden!==d.hidden&&(d.element.viewHidden=d.hidden,d.element.dataset.viewHidden=d.hidden)}),hf(i.stagePosition,o))){var a=i.stagePosition,l=a.x,u=a.y,c=a.width,s=a.height;if(c===0&&s===0)return;t.dispatch("DID_RESIZE_STAGE",{offset:{x:l,y:u},size:{width:c,height:s},animate:!0}),t.ref.previousStagePosition=i.stagePosition}}),didWriteView:function(e){var t=e.root;t.ref.shouldFocus&&(t.ref.activeView.element.focus({preventScroll:!0}),t.ref.shouldFocus=!1)}}),vf=D({name:"content",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(e){var t=e.root,n=e.props;t.opacity=1,t.ref.viewStack=t.appendChildView(t.createChildView(mf,{id:n.id})),t.ref.image=null},write:dt({DID_LOAD_IMAGE:function(e){var t=e.root,n=e.props;t.ref.image=t.appendChildView(t.createChildView(md,{id:n.id}))}},function(e){var t=e.root,n=t.ref,r=n.image,i=n.viewStack;if(r){var o=t.rect.element.top;i.offsetTop=o,r.offsetTop=o}})}),yf=function(e,t){e.element.dataset.scaleDirection=t===null||t>1?"up":"down"},_f=D({name:"utils",create:function(e){var t=e.root,n={crop:{title:t.query("GET_LABEL_BUTTON_UTIL_CROP"),icon:X('<g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width="2"><path d="M23 17H9a2 2 0 0 1-2-2v-5m0-3V1"/><path d="M1 7h14a2 2 0 0 1 2 2v7m0 4v3"/></g>')},filter:{title:t.query("GET_LABEL_BUTTON_UTIL_FILTER"),icon:X('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.347 9.907a6.5 6.5 0 1 0-1.872 3.306M3.26 11.574a6.5 6.5 0 1 0 2.815-1.417"/><path d="M10.15 17.897A6.503 6.503 0 0 0 16.5 23a6.5 6.5 0 1 0-6.183-8.51"/></g>')},color:{title:t.query("GET_LABEL_BUTTON_UTIL_COLOR"),icon:X('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 1v5.5m0 3.503V23M12 1v10.5m0 3.5v8M20 1v15.5m0 3.5v3M2 7h4M10 12h4M18 17h4"/></g>')},markup:{title:t.query("GET_LABEL_BUTTON_UTIL_MARKUP"),icon:X('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.086 2.914a2.828 2.828 0 1 1 4 4l-14.5 14.5-5.5 1.5 1.5-5.5 14.5-14.5z"/></g>')},sticker:{title:t.query("GET_LABEL_BUTTON_UTIL_STICKER"),icon:X('<g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke="currentColor" stroke-width="2"><path d="M19.046 14.938a11.87 11.87 0 01-1.796 2.312C16.083 18.417 14.667 19.333 13 20H6.5A2.5 2.5 0 014 17.5v-11A2.5 2.5 0 016.5 4h11A2.5 2.5 0 0120 6.5V12" stroke-linejoin="round"/><path d="M12 20v-5.5a2.5 2.5 0 012.5-2.5h5.473"/></g>')},resize:{title:t.query("GET_LABEL_BUTTON_UTIL_RESIZE"),icon:X('<g fill="none" fill-rule="evenodd" stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="12" width="10" height="10" rx="2"/><path d="M4 11.5V4a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5"/><path d="M14 10l3.365-3.365M14 6h4v4" class="doka--icon-resize-arrow-ne"/><path d="M14 10l3.365-3.365M14 6v4h4" class="doka--icon-resize-arrow-sw"/></g>')}};t.ref.utils=Object.keys(n).map(function(r){return I({id:r},n[r])}),t.ref.utilMenuRequiredWidth=null},read:function(e){var t=e.root;if(t.ref.utilMenuRequiredWidth===null){var n=t.childViews.reduce(function(r,i){return r+i.rect.outer.width},0);t.ref.utilMenuRequiredWidth=n===0?null:n}},write:dt({DID_SET_UTILS:function(e){var t=e.root,n=Ft(t.query("GET_UTILS"));t.childViews.forEach(function(r){return t.removeChildView(r)}),t.element.dataset.utilCount=n.length,n.length===1&&(n.length=0),n.forEach(function(r){var i=t.ref.utils.find(function(a){return a.id===r}),o=t.appendChildView(t.createChildView(Tt,{name:"tab",view:Tt,label:i.title,opacity:1,icon:i.icon,id:i.id,action:function(){return t.dispatch("CHANGE_VIEW",{id:i.id})}}));t.ref["util_button_".concat(i.id)]=o})},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.childViews.forEach(function(r){r.element.dataset.active=r.id===n.id})}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus;t.ref.util_button_resize&&yf(t.ref.util_button_resize,o.image.width?o.image.width/o.crop.width:null),t.element.dataset.layout=t.ref.utilMenuRequiredWidth>t.rect.element.width?"compact":"spacious"}})}),Ef=Se()&&function(){try{var e={antialias:!1,alpha:!1},t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch{return!1}}(),wf=function(){return Ef},Tf=D({name:"container",create:function(e){var t=e.root,n=[];t.query("GET_ALLOW_BUTTON_RESET")&&n.push({view:Tt,opacity:0,label:t.query("GET_LABEL_BUTTON_RESET"),didCreateView:function(r){return t.ref.btnReset=r},name:"app action-reset icon-only",icon:X('<g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g>',26),action:function(){var r=t.query("GET_BEFORE_RESET"),i=!r||r();Promise.resolve(i).then(function(o){o&&t.dispatch("EDIT_RESET")})}}),t.query("GET_ALLOW_BUTTON_CANCEL")&&n.unshift({view:Tt,label:t.query("GET_LABEL_BUTTON_CANCEL"),name:"app action-cancel icon-fallback",opacity:1,icon:X('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),didCreateView:function(r){t.ref.btnCancel=r},action:function(){t.dispatch("EDIT_CANCEL")}}),n.push({view:_f}),t.query("GET_ALLOW_BUTTON_CONFIRM")&&n.push({view:Tt,label:t.query("GET_LABEL_BUTTON_CONFIRM"),name:"app action-confirm icon-fallback",opacity:1,icon:X('<polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),didCreateView:function(r){t.ref.btnConfirm=r},action:function(){t.dispatch("EDIT_CONFIRM")}}),t.ref.menu=t.appendChildView(t.createChildView(Vr("menu"),{controls:n})),t.ref.menu.opacity=0,t.ref.status=t.appendChildView(t.createChildView(Fs)),t.ref.hasWebGL=wf(),t.ref.hasWebGL?t.dispatch("AWAIT_IMAGE"):t.dispatch("MISSING_WEBGL"),t.ref.handleFocusOut=function(r){if(r.relatedTarget&&Wt(t.element,r.relatedTarget)){var i=t.ref.status;i.element.dataset.viewStatus==="busy"&&i.element.focus()}},t.ref.handleFocusIn=function(r){var i=t.ref,o=i.menu,a=i.content,l=r.target;if(!Wt(o.element,l)&&a&&Wt(a.element,l)){if(!Array.from(t.element.querySelectorAll("[data-view-active=false]")).reduce(function(u,c){return Wt(c,l)&&(u=!0),u},!1))return;o.element.querySelector("button,input,[tabindex]").focus()}},t.element.addEventListener("focusin",t.ref.handleFocusIn),t.element.addEventListener("focusout",t.ref.handleFocusOut),t.ref.previousState=null},destroy:function(e){var t=e.root;t.element.removeEventListener("focusin",t.ref.handleFocusIn),t.element.removeEventListener("focusout",t.ref.handleFocusOut)},write:dt({UNLOAD_IMAGE:function(e){var t=e.root;t.ref.content&&(t.ref.content.opacity=0,t.ref.menu.opacity=0)},DID_UNLOAD_IMAGE:function(e){var t=e.root;t.removeChildView(t.ref.content),t.ref.content=null},DID_LOAD_IMAGE:function(e){var t=e.root,n=e.props;t.ref.hasWebGL&&(t.ref.content=t.appendChildView(t.createChildView(vf,{opacity:null,id:n.id})),t.ref.menu.opacity=1)},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.element.dataset.limitOverflow=n.id==="resize"}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=o.props,l={crop:{center:{x:N(a.center.x,5),y:N(a.center.y,5)},rotation:N(a.rotation,5),zoom:N(a.zoom,5),aspectRatio:N(a.aspectRatio,5),flip:{horizontal:a.flip.horizontal,vertical:a.flip.vertical},scaleToFit:a.scaleToFit,width:o.currentWidth,height:o.currentHeight},preview:{scale:i.scale/Math.max(i.cropRect.width/i.previewSize.width,i.cropRect.height/i.previewSize.height)}};Rf(t.ref.previousState,l)&&(t.dispatch("DID_UPDATE",{state:I({},l)}),t.ref.previousState=l);var u=t.ref,c=u.btnReset,s=u.btnCancel,d=u.content,f=i.canReset;if(c&&(c.opacity=f?1:0),s&&c){var h=t.query("GET_ROOT_SIZE");s.opacity=f&&h.width<=600?0:1}d&&d.opacity===0&&t.dispatch("DID_UNLOAD_IMAGE")}})}),Rf=function(e,t){if(!e)return!0;var n=e.crop,r=t.crop;return n.width!==r.width||n.height!==r.height||n.center.x!==r.center.x||n.center.y!==r.center.y||n.rotation!==r.rotation||n.scaleToFit!==r.scaleToFit||n.zoom!==r.zoom||n.aspectRatio!==r.aspectRatio||n.flip.horizontal!==r.flip.horizontal||n.flip.vertical!==r.flip.vertical},Af=function(e){var t={destroy:function(){}};if("onpointerdown"in window||e.pointersPolyfilled)return t;e.pointersPolyfilled=!0;var n=0,r=[],i=function(h,p,g){var m=new UIEvent(p.type,{view:window,bubbles:!g});Object.keys(p).forEach(function(_){Object.defineProperty(m,_,{value:p[_],writable:!1})}),h.dispatchEvent(m)},o=function(h,p,g){return Array.from(p.changedTouches).map(function(m){var _=r[m.identifier],y={type:h,pageX:m.pageX,pageY:m.pageY,pointerId:m.identifier,isPrimary:_?_.isPrimary:n===0,preventDefault:function(){return p.preventDefault()}};return i(m.target,y,g),y})},a=function(h){o("pointerdown",h).forEach(function(p){r[p.pointerId]=p,n++})},l=function(h){o("pointermove",h)},u=function(h){o("pointerup",h).forEach(function(p){delete r[p.pointerId],n--})},c=function(h,p,g){var m={type:h,pageX:p.pageX,pageY:p.pageY,pointerId:0,isPrimary:!0,preventDefault:function(){return p.preventDefault()}};return i(p.target,m,g),m},s=function(h){c("pointerdown",h)},d=function(h){c("pointermove",h)},f=function(h){c("pointerup",h)};return"ontouchstart"in window?(e.addEventListener("touchstart",a),e.addEventListener("touchmove",l),e.addEventListener("touchend",u)):"onmousedown"in window&&(e.addEventListener("mousedown",s),e.addEventListener("mousemove",d),e.addEventListener("mouseup",f)),t.destroy=function(){r.length=0,e.pointersPolyfilled=!1,e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",l),e.removeEventListener("touchend",u),e.removeEventListener("mousedown",s),e.removeEventListener("mousemove",d),e.removeEventListener("mouseup",f)},t},Vn=function(e){e.type!=="gesturestart"&&bo(e.target,function(t){return t.isScrollContainer})||e.preventDefault()},xf=D({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(e){var t=e.root,n=e.props;n.markedForRemoval=!1,ze()&&(t.element.addEventListener("touchmove",Vn,{passive:!1}),t.element.addEventListener("gesturestart",Vn)),t.ref.pointerPolyfill=Af(t.query("GET_POINTER_EVENTS_POLYFILL_SCOPE")==="root"?t.element:document.documentElement),t.appendChildView(t.createChildView(Tf,I({},n)))},destroy:function(e){var t=e.root;t.ref.pointerPolyfill.destroy(),t.element.removeEventListener("touchmove",Vn,!0),t.element.removeEventListener("gesturestart",Vn)}}),If=function(){function e(){t.fire("touch-detected"),window.removeEventListener("touchstart",e,!1)}var t=I({},Or(),{destroy:function(){window.removeEventListener("touchstart",e,!1)}});return window.addEventListener("touchstart",e,!1),t},Cf=function(e){var t,n={browseEnabled:!1},r=function(){t.files.length&&i.fire("drop",Array.from(t.files))},i=I({},Or(),{enableBrowse:function(){n.browseEnabled||((t=document.createElement("input")).style.display="none",t.setAttribute("type","file"),t.addEventListener("change",r),e.appendChild(t),e.addEventListener("click",o),n.browseEnabled=!0)},disableBrowse:function(){n.browseEnabled&&(t.removeEventListener("change",r),t.parentNode.removeChild(t),e.removeEventListener("click",o),n.browseEnabled=!1)},destroy:function(){e.removeEventListener("dragover",a),e.removeEventListener("drop",l),e.removeEventListener("click",o),t&&t.removeEventListener("change",r)}}),o=function(){return t.click()},a=function(u){return u.preventDefault()},l=function(u){u.preventDefault();var c=Array.from(u.dataTransfer.items||u.dataTransfer.files).map(function(s){return s.getAsFile&&s.kind==="file"?s.getAsFile():s});i.fire("drop",c)};return e.addEventListener("dragover",a),e.addEventListener("drop",l),i},bf=function(e){var t=function(n){if(n.keyCode===9){var r=Array.from(e.querySelectorAll("button,input,[tabindex]")).filter(function(a){return a.style.visibility!=="hidden"&&a.tabIndex!==-1}),i=r[0],o=r[r.length-1];n.shiftKey?document.activeElement===i&&(o.focus(),n.preventDefault()):document.activeElement===o&&(i.focus(),n.preventDefault())}};return e.addEventListener("keydown",t),{destroy:function(){e.removeEventListener("keydown",t)}}},hr=function(e){return e.ref.isFullscreen},gr=function(e){return/fullscreen/.test(e.query("GET_STYLE_LAYOUT_MODE"))},Mo=function(e){return/fullscreen|preview/.test(e.query("GET_STYLE_LAYOUT_MODE"))},Mi=function(e){return/modal/.test(e.query("GET_STYLE_LAYOUT_MODE"))},Li=function(e){return e.query("GET_ALLOW_AUTO_CLOSE")},Pi=Mo,Sf=Mo,Gi=function(e){var t=e.ref,n=t.environment,r=t.isSingleUtil,i=t.canBeControlled;e.element.dataset.styleViewport=Lf(e.rect.element.width,e.rect.element.height)+" "+n.join(" ")+(r?" single-util":" multi-util")+(i?" flow-controls":" no-flow-controls")},Lo=function(e){var t=e.touches?e.touches[0]:e;t.pageX>10&&t.pageX<window.innerWidth-10||e.preventDefault()},Of=function(e){var t=e.element,n=e.ref,r=n.handleFullscreenUpdate,i=n.handleEscapeKey;t.setAttribute("tabindex",-1),r(),e.ref.focusTrap=bf(t),t.addEventListener("keydown",i),ze()&&t.addEventListener("touchstart",Lo),window.addEventListener("resize",r),window.innerWidth-document.documentElement.clientWidth>0&&document.body.classList.add("doka--parent"),document.body.appendChild(t);var o=document.querySelector("meta[name=viewport]");e.ref.defaultViewportContent=o?o.getAttribute("content"):null,o||((o=document.createElement("meta")).setAttribute("name","viewport"),document.head.appendChild(o)),o.setAttribute("content","width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0"),e.opacity=1,Wt(e.element,document.activeElement)||t.focus(),e.dispatch("INVALIDATE_VIEWPORT"),e.ref.isFullscreen=!0},ki=function(e){var t=e.element,n=e.ref,r=n.handleFullscreenUpdate,i=n.focusTrap,o=n.handleEscapeKey;t.removeAttribute("tabindex"),i.destroy(),t.removeEventListener("keydown",o),ze()&&t.removeEventListener("touchstart",Lo),window.removeEventListener("resize",r),document.body.classList.remove("doka--parent");var a=document.querySelector("meta[name=viewport]");e.ref.defaultViewportContent?(a.setAttribute("content",e.ref.defaultViewportContent),e.ref.defaultViewportContent=null):a.parentNode.removeChild(a),e.ref.isFullscreen=!1},Mf=D({name:"root",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(e){var t=e.root,n=e.props;t.element.id=t.query("GET_ID")||"doka-".concat(n.id);var r=t.query("GET_CLASS_NAME");r&&t.element.classList.add(r),t.ref.environment=[],t.ref.shouldBeDestroyed=!1,t.ref.isClosing=!1,t.ref.isClosed=!1,t.ref.isFullscreen=!1,t.query("GET_ALLOW_DROP_FILES")&&(t.ref.catcher=Cf(t.element),t.ref.catcher.on("drop",function(o){o.forEach(function(a){t.dispatch("REQUEST_LOAD_IMAGE",{source:a})})})),t.ref.touchDetector=If(),t.ref.touchDetector.onOnce("touch-detected",function(){t.ref.environment.push("touch")}),t.ref.editor=t.appendChildView(t.createChildView(xf,{id:n.id})),t.query("GET_STYLES").filter(function(o){return!Sr(o.value)}).map(function(o){var a=o.name,l=o.value;t.element.dataset[a]=l}),t.ref.updateViewport=function(){t.dispatch("INVALIDATE_VIEWPORT")},window.addEventListener("resize",t.ref.updateViewport),window.addEventListener("scroll",t.ref.updateViewport),t.ref.isSingleUtil=t.query("GET_UTILS").length===1,t.ref.canBeControlled=t.query("GET_ALLOW_BUTTON_CONFIRM")||t.query("GET_ALLOW_BUTTON_CANCEL"),Gi(t);var i=document.createElement("div");i.style.cssText="position:fixed;height:100vh;top:0;",t.ref.measure=i,document.body.appendChild(i),t.ref.handleEscapeKey=function(o){o.keyCode===27&&t.dispatch("EDIT_CANCEL")},t.ref.initialScreenMeasureHeight=null,t.ref.handleFullscreenUpdate=function(){t.element.dataset.styleFullscreen=window.innerHeight===t.ref.initialScreenMeasureHeight},t.ref.clientRect={left:0,top:0},Mi(t)&&(t.ref.handleModalTap=function(o){o.target===t.element&&t.dispatch("EDIT_CANCEL")},t.element.addEventListener("pointerdown",t.ref.handleModalTap))},read:function(e){var t=e.root,n=t.ref.measure;n&&(t.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),t.ref.measure=null),t.ref.clientRect=t.element.getBoundingClientRect(),t.ref.clientRect.leftScroll=t.ref.clientRect.left+(window.scrollX||window.pageXOffset),t.ref.clientRect.topScroll=t.ref.clientRect.top+(window.scrollY||window.pageYOffset)},write:dt({ENTER_FULLSCREEN:function(e){var t=e.root;Of(t)},EXIT_FULLSCREEN:function(e){var t=e.root;ki(t)},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.element.dataset.view=n.id},DID_SET_STYLE_LAYOUT_MODE:function(e){var t=e.root,n=e.action;t.element.dataset.styleLayoutMode=n.value||"none",/fullscreen/.test(n.value)&&!/fullscreen/.test(n.prevValue)&&t.dispatch("ENTER_FULLSCREEN")},AWAITING_IMAGE:function(e){var t=e.root;t.ref.catcher&&t.query("GET_ALLOW_BROWSE_FILES")&&t.ref.catcher.enableBrowse()},DID_REQUEST_LOAD_IMAGE:function(e){var t=e.root;if(t.ref.catcher&&t.query("GET_ALLOW_BROWSE_FILES")&&t.ref.catcher.disableBrowse(),t.opacity===0&&(t.opacity=1),t.ref.isClosing=!1,t.ref.isClosed=!1,!gr(t)||hr(t)){var n=t.query("GET_STYLE_LAYOUT_MODE");n!==null&&n!=="modal"||t.element.parentNode||t.dispatch("SET_STYLE_LAYOUT_MODE",{value:("fullscreen "+(n||"")).trim()})}else t.dispatch("ENTER_FULLSCREEN")},DID_CANCEL:function(e){var t=e.root;Pi(t)&&Li(t)&&t.dispatch("EDIT_CLOSE")},DID_CONFIRM:function(e){var t=e.root;Pi(t)&&Li(t)&&t.dispatch("EDIT_CLOSE")},EDIT_CLOSE:function(e){var t=e.root;Sf(t)&&(t.opacity=t.opacity||1,t.opacity=0,t.ref.isClosed=!1,t.ref.isClosing=!0,t.query("GET_ALLOW_AUTO_DESTROY")&&(t.ref.shouldBeDestroyed=!0),hr(t)&&t.dispatch("EXIT_FULLSCREEN"))},DID_SET_UTILS:function(e){var t=e.root;t.ref.isSingleUtil=t.query("GET_UTILS").length===1}},function(e){var t=e.root;Gi(t);var n=t.query("GET_ROOT"),r=t.rect.element;n.width===r.width&&n.height===r.height&&n.y===t.ref.clientRect.top&&n.topScroll===t.ref.clientRect.topScroll||t.dispatch("UPDATE_ROOT_RECT",{rect:{x:t.ref.clientRect.left,y:t.ref.clientRect.top,left:t.ref.editor.rect.element.left,top:t.ref.editor.rect.element.top,leftScroll:t.ref.clientRect.leftScroll,topScroll:t.ref.clientRect.topScroll,width:t.rect.element.width,height:t.rect.element.height}})}),didWriteView:function(e){var t=e.root,n=t.ref,r=n.isClosed,i=n.isClosing,o=n.shouldBeDestroyed;!r&&i&&t.opacity===0&&(t.dispatch("DID_CLOSE"),t.ref.isClosed=!0,t.ref.isClosing=!1,gr(t)&&t.element.parentNode&&document.body.removeChild(t.element),o&&t.dispatch("EDIT_DESTROY"))},destroy:function(e){var t=e.root;hr(t)&&ki(t),Mi(t)&&t.element.removeEventListener("pointerdown",t.ref.handleModalTap),gr(t)&&t.element.parentNode&&document.body.removeChild(t.element),window.removeEventListener("resize",t.ref.updateViewport),t.ref.touchDetector.destroy(),t.ref.catcher&&t.ref.catcher.destroy()}}),Lf=function(e,t){var n="";return e===0&&t===0?"detached":(n+=t>e?"portrait":"landscape",(n+=e<=600?" x-cramped":e<=1e3?" x-comfortable":" x-spacious").trim())},Pf=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Fn(),n=Zl(Ic(t),[Jc,Sc(t)],[ks,bc(t)]);n.dispatch("SET_OPTIONS",{options:e});var r=function(){document.hidden||n.dispatch("KICK")};document.addEventListener("visibilitychange",r);var i=Yt();n.dispatch("SET_UID",{id:i});var o=null,a=Mf(n,{id:i}),l=!1,u={_read:function(){l||a._read()},_write:function(p){var g=n.processActionQueue().filter(function(m){return!/^SET_/.test(m.type)});l&&!g.length||(d(g),(l=a._write(p,g))&&n.processDispatchQueue(),g.find(function(m){return m.type==="EDIT_DESTROY"})&&f())}},c=function(p){return function(g){var m={type:p};return g&&(g.hasOwnProperty("error")&&(m.error=hn(g.error)?I({},g.error):g.error||null),g.hasOwnProperty("output")&&(m.output=g.output),g.hasOwnProperty("image")&&(m.image=g.image),g.hasOwnProperty("source")&&(m.source=g.source),g.hasOwnProperty("state")&&(m.state=g.state)),m}},s={DID_CONFIRM:c("confirm"),DID_CANCEL:c("cancel"),DID_REQUEST_LOAD_IMAGE:c("loadstart"),DID_LOAD_IMAGE:c("load"),DID_LOAD_IMAGE_ERROR:c("loaderror"),DID_SHOW_IMAGE:c("ready"),DID_UPDATE:c("update"),DID_CLOSE:c("close"),DID_DESTROY:c("destroy"),DID_INIT:c("init")},d=function(p){p.length&&p.forEach(function(g){if(s[g.type]){var m=s[g.type];(Array.isArray(m)?m:[m]).forEach(function(_){setTimeout(function(){(function(y){var v=I({doka:h},y);delete v.type,a&&a.element.dispatchEvent(new CustomEvent("Doka:".concat(y.type),{detail:v,bubbles:!0,cancelable:!0,composed:!0}));var T=[];y.hasOwnProperty("error")&&T.push(y.error);var A=["type","error"];Object.keys(y).filter(function(x){return!A.includes(x)}).forEach(function(x){return T.push(y[x])}),h.fire.apply(h,[y.type].concat(T));var R=n.query("GET_ON".concat(y.type.toUpperCase()));R&&R.apply(void 0,T)})(_(g.data))},0)})}})},f=function(){h.fire("destroy",a.element),document.removeEventListener("visibilitychange",r),a._destroy(),n.dispatch("DID_DESTROY")},h=I({},Or(),u,Cc(n,t),{setOptions:function(p){return n.dispatch("SET_OPTIONS",{options:p})},setData:function(p){n.dispatch("SET_DATA",p)},getData:function(p){return new Promise(function(g,m){n.dispatch("GET_DATA",I({},p,{success:g,failure:m}))})},open:function(p){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(m,_){p&&n.dispatch("REQUEST_LOAD_IMAGE",{source:p,options:g,success:m,failure:_,resolveOnConfirm:!!g&&g.resolveOnConfirm})})},edit:function(p,g){return h.open(p,I({},g,{resolveOnConfirm:!0}))},save:function(p){return new Promise(function(g,m){n.dispatch("GET_DATA",I({},p,{success:g,failure:m}))})},clear:function(){return n.dispatch("REQUEST_REMOVE_IMAGE")},close:function(){return n.dispatch("EDIT_CLOSE")},interact:function(p,g){p==="scale"&&n.dispatch("CROP_IMAGE_RESIZE_SET",{value:g})},interactEnd:function(p){p==="scale"&&n.dispatch("CROP_IMAGE_RESIZE_RELEASE")},destroy:f,insertBefore:function(p){Br(a.element,p)},insertAfter:function(p){Fr(a.element,p)},appendTo:function(p){p.appendChild(a.element)},replaceElement:function(p){Br(a.element,p),p.parentNode.removeChild(p),o=p},restoreElement:function(){o&&(Fr(o,a.element),a.element.parentNode.removeChild(a.element),o=null)},isAttachedTo:function(p){return!!a&&(a.element===p||o===p)},element:{get:function(){return a?a.element:null}}});return n.dispatch("DID_INIT"),Ce(h)},Po=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Fn(),n={};return ht(t,function(r,i){Rt(i)||(n[r]=i[0])}),Pf(I({},n,e))},Gf=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"-";return e.replace(new RegExp("".concat(t,"."),"g"),function(n){return n.charAt(1).toUpperCase()})},kf=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},Df=function(e){return Gf(e.replace(/^data-/,""))},Uf=function e(t,n){ht(n,function(r,i){ht(t,function(o,a){var l=new RegExp(r);if(l.test(o)&&(delete t[o],i!==!1))if(Rt(i))t[i]=a;else{var u=i.group;hn(i)&&!t[u]&&(t[u]={}),t[u][kf(o.replace(l,""))]=a}}),i.mapping&&e(t[i.group],i.mapping)})},Vf=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=[];ht(e.attributes,function(i){return n.push(e.attributes[i])});var r=n.filter(function(i){return i.name}).reduce(function(i,o){var a=gn(e,o.name);return i[Df(o.name)]=a===o.name||a,i},{});return Uf(r,t),r},Nf=function(e){var t=I({},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),n=Vf(e,{"^class$":"className"});Object.keys(n).forEach(function(i){hn(n[i])?(hn(t[i])||(t[i]={}),Object.assign(t[i],n[i])):t[i]=n[i]}),e.nodeName!=="CANVAS"&&e.nodeName!=="IMG"||(t.src=e.dataset.dokaSrc?e.dataset.dokaSrc:e);var r=Po(t);return r.replaceElement(e),r},Bf=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Yl(t[0])?Nf.apply(void 0,t):Po.apply(void 0,Ft(t.filter(function(r){return r})))},Ff=function(e,t,n){Object.getOwnPropertyNames(e).filter(function(r){return!n.includes(r)}).forEach(function(r){return Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})},zf=["fire","_read","_write"],Di=function(e){var t={};return Ff(e,t,zf),t},Hf=function(){return Object.prototype.toString.call(window.operamini)==="[object OperaMini]"},Wf=function(){return"Promise"in window},qf=function(){return"slice"in Blob.prototype},Yf=function(){return"URL"in window&&"createObjectURL"in window.URL},Zf=function(){return"visibilityState"in document},Xf=function(){return"performance"in window},Ui=function(){var e=Se()&&!Hf()&&Zf()&&Wf()&&qf()&&Yf()&&Xf();return function(){return e}}(),ce={apps:[]},$f="doka",Ye=function(){},Vi={},Bn=Ye,mr=Ye,Ni=Ye,Bi=Ye,Fi=Ye,zi=Ye;if(Ui()){hc(function(){ce.apps.forEach(function(e){return e._read()})},function(e){ce.apps.forEach(function(t){return t._write(e)})});var Hi=function e(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:Ui,create:Bn,destroy:mr,parse:Ni,find:Bi,setOptions:zi}})),document.removeEventListener("DOMContentLoaded",e)};document.readyState!=="loading"?setTimeout(function(){return Hi()},0):document.addEventListener("DOMContentLoaded",Hi);var jf=function(){return ht(Fn(),function(e,t){Vi[e]=t[1]})};Vi={},jf(),Bn=function(){var e=Bf.apply(void 0,arguments);return e.on("destroy",mr),ce.apps.push(e),Di(e)},mr=function(e){var t=ce.apps.findIndex(function(n){return n.isAttachedTo(e)});return t>=0&&(ce.apps.splice(t,1)[0].restoreElement(),!0)},Ni=function(e){return Array.from(e.querySelectorAll(".".concat($f))).filter(function(t){return!ce.apps.find(function(n){return n.isAttachedTo(t)})}).map(function(t){return Bn(t)})},Bi=function(e){var t=ce.apps.find(function(n){return n.isAttachedTo(e)});return t?Di(t):null},Fi=function(){var e={};return ht(Fn(),function(t,n){e[t]=n[0]}),e},zi=function(e){return hn(e)&&(ce.apps.forEach(function(t){t.setOptions(e)}),Mc(e)),Fi()}}const Kf=Zo(qo,Yo,$o),Qf={components:{FilePond:Kf,icon:Tn},props:{content:{type:Object}},data:function(){return{myDoka:Bn({}),gallery_server:{process:(e,t,n,r,i,o,a,l)=>{const u=new FormData;u.append("Image",t),Vl(u).then(c=>{r(c);const s=this.$refs.gallery_pond.prepareFiles();this.content.image,s.then(d=>{this.childMethod(d)})}).catch(c=>{console.log(c),c("Error uploading file")})}}}},methods:{childMethod(e){this.content.image=e.map(t=>t.file.serverId)},child(e){this.content.image=e.map(t=>t.serverId)},galleryUpdate(e,t,n){this.child(e)},galleryReorderFiles(e,t,n){this.child(e)}},mounted(){Xo(this.$refs.gallery_pond,{files:this.content.image.map(e=>({source:e,options:{type:"limbo"}}))})}},Jf={colspan:"2"},tp={colspan:"2"};function ep(e,t,n,r,i,o){const a=it("file-pond");return K(),tt("table",null,[w("tbody",null,[w("tr",null,[w("td",Jf,[w("h2",null,ee(n.content.headlight),1)])]),w("tr",null,[w("td",tp,[Z(a,{class:"file-multi","label-idle":"<span class='filepond--label-action'>\uC5C5\uB85C\uB4DC \uD558\uB824\uBA74 \uD074\uB9AD</span> \uB610\uB294 \uB4DC\uB798\uADF8 \uC564 \uB4DC\uB86D",ref:"gallery_pond",allowMultiple:!0,allowReorder:!0,itemInsertLocation:e.before,server:e.gallery_server,imageEditEditor:e.myDoka,onUpdatefiles:o.galleryUpdate,onReorderfiles:o.galleryReorderFiles},null,8,["itemInsertLocation","server","imageEditEditor","onUpdatefiles","onReorderfiles"])])]),w("tr",null,[w("td",null,[Ne(w("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>n.content.title=l)},null,512),[[Be,n.content.title]])]),w("td",null,[Ne(w("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.content.detail=l),cols:"30",rows:"1",name:"text",oninput:'this.style.height = ""; this.style.height = this.scrollHeight + "px"'},null,512),[[Be,n.content.detail]])])])])])}const Go=vt(Qf,[["render",ep]]);const np={components:{ContentView:Go,icon:Tn,Save:Zi,Plus:Xi,Close:$i},data(){return{imageCount:10,imagePath:"https://jwpg-admin.s3.ap-northeast-2.amazonaws.com/login-",imageExtension:".jpg",photo:"",subject:"",date:"",contents:[{image:[],headlight:"\uC0AC\uC9C4 1",title:"\uD604\uC7A5\uC124\uBA85",detail:""},{image:[],headlight:"\uC0AC\uC9C4 2",title:"\uD604\uC7A5\uC124\uBA85",detail:""},{image:[],headlight:"\uC0AC\uC9C4 3",title:"\uD604\uC7A5\uC124\uBA85",detail:""},{image:[],headlight:"\uC0AC\uC9C4 4",title:"\uBC30\uD3EC\uC790\uB8CC",detail:""}]}},methods:{addContent(){const t=`\uC0AC\uC9C4 ${this.contents.length+1}`;this.contents.push({image:[],headlight:t,title:"",detail:""})},removeContent(e){this.contents.splice(e,1)},handleSubmit(e){e.preventDefault();const t=new FormData,n=this.subject,r=this.date,i=this.photo,o=JSON.stringify(this.contents);console.log("contentsString",o),t.append("photo",i),t.append("subject",n),t.append("date",r),t.append("contents",o),console.log(t),Na(t).then(a=>{this.$router.push({path:"/"})})}},mounted(){console.log("\uD604\uC7AC\uB0A0\uC9DC",this.date);const e=new Date,t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0");this.date=`${t}-${n}-${r}`;const i=Math.floor(Math.random()*this.imageCount)+1,o=this.imagePath+i+this.imageExtension;this.photo=o}},ko=e=>(Zn("data-v-61b9088e"),e=e(),Xn(),e),rp={class:"v-sheet"},ip={class:"fixed_button__wrap"},op={class:"create__wrap"},ap={class:"create__header"},lp=ko(()=>w("td",null,[w("p",null,"\uC9C0\uB3C4\uC77C\uC790")],-1)),cp=ko(()=>w("td",null,[w("p",null,"\uD604\uC7A5\uBA85")],-1)),up={class:"write__wrap"},sp=["onClick"];function dp(e,t,n,r,i,o){const a=it("Plus"),l=it("icon"),u=it("Save"),c=it("ContentView"),s=it("Close");return K(),tt("div",rp,[w("div",ip,[w("button",{class:"add_button",onClick:t[0]||(t[0]=(...d)=>o.addContent&&o.addContent(...d))},[Z(l,{icon:"Plus"},{default:Et(()=>[Z(a)]),_:1}),kt("\uCD94\uAC00")]),w("button",{class:"save_button",onClick:t[1]||(t[1]=(...d)=>o.handleSubmit&&o.handleSubmit(...d))},[Z(l,{icon:"Save"},{default:Et(()=>[Z(u)]),_:1}),kt("\uC800\uC7A5")])]),w("div",op,[w("div",ap,[w("table",null,[w("tbody",null,[w("tr",null,[lp,w("td",null,[Ne(w("input",{style:{width:"70%"},type:"date",label:"date","onUpdate:modelValue":t[2]||(t[2]=d=>i.date=d)},null,512),[[Be,i.date]])])])])]),w("table",null,[w("tbody",null,[w("tr",null,[cp,w("td",null,[Ne(w("input",{type:"text",label:"subject","onUpdate:modelValue":t[3]||(t[3]=d=>i.subject=d)},null,512),[[Be,i.subject]])])])])])]),w("div",up,[(K(!0),tt(Ct,null,pn(i.contents,(d,f)=>(K(),tt("div",{class:"write__content",key:f},[Z(c,{content:d},null,8,["content"]),w("button",{class:"close_button",onClick:h=>o.removeContent(f)},[Z(l,{icon:"Close"},{default:Et(()=>[Z(s)]),_:1}),kt("\uC0AD\uC81C")],8,sp)]))),128))])])])}const fp=vt(np,[["render",dp],["__scopeId","data-v-61b9088e"]]);const pp={components:{ContentView:Go,icon:Tn,Save:Zi,Plus:Xi,Close:$i},data(){return{postData:null}},methods:{addContent(){const t=`\uC0AC\uC9C4 ${this.postData.contents.length+1}`;this.postData.contents.push({image:[],headlight:t,title:"",detail:""})},removeContent(e){this.postData.contents.splice(e,1)},handleSubmit(e){e.preventDefault();const t=new FormData,n=this.postData.subject,r=this.postData.date,i=this.$route.params.id,o=JSON.stringify(this.postData.contents);t.append("subject",n),t.append("date",r),t.append("contents",o),Ba(i,t).then(a=>{this.$router.push({path:"/"})})}},created(){const e=this.$route.params.id;Yi(e).then(t=>{this.postData=t})}},Do=e=>(Zn("data-v-95a3e1a0"),e=e(),Xn(),e),hp={key:0,class:"v-sheet"},gp={class:"fixed_button__wrap"},mp={class:"create__wrap"},vp={class:"create__header"},yp=Do(()=>w("td",null,[w("p",null,"\uC9C0\uB3C4\uC77C\uC790")],-1)),_p=Do(()=>w("td",null,[w("p",null,"\uD604\uC7A5\uBA85")],-1)),Ep={class:"write__wrap"},wp=["onClick"];function Tp(e,t,n,r,i,o){const a=it("Plus"),l=it("icon"),u=it("Save"),c=it("ContentView"),s=it("Close");return i.postData?(K(),tt("div",hp,[w("div",gp,[w("button",{class:"add_button",onClick:t[0]||(t[0]=(...d)=>o.addContent&&o.addContent(...d))},[Z(l,{icon:"Plus"},{default:Et(()=>[Z(a)]),_:1}),kt("\uCD94\uAC00")]),w("button",{class:"save_button",onClick:t[1]||(t[1]=(...d)=>o.handleSubmit&&o.handleSubmit(...d))},[Z(l,{icon:"Save"},{default:Et(()=>[Z(u)]),_:1}),kt("\uC800\uC7A5")])]),w("div",mp,[w("div",vp,[w("table",null,[w("tbody",null,[w("tr",null,[yp,w("td",null,[Ne(w("input",{style:{width:"70%"},type:"text","onUpdate:modelValue":t[2]||(t[2]=d=>i.postData.date=d)},null,512),[[Be,i.postData.date]])])])])]),w("table",null,[w("tbody",null,[w("tr",null,[_p,w("td",null,[Ne(w("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=d=>i.postData.subject=d)},null,512),[[Be,i.postData.subject]])])])])])]),kt(" "+ee(i.postData.contents.image)+" ",1),w("div",Ep,[(K(!0),tt(Ct,null,pn(i.postData.contents,(d,f)=>(K(),tt("div",{class:"write__content",key:f},[Z(c,{content:d},null,8,["content"]),w("button",{class:"close_button",onClick:h=>o.removeContent(f)},[Z(l,{icon:"Close"},{default:Et(()=>[Z(s)]),_:1}),kt("\uC0AD\uC81C")],8,wp)]))),128))])])])):Wi("",!0)}const Rp=vt(pp,[["render",Tp],["__scopeId","data-v-95a3e1a0"]]),Ap=Bo({history:Fo(),routes:[{path:"/",name:"MainView",component:Ya},{path:"/post/:id",name:"DetailView",component:Al},{path:"/post/create",name:"CreateView",component:fp},{path:"/post/:id/edit",name:"EditView",component:Rp}]});function xp(e){e.use(Ap)}const Nr=Wo(Sa);Nr.config.globalProperties.$http=Oe;xp(Nr);Nr.mount("#app");
