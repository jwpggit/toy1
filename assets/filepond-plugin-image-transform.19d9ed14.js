/*!
 * FilePondPluginImageTransform 3.8.7
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */const mt=t=>/^image/.test(t.type),Tt=t=>t.substr(0,t.lastIndexOf("."))||t,Mt={jpeg:"jpg","svg+xml":"svg"},xt=(t,e)=>{const n=Tt(t),o=e.split("/")[1],i=Mt[o]||o;return`${n}.${i}`},At=t=>/jpeg|png|svg\+xml/.test(t)?t:"image/jpeg",Rt=t=>/^image/.test(t.type),bt={1:()=>[1,0,0,1,0,0],2:t=>[-1,0,0,1,t,0],3:(t,e)=>[-1,0,0,-1,t,e],4:(t,e)=>[1,0,0,-1,0,e],5:()=>[0,1,1,0,0,0],6:(t,e)=>[0,1,-1,0,e,0],7:(t,e)=>[0,-1,-1,0,e,t],8:t=>[0,-1,1,0,0,t]},Et=(t,e,n)=>(n===-1&&(n=1),bt[n](t,e)),nt=(t,e)=>({x:t,y:e}),It=(t,e)=>t.x*e.x+t.y*e.y,ct=(t,e)=>nt(t.x-e.x,t.y-e.y),_t=(t,e)=>It(ct(t,e),ct(t,e)),ht=(t,e)=>Math.sqrt(_t(t,e)),lt=(t,e)=>{const n=t,o=1.5707963267948966,i=e,r=1.5707963267948966-e,s=Math.sin(o),d=Math.sin(i),h=Math.sin(r),u=Math.cos(r),g=n/s,a=g*d,c=g*h;return nt(u*a,u*c)},Ot=(t,e)=>{const n=t.width,o=t.height,i=lt(n,e),r=lt(o,e),s=nt(t.x+Math.abs(i.x),t.y-Math.abs(i.y)),d=nt(t.x+t.width+Math.abs(r.y),t.y+Math.abs(r.x)),h=nt(t.x-Math.abs(r.y),t.y+t.height-Math.abs(r.x));return{width:ht(s,d),height:ht(s,h)}},ft=(t,e,n=0,o={x:.5,y:.5})=>{const i=o.x>.5?1-o.x:o.x,r=o.y>.5?1-o.y:o.y,s=i*2*t.width,d=r*2*t.height,h=Ot(e,n);return Math.max(h.width/s,h.height/d)},ut=(t,e)=>{let n=t.width,o=n*e;o>t.height&&(o=t.height,n=o/e);const i=(t.width-n)*.5,r=(t.height-o)*.5;return{x:i,y:r,width:n,height:o}},dt=(t,e,n=1)=>{const o=t.height/t.width;let i=1,r=e,s=1,d=o;d>r&&(d=r,s=d/o);const h=Math.max(i/s,r/d),u=t.width/(n*h*s),g=u*e;return{width:u,height:g}},yt=t=>{t.width=1,t.height=1,t.getContext("2d").clearRect(0,0,1,1)},gt=t=>t&&(t.horizontal||t.vertical),St=(t,e,n)=>{if(e<=1&&!gt(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;const o=document.createElement("canvas"),i=t.naturalWidth,r=t.naturalHeight,s=e>=5&&e<=8;s?(o.width=r,o.height=i):(o.width=i,o.height=r);const d=o.getContext("2d");if(e&&d.transform.apply(d,Et(i,r,e)),gt(n)){const h=[1,0,0,1,0,0];(!s&&n.horizontal||s&n.vertical)&&(h[0]=-1,h[4]=i),(!s&&n.vertical||s&&n.horizontal)&&(h[3]=-1,h[5]=r),d.transform(...h)}return d.drawImage(t,0,0,i,r),o},Ct=(t,e,n={},o={})=>{const{canvasMemoryLimit:i,background:r=null}=o,s=n.zoom||1,d=St(t,e,n.flip),h={width:d.width,height:d.height},u=n.aspectRatio||h.height/h.width;let g=dt(h,u,s);if(i){const E=g.width*g.height;if(E>i){const _=Math.sqrt(i)/Math.sqrt(E);h.width=Math.floor(h.width*_),h.height=Math.floor(h.height*_),g=dt(h,u,s)}}const a=document.createElement("canvas"),c={x:g.width*.5,y:g.height*.5},l={x:0,y:0,width:g.width,height:g.height,center:c},y=typeof n.scaleToFit>"u"||n.scaleToFit,f=s*ft(h,ut(l,u),n.rotation,y?n.center:{x:.5,y:.5});a.width=Math.round(g.width/f),a.height=Math.round(g.height/f),c.x/=f,c.y/=f;const m={x:c.x-h.width*(n.center?n.center.x:.5),y:c.y-h.height*(n.center?n.center.y:.5)},p=a.getContext("2d");r&&(p.fillStyle=r,p.fillRect(0,0,a.width,a.height)),p.translate(c.x,c.y),p.rotate(n.rotation||0),p.drawImage(d,m.x-c.x,m.y-c.y,h.width,h.height);const U=p.getImageData(0,0,a.width,a.height);return yt(a),U},vt=(()=>typeof window<"u"&&typeof window.document<"u")();vt&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var o=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var i=atob(o),r=i.length,s=new Uint8Array(r),d=0;d<r;d++)s[d]=i.charCodeAt(d);t(new Blob([s],{type:e||"image/png"}))})}}));const Bt=(t,e,n=null)=>new Promise(o=>{const i=n?n(t):t;Promise.resolve(i).then(r=>{r.toBlob(o,e.type,e.quality)})}),st=(t,e)=>ot(t.x*e,t.y*e),rt=(t,e)=>ot(t.x+e.x,t.y+e.y),wt=t=>{const e=Math.sqrt(t.x*t.x+t.y*t.y);return e===0?{x:0,y:0}:ot(t.x/e,t.y/e)},q=(t,e,n)=>{const o=Math.cos(e),i=Math.sin(e),r=ot(t.x-n.x,t.y-n.y);return ot(n.x+o*r.x-i*r.y,n.y+i*r.x+o*r.y)},ot=(t=0,e=0)=>({x:t,y:e}),L=(t,e,n=1,o)=>{if(typeof t=="string")return parseFloat(t)*n;if(typeof t=="number")return t*(o?e[o]:Math.min(e.width,e.height))},Q=(t,e,n)=>{const o=t.borderStyle||t.lineStyle||"solid",i=t.backgroundColor||t.fontColor||"transparent",r=t.borderColor||t.lineColor||"transparent",s=L(t.borderWidth||t.lineWidth,e,n),d=t.lineCap||"round",h=t.lineJoin||"round",u=typeof o=="string"?"":o.map(a=>L(a,e,n)).join(","),g=t.opacity||1;return{"stroke-linecap":d,"stroke-linejoin":h,"stroke-width":s||0,"stroke-dasharray":u,stroke:r,fill:i,opacity:g}},W=t=>t!=null,Z=(t,e,n=1)=>{let o=L(t.x,e,n,"width")||L(t.left,e,n,"width"),i=L(t.y,e,n,"height")||L(t.top,e,n,"height"),r=L(t.width,e,n,"width"),s=L(t.height,e,n,"height"),d=L(t.right,e,n,"width"),h=L(t.bottom,e,n,"height");return W(i)||(W(s)&&W(h)?i=e.height-s-h:i=h),W(o)||(W(r)&&W(d)?o=e.width-r-d:o=d),W(r)||(W(o)&&W(d)?r=e.width-o-d:r=0),W(s)||(W(i)&&W(h)?s=e.height-i-h:s=0),{x:o||0,y:i||0,width:r||0,height:s||0}},Lt=t=>t.map((e,n)=>`${n===0?"M":"L"} ${e.x} ${e.y}`).join(" "),V=(t,e)=>Object.keys(e).forEach(n=>t.setAttribute(n,e[n])),Nt="http://www.w3.org/2000/svg",X=(t,e)=>{const n=document.createElementNS(Nt,t);return e&&V(n,e),n},Ut=t=>V(t,{...t.rect,...t.styles}),Pt=t=>{const e=t.rect.x+t.rect.width*.5,n=t.rect.y+t.rect.height*.5,o=t.rect.width*.5,i=t.rect.height*.5;return V(t,{cx:e,cy:n,rx:o,ry:i,...t.styles})},Ft={contain:"xMidYMid meet",cover:"xMidYMid slice"},$t=(t,e)=>{V(t,{...t.rect,...t.styles,preserveAspectRatio:Ft[e.fit]||"none"})},Gt={left:"start",center:"middle",right:"end"},Dt=(t,e,n,o)=>{const i=L(e.fontSize,n,o),r=e.fontFamily||"sans-serif",s=e.fontWeight||"normal",d=Gt[e.textAlign]||"start";V(t,{...t.rect,...t.styles,"stroke-width":0,"font-weight":s,"font-size":i,"font-family":r,"text-anchor":d}),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},Wt=(t,e,n,o)=>{V(t,{...t.rect,...t.styles,fill:"none"});const i=t.childNodes[0],r=t.childNodes[1],s=t.childNodes[2],d=t.rect,h={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(V(i,{x1:d.x,y1:d.y,x2:h.x,y2:h.y}),!e.lineDecoration)return;r.style.display="none",s.style.display="none";const u=wt({x:h.x-d.x,y:h.y-d.y}),g=L(.05,n,o);if(e.lineDecoration.indexOf("arrow-begin")!==-1){const a=st(u,g),c=rt(d,a),l=q(d,2,c),y=q(d,-2,c);V(r,{style:"display:block;",d:`M${l.x},${l.y} L${d.x},${d.y} L${y.x},${y.y}`})}if(e.lineDecoration.indexOf("arrow-end")!==-1){const a=st(u,-g),c=rt(h,a),l=q(h,2,c),y=q(h,-2,c);V(s,{style:"display:block;",d:`M${l.x},${l.y} L${h.x},${h.y} L${y.x},${y.y}`})}},Ht=(t,e,n,o)=>{V(t,{...t.styles,fill:"none",d:Lt(e.points.map(i=>({x:L(i.x,n,o,"width"),y:L(i.y,n,o,"height")})))})},it=t=>e=>X(t,{id:e.id}),kt=t=>{const e=X("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=()=>{e.setAttribute("opacity",t.opacity||1)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},zt=t=>{const e=X("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=X("line");e.appendChild(n);const o=X("path");e.appendChild(o);const i=X("path");return e.appendChild(i),e},Vt={image:kt,rect:it("rect"),ellipse:it("ellipse"),text:it("text"),path:it("path"),line:zt},jt={rect:Ut,ellipse:Pt,image:$t,text:Dt,path:Ht,line:Wt},Yt=(t,e)=>Vt[t](e),qt=(t,e,n,o,i)=>{e!=="path"&&(t.rect=Z(n,o,i)),t.styles=Q(n,o,i),jt[e](t,n,o,i)},pt=(t,e)=>t[1].zIndex>e[1].zIndex?1:t[1].zIndex<e[1].zIndex?-1:0,Qt=(t,e={},n,o)=>new Promise(i=>{const{background:r=null}=o,s=new FileReader;s.onloadend=()=>{const d=s.result,h=document.createElement("div");h.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",h.innerHTML=d;const u=h.querySelector("svg");document.body.appendChild(h);const g=u.getBBox();h.parentNode.removeChild(h);const a=h.querySelector("title"),c=u.getAttribute("viewBox")||"",l=u.getAttribute("width")||"",y=u.getAttribute("height")||"";let f=parseFloat(l)||null,m=parseFloat(y)||null;const p=(l.match(/[a-z]+/)||[])[0]||"",U=(y.match(/[a-z]+/)||[])[0]||"",E=c.split(" ").map(parseFloat),_=E.length?{x:E[0],y:E[1],width:E[2],height:E[3]}:g;let x=f!=null?f:_.width,O=m!=null?m:_.height;u.style.overflow="visible",u.setAttribute("width",x),u.setAttribute("height",O);let A="";if(n&&n.length){const Y={width:x,height:O};A=n.sort(pt).reduce((J,j)=>{const B=Yt(j[0],j[1]);return qt(B,j[0],j[1],Y),B.removeAttribute("id"),B.getAttribute("opacity")===1&&B.removeAttribute("opacity"),J+`
`+B.outerHTML+`
`},""),A=`

<g>${A.replace(/&nbsp;/g," ")}</g>

`}const w=e.aspectRatio||O/x,b=x,S=b*w,N=typeof e.scaleToFit>"u"||e.scaleToFit,T=e.center?e.center.x:.5,R=e.center?e.center.y:.5,C=ft({width:x,height:O},ut({width:b,height:S},w),e.rotation,N?{x:T,y:R}:{x:.5,y:.5}),M=e.zoom*C,D=e.rotation*(180/Math.PI),P={x:b*.5,y:S*.5},H={x:P.x-x*T,y:P.y-O*R},v=[`rotate(${D} ${P.x} ${P.y})`,`translate(${P.x} ${P.y})`,`scale(${M})`,`translate(${-P.x} ${-P.y})`,`translate(${H.x} ${H.y})`],$=e.flip&&e.flip.horizontal,I=e.flip&&e.flip.vertical,G=[`scale(${$?-1:1} ${I?-1:1})`,`translate(${$?-x:0} ${I?-O:0})`],F=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="${b}${p}" height="${S}${U}" 
viewBox="0 0 ${b} ${S}" ${r?'style="background:'+r+'" ':""}
preserveAspectRatio="xMinYMin"
xmlns:xlink="http://www.w3.org/1999/xlink"
xmlns="http://www.w3.org/2000/svg">
<!-- Generated by PQINA - https://pqina.nl/ -->
<title>${a?a.textContent:""}</title>
<g transform="${v.join(" ")}">
<g transform="${G.join(" ")}">
${u.outerHTML}${A}
</g>
</g>
</svg>`;i(F)},s.readAsText(t)}),Jt=t=>{let e;try{e=new ImageData(t.width,t.height)}catch{e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},Kt=()=>{const t={resize:g,filter:u},e=(a,c)=>(a.forEach(l=>{c=t[l.type](c,l.data)}),c),n=(a,c)=>{let l=a.transforms,y=null;if(l.forEach(f=>{f.type==="filter"&&(y=f)}),y){let f=null;l.forEach(m=>{m.type==="resize"&&(f=m)}),f&&(f.data.matrix=y.data,l=l.filter(m=>m.type!=="filter"))}c(e(l,a.imageData))};self.onmessage=a=>{n(a.data.message,c=>{self.postMessage({id:a.data.id,message:c},[c.data.buffer])})};const o=1,i=1,r=1;function s(a,c,l){const y=c[a]/255,f=c[a+1]/255,m=c[a+2]/255,p=c[a+3]/255,U=y*l[0]+f*l[1]+m*l[2]+p*l[3]+l[4],E=y*l[5]+f*l[6]+m*l[7]+p*l[8]+l[9],_=y*l[10]+f*l[11]+m*l[12]+p*l[13]+l[14],x=y*l[15]+f*l[16]+m*l[17]+p*l[18]+l[19],O=Math.max(0,U*x)+o*(1-x),A=Math.max(0,E*x)+i*(1-x),w=Math.max(0,_*x)+r*(1-x);c[a]=Math.max(0,Math.min(1,O))*255,c[a+1]=Math.max(0,Math.min(1,A))*255,c[a+2]=Math.max(0,Math.min(1,w))*255}const d=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function h(a){return self.JSON.stringify(a||[])===d}function u(a,c){if(!c||h(c))return a;const l=a.data,y=l.length,f=c[0],m=c[1],p=c[2],U=c[3],E=c[4],_=c[5],x=c[6],O=c[7],A=c[8],w=c[9],b=c[10],S=c[11],N=c[12],T=c[13],R=c[14],C=c[15],M=c[16],D=c[17],P=c[18],H=c[19];let v=0,$=0,I=0,G=0,F=0,Y=0,J=0,j=0,B=0,k=0,z=0,K=0;for(;v<y;v+=4)$=l[v]/255,I=l[v+1]/255,G=l[v+2]/255,F=l[v+3]/255,Y=$*f+I*m+G*p+F*U+E,J=$*_+I*x+G*O+F*A+w,j=$*b+I*S+G*N+F*T+R,B=$*C+I*M+G*D+F*P+H,k=Math.max(0,Y*B)+o*(1-B),z=Math.max(0,J*B)+i*(1-B),K=Math.max(0,j*B)+r*(1-B),l[v]=Math.max(0,Math.min(1,k))*255,l[v+1]=Math.max(0,Math.min(1,z))*255,l[v+2]=Math.max(0,Math.min(1,K))*255;return a}function g(a,c){let{mode:l="contain",upscale:y=!1,width:f,height:m,matrix:p}=c;if(p=!p||h(p)?null:p,!f&&!m)return u(a,p);if(f===null?f=m:m===null&&(m=f),l!=="force"){let T=f/a.width,R=m/a.height,C=1;if(l==="cover"?C=Math.max(T,R):l==="contain"&&(C=Math.min(T,R)),C>1&&y===!1)return u(a,p);f=a.width*C,m=a.height*C}const U=a.width,E=a.height,_=Math.round(f),x=Math.round(m),O=a.data,A=new Uint8ClampedArray(_*x*4),w=U/_,b=E/x,S=Math.ceil(w*.5),N=Math.ceil(b*.5);for(let T=0;T<x;T++)for(let R=0;R<_;R++){let C=(R+T*_)*4,M=0,D=0,P=0,H=0,v=0,$=0,I=0,G=(T+.5)*b;for(let F=Math.floor(T*b);F<(T+1)*b;F++){let Y=Math.abs(G-(F+.5))/N,J=(R+.5)*w,j=Y*Y;for(let B=Math.floor(R*w);B<(R+1)*w;B++){let k=Math.abs(J-(B+.5))/S,z=Math.sqrt(j+k*k);if(z>=-1&&z<=1&&(M=2*z*z*z-3*z*z+1,M>0)){k=4*(B+F*U);let K=O[k+3];I+=M*K,P+=M,K<255&&(M=M*K/250),H+=M*O[k],v+=M*O[k+1],$+=M*O[k+2],D+=M}}}A[C]=H/D,A[C+1]=v/D,A[C+2]=$/D,A[C+3]=I/P,p&&s(C,A,p)}return{data:A,width:_,height:x}}},Xt=(t,e)=>{if(t.getUint32(e+4,!1)!==1165519206)return;e+=4;const n=t.getUint16(e+=6,!1)===18761;e+=t.getUint32(e+4,n);const o=t.getUint16(e,n);e+=2;for(let i=0;i<o;i++)if(t.getUint16(e+i*12,n)===274)return t.setUint16(e+i*12+8,1,n),!0;return!1},Zt=t=>{const e=new DataView(t);if(e.getUint16(0)!==65496)return null;let n=2,o,i,r=!1;for(;n<e.byteLength&&(o=e.getUint16(n,!1),i=e.getUint16(n+2,!1)+2,!(!(o>=65504&&o<=65519||o===65534)||(r||(r=Xt(e,n)),n+i>e.byteLength)));)n+=i;return t.slice(0,n)},te=t=>new Promise(e=>{const n=new FileReader;n.onload=()=>e(Zt(n.result)||null),n.readAsArrayBuffer(t.slice(0,256*1024))}),ee=()=>window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,ne=(t,e)=>{const n=ee();if(n){const o=new n;return o.append(t),o.getBlob(e)}return new Blob([t],{type:e})},oe=()=>Math.random().toString(36).substr(2,9),ie=t=>{const e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),o=new Worker(n),i=[];return{transfer:()=>{},post:(r,s,d)=>{const h=oe();i[h]=s,o.onmessage=u=>{const g=i[u.data.id];!g||(g(u.data.message),delete i[u.data.id])},o.postMessage({id:h,message:r},d)},terminate:()=>{o.terminate(),URL.revokeObjectURL(n)}}},se=t=>new Promise((e,n)=>{const o=new Image;o.onload=()=>{e(o)},o.onerror=i=>{n(i)},o.src=t}),re=t=>t.reduce((e,n)=>e.then(o=>n().then(Array.prototype.concat.bind(o))),Promise.resolve([])),ae=(t,e)=>new Promise(n=>{const o={width:t.width,height:t.height},i=t.getContext("2d"),r=e.sort(pt).map(s=>()=>new Promise(d=>{ue[s[0]](i,o,s[1],d)&&d()}));re(r).then(()=>n(t))}),tt=(t,e)=>{t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},et=t=>{t.fill(),t.stroke(),t.globalAlpha=1},ce=(t,e,n)=>{const o=Z(n,e),i=Q(n,e);return tt(t,i),t.rect(o.x,o.y,o.width,o.height),et(t),!0},he=(t,e,n)=>{const o=Z(n,e),i=Q(n,e);tt(t,i);const r=o.x,s=o.y,d=o.width,h=o.height,u=.5522848,g=d/2*u,a=h/2*u,c=r+d,l=s+h,y=r+d/2,f=s+h/2;return t.moveTo(r,f),t.bezierCurveTo(r,f-a,y-g,s,y,s),t.bezierCurveTo(y+g,s,c,f-a,c,f),t.bezierCurveTo(c,f+a,y+g,l,y,l),t.bezierCurveTo(y-g,l,r,f+a,r,f),et(t),!0},le=(t,e,n,o)=>{const i=Z(n,e),r=Q(n,e);tt(t,r);const s=new Image;new URL(n.src,window.location.href).origin!==window.location.origin&&(s.crossOrigin=""),s.onload=()=>{if(n.fit==="cover"){const h=i.width/i.height,u=h>1?s.width:s.height*h,g=h>1?s.width/h:s.height,a=s.width*.5-u*.5,c=s.height*.5-g*.5;t.drawImage(s,a,c,u,g,i.x,i.y,i.width,i.height)}else if(n.fit==="contain"){const h=Math.min(i.width/s.width,i.height/s.height),u=h*s.width,g=h*s.height,a=i.x+i.width*.5-u*.5,c=i.y+i.height*.5-g*.5;t.drawImage(s,0,0,s.width,s.height,a,c,u,g)}else t.drawImage(s,0,0,s.width,s.height,i.x,i.y,i.width,i.height);et(t),o()},s.src=n.src},de=(t,e,n)=>{const o=Z(n,e),i=Q(n,e);tt(t,i);const r=L(n.fontSize,e),s=n.fontFamily||"sans-serif",d=n.fontWeight||"normal",h=n.textAlign||"left";return t.font=`${d} ${r}px ${s}`,t.textAlign=h,t.fillText(n.text,o.x,o.y),et(t),!0},ge=(t,e,n)=>{const o=Q(n,e);tt(t,o),t.beginPath();const i=n.points.map(s=>({x:L(s.x,e,1,"width"),y:L(s.y,e,1,"height")}));t.moveTo(i[0].x,i[0].y);const r=i.length;for(let s=1;s<r;s++)t.lineTo(i[s].x,i[s].y);return et(t),!0},fe=(t,e,n)=>{const o=Z(n,e),i=Q(n,e);tt(t,i),t.beginPath();const r={x:o.x,y:o.y},s={x:o.x+o.width,y:o.y+o.height};t.moveTo(r.x,r.y),t.lineTo(s.x,s.y);const d=wt({x:s.x-r.x,y:s.y-r.y}),h=.04*Math.min(e.width,e.height);if(n.lineDecoration.indexOf("arrow-begin")!==-1){const u=st(d,h),g=rt(r,u),a=q(r,2,g),c=q(r,-2,g);t.moveTo(a.x,a.y),t.lineTo(r.x,r.y),t.lineTo(c.x,c.y)}if(n.lineDecoration.indexOf("arrow-end")!==-1){const u=st(d,-h),g=rt(s,u),a=q(s,2,g),c=q(s,-2,g);t.moveTo(a.x,a.y),t.lineTo(s.x,s.y),t.lineTo(c.x,c.y)}return et(t),!0},ue={rect:ce,ellipse:he,image:le,text:de,line:fe,path:ge},ye=t=>{const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e},we=(t,e,n={})=>new Promise((o,i)=>{if(!t||!Rt(t))return i({status:"not an image file",file:t});const{stripImageHead:r,beforeCreateBlob:s,afterCreateBlob:d,canvasMemoryLimit:h}=n,{crop:u,size:g,filter:a,markup:c,output:l}=e,y=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,f=l&&l.quality,m=f===null?null:f/100,p=l&&l.type||null,U=l&&l.background||null,E=[];g&&(typeof g.width=="number"||typeof g.height=="number")&&E.push({type:"resize",data:g}),a&&a.length===20&&E.push({type:"filter",data:a});const _=A=>{const w=d?d(A):A;Promise.resolve(w).then(o)},x=(A,w)=>{const b=ye(A),S=c.length?ae(b,c):b;Promise.resolve(S).then(N=>{Bt(N,w,s).then(T=>{if(yt(N),r)return _(T);te(t).then(R=>{R!==null&&(T=new Blob([R,T.slice(20)],{type:T.type})),_(T)})}).catch(i)})};if(/svg/.test(t.type)&&p===null)return Qt(t,u,c,{background:U}).then(A=>{o(ne(A,"image/svg+xml"))});const O=URL.createObjectURL(t);se(O).then(A=>{URL.revokeObjectURL(O);const w=Ct(A,y,u,{canvasMemoryLimit:h,background:U}),b={quality:m,type:p||t.type};if(!E.length)return x(w,b);const S=ie(Kt);S.post({transforms:E,imageData:w},N=>{x(Jt(N),b),S.terminate()},[w.data.buffer])}).catch(i)}),pe=["x","y","left","top","right","bottom","width","height"],me=t=>typeof t=="string"&&/%/.test(t)?parseFloat(t)/100:t,Te=t=>{const[e,n]=t,o=n.points?{}:pe.reduce((i,r)=>(i[r]=me(n[r]),i),{});return[e,{zIndex:0,...n,...o}]},Me=t=>new Promise((e,n)=>{const o=new Image;o.src=URL.createObjectURL(t);const i=()=>{const s=o.naturalWidth,d=o.naturalHeight;!(s&&d)||(URL.revokeObjectURL(o.src),clearInterval(r),e({width:s,height:d}))};o.onerror=s=>{URL.revokeObjectURL(o.src),clearInterval(r),n(s)};const r=setInterval(i,1);i()});typeof window<"u"&&typeof window.document<"u"&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){const o=this;setTimeout(()=>{const i=o.toDataURL(e,n).split(",")[1],r=atob(i);let s=r.length;const d=new Uint8Array(s);for(;s--;)d[s]=r.charCodeAt(s);t(new Blob([d],{type:e||"image/png"}))})}}));const at=typeof window<"u"&&typeof window.document<"u",xe=at&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Ae=({addFilter:t,utils:e})=>{const{Type:n,forin:o,getFileFromBlob:i,isFile:r}=e,s=["crop","resize","filter","markup","output"],d=g=>(a,c,l)=>a(c,g?g(l):l),h=g=>g.aspectRatio===null&&g.rotation===0&&g.zoom===1&&g.center&&g.center.x===.5&&g.center.y===.5&&g.flip&&g.flip.horizontal===!1&&g.flip.vertical===!1;t("SHOULD_PREPARE_OUTPUT",(g,{query:a})=>new Promise(c=>{c(!a("IS_ASYNC"))}));const u=(g,a,c)=>new Promise(l=>{if(!g("GET_ALLOW_IMAGE_TRANSFORM")||c.archived||!r(a)||!mt(a))return l(!1);Me(a).then(()=>{const y=g("GET_IMAGE_TRANSFORM_IMAGE_FILTER");if(y){const f=y(a);if(f==null)return handleRevert(!0);if(typeof f=="boolean")return l(f);if(typeof f.then=="function")return f.then(l)}l(!0)}).catch(y=>{l(!1)})});return t("DID_CREATE_ITEM",(g,{query:a,dispatch:c})=>{!a("GET_ALLOW_IMAGE_TRANSFORM")||g.extend("requestPrepare",()=>new Promise((l,y)=>{c("REQUEST_PREPARE_OUTPUT",{query:g.id,item:g,success:l,failure:y},!0)}))}),t("PREPARE_OUTPUT",(g,{query:a,item:c})=>new Promise(l=>{u(a,g,c).then(y=>{if(!y)return l(g);const f=[];a("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&f.push(()=>new Promise(w=>{w({name:a("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:g})})),a("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&f.push((w,b,S)=>new Promise(N=>{w(b,S).then(T=>N({name:a("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:T}))}));const m=a("GET_IMAGE_TRANSFORM_VARIANTS")||{};o(m,(w,b)=>{const S=d(b);f.push((N,T,R)=>new Promise(C=>{S(N,T,R).then(M=>C({name:w,file:M}))}))});const p=a("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),U=a("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),E=p===null?null:p/100,_=a("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),x=a("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||s;c.setMetadata("output",{type:_,quality:E,client:x},!0);const O=(w,b)=>new Promise((S,N)=>{const T={...b};Object.keys(T).filter(I=>I!=="exif").forEach(I=>{x.indexOf(I)===-1&&delete T[I]});const{resize:R,exif:C,output:M,crop:D,filter:P,markup:H}=T,v={image:{orientation:C?C.orientation:null},output:M&&(M.type||typeof M.quality=="number"||M.background)?{type:M.type,quality:typeof M.quality=="number"?M.quality*100:null,background:M.background||a("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR")||null}:void 0,size:R&&(R.size.width||R.size.height)?{mode:R.mode,upscale:R.upscale,...R.size}:void 0,crop:D&&!h(D)?{...D}:void 0,markup:H&&H.length?H.map(Te):[],filter:P};if(v.output){const I=M.type?M.type!==w.type:!1,G=/\/jpe?g$/.test(w.type),F=M.quality!==null?G&&U==="always":!1;if(!!!(v.size||v.crop||v.filter||I||F))return S(w)}const $={beforeCreateBlob:a("GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB"),afterCreateBlob:a("GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB"),canvasMemoryLimit:a("GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT"),stripImageHead:a("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};we(w,v,$).then(I=>{const G=i(I,xt(w.name,At(I.type)));S(G)}).catch(N)}),A=f.map(w=>w(O,g,c.getMetadata()));Promise.all(A).then(w=>{l(w.length===1&&w[0].name===null?w[0].file:w)})})})),{options:{allowImageTransform:[!0,n.BOOLEAN],imageTransformImageFilter:[null,n.FUNCTION],imageTransformOutputMimeType:[null,n.STRING],imageTransformOutputQuality:[null,n.INT],imageTransformOutputStripImageHead:[!0,n.BOOLEAN],imageTransformClientTransforms:[null,n.ARRAY],imageTransformOutputQualityMode:["always",n.STRING],imageTransformVariants:[null,n.OBJECT],imageTransformVariantsIncludeDefault:[!0,n.BOOLEAN],imageTransformVariantsDefaultName:[null,n.STRING],imageTransformVariantsIncludeOriginal:[!1,n.BOOLEAN],imageTransformVariantsOriginalName:["original_",n.STRING],imageTransformBeforeCreateBlob:[null,n.FUNCTION],imageTransformAfterCreateBlob:[null,n.FUNCTION],imageTransformCanvasMemoryLimit:[at&&xe?4096*4096:null,n.INT],imageTransformCanvasBackgroundColor:[null,n.STRING]}}};at&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:Ae}));export{Ae as p};
